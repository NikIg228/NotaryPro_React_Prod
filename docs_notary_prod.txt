{
    "id": 1,
    "code": "DOC_001",
    "title": "Сопровождение ребёнка вне РК",
    "category": "Доверенности / Путешествия / Несовершеннолетние",
  
    "dev_notes": [
      "Доверитель — 1 или 2 родителя. Если выбрано 2, формы должны дублироваться.",
      "У каждого доверителя обязательно должно быть поле upload для 2 сканов документа.",
      "Поверенный — 1 или 2. Аналогичная логика: если 2, генерировать два блока.",
      "Количество детей — от 1 до 10. Генерируется массив полей.",
      "Страны — две модели выбора: чекбокс 'весь мир' или список стран (~30–35). При выборе 'весь мир' список стран скрывается.",
      "Срок — два режима: дни (1–31) или месяцы (1–36).",
      "Генерация разрешена только если все обязательные данные заполнены.",
      "Валидация блокирует переход, если нет страны или срока.",
      "Cursor должен реализовать conditional rendering и array-формы.",
      "Все поля, перечисленные в steps, обязательны, если не помечены иначе."
    ],
  
    "rules_for_cursor": [
      "Учитывать dev_notes как обязательную техническую спецификацию.",
      "Все ветвления flowchart должны быть отражены через условный next.",
      "Динамические массивы (дети, доверители, поверенные) реализовать через WizardArray.",
      "Поля upload должны принимать ровно 2 файла.",
      "Switch между днями/месяцами реализовать через radio + разные формы.",
      "Блок стран должен поддерживать выбор 'весь мир', скрывая список стран.",
      "Валидация must-block: нельзя переходить дальше, если обязательные поля пусты.",
      "Placeholders должны соответствовать ключам JSON."
    ],
  
    "parsed": {
      "steps": [
  
        {
          "id": "dov_input",
          "type": "input-mode",
          "title": "Доверитель",
          "input_mode_field": "dov_input_mode",
          "min": 1,
          "max": 2,
          "manual_fields": [
            { "name": "dov[0].full_name", "type": "text", "label": "ФИО" },
            { "name": "dov[0].iin", "type": "text", "label": "ИИН" },
            { "name": "dov[0].birth_date", "type": "date", "label": "Дата рождения" },
            { "name": "dov[0].address", "type": "text", "label": "Адрес" },
            { "name": "dov[0].document.type", "type": "text", "label": "Тип документа" },
            { "name": "dov[0].document.number", "type": "text", "label": "Серия/номер" },
            { "name": "dov[0].document.issued_by", "type": "text", "label": "Кем выдан" },
            { "name": "dov[0].document.issued_date", "type": "date", "label": "Дата выдачи" }
          ],
          "next": "pover_choice"
        },
  
        {
          "id": "pover_input",
          "type": "input-mode",
          "title": "Поверенный",
          "input_mode_field": "pover_input_mode",
          "min": 1,
          "max": 2,
          "manual_fields": [
            { "name": "pover[0].full_name", "type": "text", "label": "ФИО" },
            { "name": "pover[0].iin", "type": "text", "label": "ИИН" },
            { "name": "pover[0].birth_date", "type": "date", "label": "Дата рождения" },
            { "name": "pover[0].citizenship", "type": "text", "label": "Гражданство" },
            { "name": "pover[0].address", "type": "text", "label": "Адрес" },
            { "name": "pover[0].document.type", "type": "text", "label": "Тип документа" },
            { "name": "pover[0].document.number", "type": "text", "label": "Серия/номер" },
            { "name": "pover[0].document.issued_by", "type": "text", "label": "Кем выдан" },
            { "name": "pover[0].document.issued_date", "type": "date", "label": "Дата выдачи" }
          ],
          "next": "child_count"
        },
  
        {
          "id": "child_count",
          "type": "number",
          "label": "Количество детей",
          "min": 1,
          "max": 10,
          "next": "child_form"
        },
  
        {
          "id": "child_form",
          "type": "array",
          "item_label": "Ребёнок",
          "dynamicCountFrom": "child_count",
          "fields": [
            { "name": "children[].full_name", "type": "text", "label": "ФИО" },
            { "name": "children[].iin", "type": "text", "label": "ИИН" },
            { "name": "children[].birth_date", "type": "date", "label": "Дата рождения" },
            { "name": "children[].citizenship", "type": "text", "label": "Гражданство" },
            {
              "name": "children[].document.number",
              "type": "text",
              "label": "Свидетельство/паспорт №"
            }
          ],
          "next": "country_choice"
        },
  
        {
          "id": "country_choice",
          "type": "radio",
          "title": "Выбор стран",
          "options": [
            { "value": "world", "label": "Весь мир" },
            { "value": "manual", "label": "Выбрать страны вручную" }
          ],
          "next": {
            "world": "term",
            "manual": "country_list"
          }
        },
  
        {
          "id": "country_list",
          "type": "checkbox-group",
          "title": "Страны поездки",
          "options": [
            { "value": "turkey", "label": "Турция" },
            { "value": "uae", "label": "ОАЭ" },
            { "value": "georgia", "label": "Грузия" },
            { "value": "azerbaijan", "label": "Азербайджан" },
            { "value": "china", "label": "Китай" },
            { "value": "south_korea", "label": "Южная Корея" },
            { "value": "germany", "label": "Германия" }
          ],
          "validation": { "min": 1 },
          "next": "term"
        },
  
        {
          "id": "term",
          "type": "radio",
          "title": "Срок доверенности",
          "options": [
            { "value": "days", "label": "Дни" },
            { "value": "months", "label": "Месяцы" }
          ],
          "next": {
            "days": "term_days",
            "months": "term_months"
          }
        },
  
        {
          "id": "term_days",
          "type": "form",
          "fields": [
            { "name": "term.days", "type": "number", "label": "Количество дней", "min": 1, "max": 31 }
          ],
          "next": "validate"
        },
  
        {
          "id": "term_months",
          "type": "form",
          "fields": [
            { "name": "term.months", "type": "number", "label": "Количество месяцев", "min": 1, "max": 36 }
          ],
          "next": "validate"
        },
  
        {
          "id": "validate",
          "type": "validation",
          "rules": [
            "required: dov",
            "required: pover",
            "required: children",
            "required: term",
            "countries_selected >= 1"
          ],
          "next": "generate"
        },
  
        {
          "id": "generate",
          "type": "final",
          "output": "docx"
        }
      ],
  
      "placeholders": [
        "dov[].full_name",
        "dov[].iin",
        "pover[].full_name",
        "children[].full_name",
        "countries[]",
        "term.days",
        "term.months"
      ]
   }
},
{
  "id": 2,
  "code": "DOC_002",
  "title": "Сопровождение несовершеннолетнего ребенка по РК",
  "category": "Доверенности / Путешествия / Несовершеннолетние",

  "dev_notes": [
    "Доверитель — 1 или 2 родителя. Если выбрано 2, формы дублируются.",
    "У каждого доверителя должно быть поле upload для ровно 2 сканов документа.",
    "Поверенный — 1 или 2, структура идентичная доверителям (тоже 2 скана).",
    "Дети — количество от 1 до 10; генерируется массив форм.",
    "Гражданство ребёнка — опциональное поле.",
    "Маршрут — вариант 'Вся РК' (all_kz = true) скрывает выбор городов.",
    "Если 'Вся РК' НЕ выбран — пользователь должен выбрать >=1 города.",
    "Срок — два режима (дни 1–31 / месяцы 1–36).",
    "Валидация должна блокировать переход, пока не заполнено всё обязательное.",
    "Cursor обязан реализовать conditional next + dynamic array generation.",
    "Городской список должен подтягиваться из общего справочника городов."
  ],

  "rules_for_cursor": [
    "dev_notes обязательны к выполнению.",
    "Все условные блоки должны реализовываться через структуру next.",
    "Все массивы — через WizardArray.",
    "Для каждого доверителя и поверенного upload принимает ровно 2 файла.",
    "Если выбран all_kz=true — скрывать блок с городами и очищать выбранные города.",
    "Если all_kz=false — требовать минимум один город.",
    "Валидация — blocking: форма не двигается дальше.",
    "placeholders должны строго соответствовать ключам parsed.",
    "Срок реализовать как radio→form с разными полями."
  ],

  "parsed": {
    "steps": [

      {
        "id": "dov_choice",
        "type": "radio",
        "title": "Количество доверителей",
        "options": [
          { "value": 1, "label": "1 родитель" },
          { "value": 2, "label": "2 родителя" }
        ],
        "next": {
          "1": "dov1",
          "2": "dov_multi"
        }
      },

      {
        "id": "dov1",
        "type": "form",
        "title": "Доверитель 1",
        "fields": [
          { "name": "dov[0].full_name", "type": "text", "label": "ФИО" },
          { "name": "dov[0].iin", "type": "text", "label": "ИИН" },
          { "name": "dov[0].birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "dov[0].address", "type": "text", "label": "Адрес проживания/регистрации" },
          { "name": "dov[0].document.type", "type": "text", "label": "Тип документа" },
          { "name": "dov[0].document.number", "type": "text", "label": "Серия/номер документа" },
          { "name": "dov[0].document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "dov[0].document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "dov[0].phone", "type": "text", "label": "Телефон (опц.)" },
          {
            "name": "dov[0].attachments[]",
            "type": "file",
            "label": "Загрузить 2 скана документа",
            "min": 2,
            "max": 2
          }
        ],
        "next": "pover_choice"
      },

      {
        "id": "dov_multi",
        "type": "array",
        "title": "Доверители",
        "min": 2,
        "max": 2,
        "item_label": "Доверитель",
        "fields": [
          { "name": "dov[].full_name", "type": "text", "label": "ФИО" },
          { "name": "dov[].iin", "type": "text", "label": "ИИН" },
          { "name": "dov[].birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "dov[].address", "type": "text", "label": "Адрес регистрации/проживания" },
          { "name": "dov[].document.type", "type": "text", "label": "Тип документа" },
          { "name": "dov[].document.number", "type": "text", "label": "Серия/номер" },
          { "name": "dov[].document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "dov[].document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "dov[].phone", "type": "text", "label": "Телефон (опц.)" },
          {
            "name": "dov[].attachments[]",
            "type": "file",
            "label": "Загрузить 2 скана документа",
            "min": 2,
            "max": 2
          }
        ],
        "next": "pover_choice"
      },

      {
        "id": "pover_choice",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": 1, "label": "1 поверенный" },
          { "value": 2, "label": "2 поверенных" }
        ],
        "next": {
          "1": "pover1",
          "2": "pover_multi"
        }
      },

      {
        "id": "pover1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "pover[0].full_name", "type": "text", "label": "ФИО" },
          { "name": "pover[0].iin", "type": "text", "label": "ИИН (если есть)" },
          { "name": "pover[0].birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "pover[0].citizenship", "type": "text", "label": "Гражданство (опц.)" },
          { "name": "pover[0].address", "type": "text", "label": "Адрес" },
          { "name": "pover[0].document.type", "type": "text", "label": "Тип документа" },
          { "name": "pover[0].document.number", "type": "text", "label": "Серия/номер" },
          { "name": "pover[0].document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "pover[0].document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "pover[0].phone", "type": "text", "label": "Телефон (опц.)" },
          {
            "name": "pover[0].attachments[]",
            "type": "file",
            "label": "Загрузить 2 скана документа",
            "min": 2,
            "max": 2
          }
        ],
        "next": "child_count"
      },

      {
        "id": "pover_multi",
        "type": "array",
        "min": 2,
        "max": 2,
        "item_label": "Поверенный",
        "fields": [
          { "name": "pover[].full_name", "type": "text", "label": "ФИО" },
          { "name": "pover[].iin", "type": "text", "label": "ИИН (если есть)" },
          { "name": "pover[].birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "pover[].citizenship", "type": "text", "label": "Гражданство (опц.)" },
          { "name": "pover[].address", "type": "text", "label": "Адрес" },
          { "name": "pover[].document.type", "type": "text", "label": "Тип документа" },
          { "name": "pover[].document.number", "type": "text", "label": "Серия/номер" },
          { "name": "pover[].document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "pover[].document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "pover[].phone", "type": "text", "label": "Телефон (опц.)" },
          {
            "name": "pover[].attachments[]",
            "type": "file",
            "label": "Загрузить 2 скана документа",
            "min": 2,
            "max": 2
          }
        ],
        "next": "child_count"
      },

      {
        "id": "child_count",
        "type": "number",
        "label": "Количество детей",
        "min": 1,
        "max": 10,
        "next": "child_form"
      },

      {
        "id": "child_form",
        "type": "array",
        "dynamicCountFrom": "child_count",
        "item_label": "Ребёнок",
        "fields": [
          { "name": "children[].full_name", "type": "text", "label": "ФИО" },
          { "name": "children[].iin", "type": "text", "label": "ИИН" },
          { "name": "children[].birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "children[].citizenship", "type": "text", "label": "Гражданство (если нужно)" },
          { "name": "children[].document.number", "type": "text", "label": "Документ ребёнка (номер)" },
          { "name": "children[].document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "children[].document.issued_by", "type": "text", "label": "Кем выдан" }
        ],
        "next": "region_choice"
      },

      {
        "id": "region_choice",
        "type": "radio",
        "title": "Маршрут внутри РК",
        "options": [
          { "value": "all", "label": "Вся Республика Казахстан" },
          { "value": "cities", "label": "Выбрать города" }
        ],
        "next": {
          "all": "term",
          "cities": "city_list"
        }
      },

      {
        "id": "city_list",
        "type": "checkbox-group",
        "title": "Города посещения",
        "optionsFrom": "cities_kz_reference",
        "validation": { "min": 1 },
        "next": "term"
      },

      {
        "id": "term",
        "type": "radio",
        "title": "Срок доверенности",
        "options": [
          { "value": "days", "label": "Дни (1–31)" },
          { "value": "months", "label": "Месяцы (1–36)" }
        ],
        "next": {
          "days": "term_days",
          "months": "term_months"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "label": "Количество дней", "min": 1, "max": 31 }
        ],
        "next": "validate"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "label": "Количество месяцев", "min": 1, "max": 36 }
        ],
        "next": "validate"
      },

      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required: dov",
          "required: pover",
          "required: children",
          "route_valid: must_have_all_kz_or_city",
          "required: term"
        ],
        "next": "generate"
      },

      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "dov[].full_name",
      "dov[].iin",
      "pover[].full_name",
      "children[].full_name",
      "route.cities[]",
      "term.days",
      "term.months"
    ]
  }
}, 
{
  "id": 3,
  "code": "DOC_003",
  "title": "Доверенность на получение ТМЦ",
  "category": "Доверенности / Материальные ценности / ТМЦ",

  "dev_notes": [
    "Доверитель всегда один — форма не должна предлагать выбор количества.",
    "У доверителя обязательно загружаются ровно 2 скана документа.",
    "Поверенный — 1 или 2, если 2 — блоки должны дублироваться автоматически.",
    "У КАЖДОГО поверенного также обязательно 2 скана — нотариус без них не продолжает.",
    "Блок 'Где и у кого забирать' — ручной ввод, обязательные поля: наименование организации, адрес.",
    "Блок 'ТМЦ' — список позиций, минимум 1. Для каждой позиции обязательны: наименование, количество, единица измерения.",
    "Количество позиций — динамический массив WizardArray с возможностью добавлять/удалять элементы.",
    "Срок — выбор 'Дни' или 'Месяцы' с ограничениями (1–31 / 1–36).",
    "Валидация должна быть строгой: доверитель полностью, поверенный(е) полностью, 'где забирать' заполнено, ТМЦ >=1, срок корректен.",
    "Генерация формирует docx/pdf с перечислением всех товаров.",
    "Cursor обязан корректно реализовывать все динамические массивы и conditional logic."
  ],

  "rules_for_cursor": [
    "Все dev_notes обязательны к реализации.",
    "Каждый человек (доверитель/поверенный) должен иметь upload ровно из 2 файлов.",
    "Если поверенных = 2 — обязательно 2 блока с полями и 2 файлами каждый.",
    "Блок ТМЦ реализовать строгим WizardArray с min=1.",
    "Валидация — блокирующая: нельзя перейти к Generate без выполнения всех условий.",
    "Wizard должен использовать next для развилок по количеству поверенных.",
    "placeholders должны полностью совпадать с ключами в parsed → никаких лишних или несовпадающих полей.",
    "Любые numeric ограничения — встроить в схему (min/max)."
  ],

  "parsed": {
    "steps": [

      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО / наименование" },
          { "name": "principal.iin_bin", "type": "text", "label": "ИИН / БИН" },
          { "name": "principal.address", "type": "text", "label": "Адрес" },
          { "name": "principal.document.type", "type": "text", "label": "Тип документа" },
          { "name": "principal.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "principal.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "principal.position", "type": "text", "label": "Должность (если юр. лицо)" },
          { "name": "principal.phone", "type": "text", "label": "Телефон (опц.)" },
          {
            "name": "principal.attachments[]",
            "type": "file",
            "label": "Загрузить 2 скана документа доверителя",
            "min": 2,
            "max": 2
          }
        ],
        "next": "agent_choice"
      },

      {
        "id": "agent_choice",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": 1, "label": "1 поверенный" },
          { "value": 2, "label": "2 поверенных" }
        ],
        "next": {
          "1": "agent1",
          "2": "agent_multi"
        }
      },

      {
        "id": "agent1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agents[0].full_name", "type": "text", "label": "ФИО" },
          { "name": "agents[0].iin", "type": "text", "label": "ИИН" },
          { "name": "agents[0].address", "type": "text", "label": "Адрес" },
          { "name": "agents[0].document.type", "type": "text", "label": "Тип документа" },
          { "name": "agents[0].document.number", "type": "text", "label": "Серия/номер" },
          { "name": "agents[0].document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agents[0].document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agents[0].phone", "type": "text", "label": "Телефон (опц.)" },
          {
            "name": "agents[0].attachments[]",
            "type": "file",
            "label": "Загрузить 2 скана документа поверенного",
            "min": 2,
            "max": 2
          }
        ],
        "next": "where_block"
      },

      {
        "id": "agent_multi",
        "type": "array",
        "title": "Поверенные",
        "min": 2,
        "max": 2,
        "item_label": "Поверенный",
        "fields": [
          { "name": "agents[].full_name", "type": "text", "label": "ФИО" },
          { "name": "agents[].iin", "type": "text", "label": "ИИН" },
          { "name": "agents[].address", "type": "text", "label": "Адрес" },
          { "name": "agents[].document.type", "type": "text", "label": "Тип документа" },
          { "name": "agents[].document.number", "type": "text", "label": "Серия/номер" },
          { "name": "agents[].document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agents[].document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agents[].phone", "type": "text", "label": "Телефон (опц.)" },
          {
            "name": "agents[].attachments[]",
            "type": "file",
            "label": "Загрузить 2 скана документа поверенного",
            "min": 2,
            "max": 2
          }
        ],
        "next": "where_block"
      },

      {
        "id": "where_block",
        "type": "form",
        "title": "Где и у кого забирать ТМЦ",
        "fields": [
          { "name": "supplier.name", "type": "text", "label": "Наименование организации" },
          { "name": "supplier.iin_bin", "type": "text", "label": "ИИН/БИН (опц.)" },
          { "name": "supplier.address", "type": "text", "label": "Адрес склада/офиса" },
          { "name": "supplier.contract", "type": "text", "label": "Номер договора/накладной (опц.)" }
        ],
        "next": "tmc_block"
      },

      {
        "id": "tmc_block",
        "type": "array",
        "title": "Список ТМЦ",
        "min": 1,
        "item_label": "Позиция ТМЦ",
        "fields": [
          { "name": "tmc[].name", "type": "text", "label": "Наименование ТМЦ" },
          { "name": "tmc[].model", "type": "text", "label": "Марка/модель (опц.)" },
          { "name": "tmc[].qty", "type": "number", "label": "Количество", "min": 1 },
          { "name": "tmc[].unit", "type": "text", "label": "Единица измерения" },
          { "name": "tmc[].note", "type": "text", "label": "Примечание (опц.)" }
        ],
        "next": "term_choice"
      },

      {
        "id": "term_choice",
        "type": "radio",
        "title": "Срок доверенности",
        "options": [
          { "value": "days", "label": "Дни (1–31)" },
          { "value": "months", "label": "Месяцы (1–36)" }
        ],
        "next": {
          "days": "term_days",
          "months": "term_months"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "label": "Количество дней", "min": 1, "max": 31 }
        ],
        "next": "validate"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "label": "Количество месяцев", "min": 1, "max": 36 }
        ],
        "next": "validate"
      },

      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required: principal",
          "required: agents",
          "required: supplier.name",
          "required: supplier.address",
          "required_array_min: tmc, 1",
          "required: term"
        ],
        "next": "generate"
      },

      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal.full_name",
      "principal.iin_bin",
      "agents[].full_name",
      "tmc[].name",
      "tmc[].qty",
      "tmc[].unit",
      "term.days",
      "term.months"
    ]
  }
},
{
  "id": 4,
  "code": "DOC_004",
  "title": "Доверенность на управление транспортным средством",
  "category": "Доверенности / Транспорт / Управление ТС",

  "dev_notes": [
    "Доверитель — всегда один. У него обязательно 2 скана документа.",
    "Поверенный — 1 или 2. Если 2 — две формы + по 2 скана на каждого.",
    "Данные ТС — один обязательный блок. VIN или Гос. номер — обязательны.",
    "Регион действия доверенности — три независимых флага: города РК (мульти), вся РК, за пределы РК.",
    "При выборе городов — список должен быть typeahead + мультивыбор.",
    "Право передоверия — обязательный radio Да/Нет.",
    "Срок — Days (1–31) или Months (1–36). Валидация зависит от выбранного режима.",
    "Валидация строгая: обязательные поля доверителя, поверенных, ТС, срок, регион, радио передоверия.",
    "Генерация — docx/pdf с подстановкой всех выбранных регионов, срока, данных ТС и людей.",
    "Все массивы должны иметь фиксированную или динамическую структуру согласно flowchart."
  ],

  "rules_for_cursor": [
    "Требование нотариуса: КАЖДЫЙ человек должен иметь загрузку 2 сканов — без этого нельзя переходить к Generate.",
    "Список городов брать из общего справочника cities.json.",
    "При выборе 'Вся РК' — игнорировать массив городов в итоговом документе.",
    "Передоверие — обязательный radio с булевым значением.",
    "Валидации — блокирующие, не позволяют идти дальше.",
    "Все поля должны совпадать с placeholders.",
    "Список ТС — не массив, только один объект."
  ],

  "parsed": {
    "steps": [

      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО / Наименование" },
          { "name": "principal.iin_bin", "type": "text", "label": "ИИН / БИН" },
          { "name": "principal.address", "type": "text", "label": "Адрес регистрации/проживания" },
          { "name": "principal.document.type", "type": "text", "label": "Тип документа" },
          { "name": "principal.document.number", "type": "text", "label": "Серия / Номер" },
          { "name": "principal.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "principal.contact", "type": "text", "label": "Контакт" },
          {
            "name": "principal.attachments[]",
            "type": "file",
            "label": "2 скана документа доверителя",
            "min": 2,
            "max": 2
          }
        ],
        "next": "agent_choice"
      },

      {
        "id": "agent_choice",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": 1, "label": "1 поверенный" },
          { "value": 2, "label": "2 поверенных" }
        ],
        "next": {
          "1": "agent1",
          "2": "agents_multi"
        }
      },

      {
        "id": "agent1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agents[0].full_name", "type": "text", "label": "ФИО" },
          { "name": "agents[0].iin", "type": "text", "label": "ИИН (если есть)" },
          { "name": "agents[0].document.type", "type": "text", "label": "Тип документа" },
          { "name": "agents[0].document.number", "type": "text", "label": "Серия/номер" },
          { "name": "agents[0].document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agents[0].document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agents[0].address", "type": "text", "label": "Адрес" },
          { "name": "agents[0].phone", "type": "text", "label": "Телефон (опц.)" },
          {
            "name": "agents[0].attachments[]",
            "type": "file",
            "label": "2 скана документа поверенного",
            "min": 2,
            "max": 2
          }
        ],
        "next": "vehicle"
      },

      {
        "id": "agents_multi",
        "type": "array",
        "title": "Два поверенных",
        "item_label": "Поверенный",
        "min": 2,
        "max": 2,
        "fields": [
          { "name": "agents[].full_name", "type": "text", "label": "ФИО" },
          { "name": "agents[].iin", "type": "text", "label": "ИИН (если есть)" },
          { "name": "agents[].document.type", "type": "text", "label": "Тип документа" },
          { "name": "agents[].document.number", "type": "text", "label": "Серия/номер" },
          { "name": "agents[].document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agents[].document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agents[].address", "type": "text", "label": "Адрес" },
          { "name": "agents[].phone", "type": "text", "label": "Телефон (опц.)" },
          {
            "name": "agents[].attachments[]",
            "type": "file",
            "label": "2 скана документа поверенного",
            "min": 2,
            "max": 2
          }
        ],
        "next": "vehicle"
      },

      {
        "id": "vehicle",
        "type": "form",
        "title": "Данные транспортного средства",
        "fields": [
          { "name": "vehicle.type", "type": "text", "label": "Тип ТС" },
          { "name": "vehicle.brand", "type": "text", "label": "Марка" },
          { "name": "vehicle.model", "type": "text", "label": "Модель" },
          { "name": "vehicle.gov_number", "type": "text", "label": "Гос. номер" },
          { "name": "vehicle.vin", "type": "text", "label": "VIN / кузов / рама" },
          { "name": "vehicle.year", "type": "number", "label": "Год выпуска", "min": 1900, "max": 2100 },
          { "name": "vehicle.reg_doc.number", "type": "text", "label": "Серия/номер рег. документа" },
          { "name": "vehicle.reg_doc.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "vehicle.reg_doc.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "vehicle.note", "type": "text", "label": "Примечание (опц.)" }
        ],
        "next": "term_choice"
      },

      {
        "id": "term_choice",
        "type": "radio",
        "title": "Срок доверенности",
        "options": [
          { "value": "days", "label": "Дни (1–31)" },
          { "value": "months", "label": "Месяцы (1–36)" }
        ],
        "next": {
          "days": "term_days",
          "months": "term_months"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "label": "Количество дней", "min": 1, "max": 31 }
        ],
        "next": "delegation"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "label": "Количество месяцев", "min": 1, "max": 36 }
        ],
        "next": "delegation"
      },

      {
        "id": "delegation",
        "type": "radio",
        "title": "Право передоверия",
        "options": [
          { "value": true, "label": "Да" },
          { "value": false, "label": "Нет" }
        ],
        "next": "region"
      },

      {
        "id": "region",
        "type": "form",
        "title": "Где действует доверенность",
        "fields": [
          { "name": "region.cities_enabled", "type": "checkbox", "label": "Только по городам РК" },
          {
            "name": "region.cities[]",
            "type": "multiselect",
            "label": "Список городов",
            "dictionary": "cities",
            "show_if": "region.cities_enabled == true"
          },
          { "name": "region.all_kz", "type": "checkbox", "label": "Вся Республика Казахстан" },
          { "name": "region.outside", "type": "checkbox", "label": "Также за пределы РК" }
        ],
        "next": "validate"
      },

      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required: principal",
          "required: agents",
          "required: vehicle",
          "xor: region.cities_enabled || region.all_kz || region.outside",
          "required: delegation",
          "required: term"
        ],
        "next": "generate"
      },

      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal.full_name",
      "principal.iin_bin",
      "agents[].full_name",
      "vehicle.type",
      "vehicle.brand",
      "vehicle.model",
      "vehicle.gov_number",
      "vehicle.vin",
      "term.days",
      "term.months",
      "region.cities[]",
      "region.all_kz",
      "region.outside"
    ]
  }
},
{
  "id": 5,
  "code": "DOC_005",
  "title": "Доверенность на продажу транспортного средства",
  "category": "Доверенности / Транспорт / Продажа ТС",

  "dev_notes": [
    "Доверитель — всегда один. Для него обязательны 2 скана документа.",
    "Поверенный — 1 или 2. Каждый поверенный обязательно имеет 2 скана.",
    "Блок данных транспортного средства — один, обязателен. VIN или Гос. номер — обязательно хотя бы одно.",
    "Срок — переключатель Days (1–31) или Months (1–36).",
    "Право передоверия — обязательный radio Да/Нет.",
    "Объем полномочий — чекбоксы, включая флаг 'Выбрать всё'. Должен работать массовый выбор.",
    "Регион действия доверенности — три независимых флага: города РК (мультивыбор), вся РК, за пределы РК.",
    "Валидация — обязательные поля: доверитель, поверенные, ТС, срок, право передоверия, регион, полномочия (≥1).",
    "Generate формирует docx/pdf через шаблон со всеми плейсхолдерами.",
    "Все step ids должны строго совпадать с navigation flow."
  ],

  "rules_for_cursor": [
    "Каждый человек (доверитель, поверенный 1, поверенный 2) имеет ровно 2 обязательных скана.",
    "Список городов РК брать из общего файла cities.json (typeahead).",
    "Если включен флаг 'Вся РК', список городов игнорируется.",
    "Полномочия: 'Выбрать всё' должен массово отмечать все чекбоксы.",
    "Передоверие — строго required: {true|false}.",
    "Валидации должны блокировать переход к шагу generate.",
    "Документ ТС не массив — только один объект.",
    "Документ включает все выбранные полномочия и региональные ограничения."
  ],

  "parsed": {
    "steps": [

      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО" },
          { "name": "principal.iin", "type": "text", "label": "ИИН" },
          { "name": "principal.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "principal.address", "type": "text", "label": "Адрес регистрации" },
          { "name": "principal.document.type", "type": "text", "label": "Тип документа" },
          { "name": "principal.document.number", "type": "text", "label": "Серия/номер" },
          { "name": "principal.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "principal.phone", "type": "text", "label": "Телефон (опц.)" },
          {
            "name": "principal.attachments[]",
            "type": "file",
            "label": "2 скана документа доверителя",
            "min": 2,
            "max": 2
          }
        ],
        "next": "agent_choice"
      },

      {
        "id": "agent_choice",
        "type": "radio",
        "title": "Поверенный: количество",
        "options": [
          { "value": 1, "label": "1 поверенный" },
          { "value": 2, "label": "2 поверенных" }
        ],
        "next": {
          "1": "agent1",
          "2": "agents_multi"
        }
      },

      {
        "id": "agent1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agents[0].full_name", "type": "text", "label": "ФИО" },
          { "name": "agents[0].iin", "type": "text", "label": "ИИН" },
          { "name": "agents[0].birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "agents[0].address", "type": "text", "label": "Адрес" },
          { "name": "agents[0].document.type", "type": "text", "label": "Тип документа" },
          { "name": "agents[0].document.number", "type": "text", "label": "Серия/номер" },
          { "name": "agents[0].document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agents[0].document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agents[0].contact", "type": "text", "label": "Контакты" },
          {
            "name": "agents[0].attachments[]",
            "type": "file",
            "label": "2 скана документа поверенного",
            "min": 2,
            "max": 2
          }
        ],
        "next": "vehicle"
      },

      {
        "id": "agents_multi",
        "type": "array",
        "title": "Поверенные (2 человека)",
        "min": 2,
        "max": 2,
        "item_label": "Поверенный",
        "fields": [
          { "name": "agents[].full_name", "type": "text", "label": "ФИО" },
          { "name": "agents[].iin", "type": "text", "label": "ИИН" },
          { "name": "agents[].birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "agents[].address", "type": "text", "label": "Адрес" },
          { "name": "agents[].document.type", "type": "text", "label": "Тип документа" },
          { "name": "agents[].document.number", "type": "text", "label": "Серия/номер" },
          { "name": "agents[].document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agents[].document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agents[].contact", "type": "text", "label": "Контакты" },
          {
            "name": "agents[].attachments[]",
            "type": "file",
            "label": "2 скана документа",
            "min": 2,
            "max": 2
          }
        ],
        "next": "vehicle"
      },

      {
        "id": "vehicle",
        "type": "form",
        "title": "Данные транспортного средства",
        "fields": [
          { "name": "vehicle.type", "type": "text", "label": "Тип ТС" },
          { "name": "vehicle.brand", "type": "text", "label": "Марка" },
          { "name": "vehicle.model", "type": "text", "label": "Модель" },
          { "name": "vehicle.gov_number", "type": "text", "label": "Гос. номер" },
          { "name": "vehicle.vin", "type": "text", "label": "VIN / кузов / рама" },
          { "name": "vehicle.year", "type": "number", "label": "Год выпуска", "min": 1900, "max": 2100 },
          { "name": "vehicle.reg_doc.number", "type": "text", "label": "Документ регистрации — серия/номер" },
          { "name": "vehicle.reg_doc.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "vehicle.reg_doc.issued_date", "type": "date", "label": "Дата выдачи" }
        ],
        "next": "term_choice"
      },

      {
        "id": "term_choice",
        "type": "radio",
        "title": "Срок доверенности",
        "options": [
          { "value": "days", "label": "Дни (1–31)" },
          { "value": "months", "label": "Месяцы (1–36)" }
        ],
        "next": {
          "days": "term_days",
          "months": "term_months"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "label": "Количество дней", "min": 1, "max": 31 }
        ],
        "next": "delegation"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "label": "Количество месяцев", "min": 1, "max": 36 }
        ],
        "next": "delegation"
      },

      {
        "id": "delegation",
        "type": "radio",
        "title": "Право передоверия",
        "options": [
          { "value": true, "label": "Да" },
          { "value": false, "label": "Нет" }
        ],
        "next": "rights"
      },

      {
        "id": "rights",
        "type": "checkbox-group",
        "title": "Объём полномочий",
        "select_all": true,
        "options": [
          { "value": "sell_vehicle", "label": "Продавать транспортное средство" },
          { "value": "sign_sale_contract", "label": "Подписывать договор купли-продажи" },
          { "value": "submit_spetscon", "label": "Подавать документы в спецЦОН" },
          { "value": "reg_actions", "label": "Ставить/снимать ТС с регистрации" },
          { "value": "receive_money", "label": "Получать денежные средства" },
          { "value": "sign_act", "label": "Подписывать акт приёма-передачи" },
          { "value": "receive_new_plates", "label": "Получать новые номера" },
          { "value": "return_old_plates", "label": "Сдавать старые номера" },
          { "value": "receive_docs", "label": "Забирать документы из спецЦОНа" }
        ],
        "next": "region"
      },

      {
        "id": "region",
        "type": "form",
        "title": "Регион действия доверенности",
        "fields": [
          { "name": "region.cities_enabled", "type": "checkbox", "label": "Только по городам РК" },
          {
            "name": "region.cities[]",
            "type": "multiselect",
            "label": "Выберите города",
            "dictionary": "cities",
            "show_if": "region.cities_enabled == true"
          },
          { "name": "region.all_kz", "type": "checkbox", "label": "Вся Республика Казахстан" },
          { "name": "region.outside", "type": "checkbox", "label": "Также за пределы РК" }
        ],
        "next": "validate"
      },

      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required: principal",
          "required: agents",
          "required: vehicle",
          "required: rights (min 1)",
          "required: delegation",
          "xor: region.cities_enabled || region.all_kz || region.outside",
          "required: term"
        ],
        "next": "generate"
      },

      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal.full_name",
      "principal.iin",
      "agents[].full_name",
      "vehicle.type",
      "vehicle.brand",
      "vehicle.model",
      "vehicle.gov_number",
      "vehicle.vin",
      "rights[]",
      "term.days",
      "term.months",
      "region.cities[]",
      "region.all_kz",
      "region.outside"
    ]
  }
},
{
  "id": 6,
  "code": "DOC_006",
  "title": "Согласие супруга(и) на совершение сделок",
  "category": "Согласия / Семейное право / Недвижимость / Сделки",

  "dev_notes": [
    "Пользователь обязан выбрать ≥1 тип сделки (покупка, продажа, залог).",
    "Поля супруга(и), дающего согласие — обязательные, включают 2 скана документа.",
    "Получатель согласия: другой супруг, третье лицо или организация. Для вариантов 2 и 3 обязательны поля данных получателя.",
    "Если среди выбранных сделок есть операции с недвижимостью (BUY/SELL/PLEDGE), система должна автоматически открыть блок PROPERTY_TYPE.",
    "Тип объекта выбирается единственный (radio). При выборе 'Другое' появляется текстовое поле.",
    "Блок стоимости сделки: три варианта — точная сумма, диапазон, без ограничения. Ровно один вариант должен быть выбран.",
    "Срок — переключатель Days (1–31) или Months (1–36).",
    "Валидация обязательна: сделка ≥1, супруга(и) заполнены, получатель выбран, объект заполнен если требуется, срок задан, цена указана.",
    "Generate формирует .docx/.pdf с подстановкой всех выбранных параметров.",
    "Все шаги должны корректно отображаться как wizard."
  ],

  "rules_for_cursor": [
    "Сделки — мультивыбор; минимум один чекбокс должен быть выбран.",
    "Если среди сделок есть BUY, SELL или PLEDGE, автоматически показывать блок выбора объекта и его параметров.",
    "Каждый человек (супруг/супруга) имеет 2 обязательных скана.",
    "При типе сделки, не требующем недвижимости, блок PROPERTY не показывать.",
    "Цена — должна быть выбрана одна из трёх опций. При выборе диапазона min ≤ max.",
    "Срок — строго required. Показывать только одно поле в зависимости от режима Days/Months.",
    "Валидация должна блокировать generate при несоблюдении условий.",
    "Все поля, помеченные обязательными, должны строго проверяться.",
    "placeholders должны совпадать с docx-шаблонами: {{spouse.full_name}}, {{deal_types}}, {{property.type}}, {{term}}, {{price}}."
  ],

  "parsed": {
    "steps": [

      {
        "id": "txn_choice",
        "type": "checkbox-group",
        "title": "Тип сделки",
        "description": "Выберите один или несколько типов сделки",
        "options": [
          { "value": "buy", "label": "Покупка" },
          { "value": "sell", "label": "Продажа" },
          { "value": "pledge", "label": "Залог / Ипотека" }
        ],
        "min": 1,
        "next": "who_gives"
      },

      {
        "id": "who_gives",
        "type": "radio",
        "title": "Кто дает согласие",
        "options": [
          { "value": "husband", "label": "Супруг" },
          { "value": "wife", "label": "Супруга" }
        ],
        "next": "spouse_data"
      },

      {
        "id": "spouse_data",
        "type": "form",
        "title": "Данные супруга(и), дающего согласие",
        "fields": [
          { "name": "spouse.full_name", "type": "text", "label": "ФИО" },
          { "name": "spouse.iin", "type": "text", "label": "ИИН" },
          { "name": "spouse.document.type", "type": "text", "label": "Тип документа" },
          { "name": "spouse.document.number", "type": "text", "label": "Серия/номер" },
          { "name": "spouse.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "spouse.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "spouse.address", "type": "text", "label": "Адрес" },
          { "name": "spouse.contact", "type": "text", "label": "Контакт" },
          {
            "name": "spouse.attachments[]",
            "type": "file",
            "label": "2 скана документа",
            "min": 2,
            "max": 2
          }
        ],
        "next": "who_receives"
      },

      {
        "id": "who_receives",
        "type": "radio",
        "title": "Кому дается согласие",
        "options": [
          { "value": "other_spouse", "label": "Другому супругу" },
          { "value": "third_person", "label": "Третьему лицу" },
          { "value": "organization", "label": "Организации" }
        ],
        "next": {
          "other_spouse": "property_check",
          "third_person": "recipient_data",
          "organization": "recipient_data"
        }
      },

      {
        "id": "recipient_data",
        "type": "form",
        "title": "Данные получателя согласия",
        "fields": [
          { "name": "recipient.full_name", "type": "text", "label": "ФИО/Наименование" },
          { "name": "recipient.iin_bin", "type": "text", "label": "ИИН/БИН" },
          { "name": "recipient.document", "type": "text", "label": "Документ / реквизиты" },
          { "name": "recipient.contact", "type": "text", "label": "Контакт" }
        ],
        "next": "property_check"
      },

      {
        "id": "property_check",
        "type": "condition",
        "expression": "txn_choice includes 'buy' || txn_choice includes 'sell' || txn_choice includes 'pledge'",
        "next_if_true": "property_type",
        "next_if_false": "term_choice"
      },

      {
        "id": "property_type",
        "type": "radio",
        "title": "Тип объекта недвижимости",
        "options": [
          { "value": "flat", "label": "Квартира" },
          { "value": "house", "label": "Жилой дом" },
          { "value": "land", "label": "Земельный участок" },
          { "value": "share", "label": "Доля / участие" },
          { "value": "parking", "label": "Паркинг / Машиноместо" },
          { "value": "commercial", "label": "Нежилое помещение" },
          { "value": "other", "label": "Другое" }
        ],
        "next": {
          "other": "property_other",
          "*": "property_details"
        }
      },

      {
        "id": "property_other",
        "type": "form",
        "title": "Ваш вариант объекта",
        "fields": [
          { "name": "property.other_text", "type": "text", "label": "Описание объекта" }
        ],
        "next": "property_details"
      },

      {
        "id": "property_details",
        "type": "form",
        "title": "Данные по объекту",
        "fields": [
          { "name": "property.address", "type": "text", "label": "Адрес" },
          { "name": "property.cadastral_number", "type": "text", "label": "Кадастровый номер" },
          { "name": "property.docs", "type": "text", "label": "Правоустанавливающие документы" },
          { "name": "property.details", "type": "textarea", "label": "Примечание / доп. сведения" }
        ],
        "next": "term_choice"
      },

      {
        "id": "term_choice",
        "type": "radio",
        "title": "Срок действия согласия",
        "options": [
          { "value": "days", "label": "Дни (1–31)" },
          { "value": "months", "label": "Месяцы (1–36)" }
        ],
        "next": {
          "days": "term_days",
          "months": "term_months"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "label": "Количество дней", "min": 1, "max": 31 }
        ],
        "next": "price_choice"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "label": "Количество месяцев", "min": 1, "max": 36 }
        ],
        "next": "price_choice"
      },

      {
        "id": "price_choice",
        "type": "radio",
        "title": "Цена сделки / ограничения",
        "options": [
          { "value": "exact", "label": "Указать сумму" },
          { "value": "open", "label": "По усмотрению / без ограничения" },
          { "value": "range", "label": "Диапазон" }
        ],
        "next": {
          "exact": "price_exact",
          "open": "validate",
          "range": "price_range"
        }
      },

      {
        "id": "price_exact",
        "type": "form",
        "fields": [
          { "name": "price.amount", "type": "number", "label": "Сумма" },
          { "name": "price.currency", "type": "text", "label": "Валюта" },
          { "name": "price.conditions", "type": "textarea", "label": "Доп. условия" }
        ],
        "next": "validate"
      },

      {
        "id": "price_range",
        "type": "form",
        "fields": [
          { "name": "price.min", "type": "number", "label": "Мин. сумма" },
          { "name": "price.max", "type": "number", "label": "Макс. сумма" },
          { "name": "price.currency", "type": "text", "label": "Валюта" }
        ],
        "next": "validate"
      },

      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required: txn_choice (min 1)",
          "required: spouse.full_name",
          "required: who_receives",
          "required_if property needed: property",
          "required: term",
          "required: price_choice"
        ],
        "next": "generate"
      },

      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "txn_choice[]",
      "spouse.full_name",
      "spouse.iin",
      "recipient.full_name",
      "property.type",
      "property.address",
      "property.cadastral_number",
      "term.days",
      "term.months",
      "price.amount",
      "price.min",
      "price.max",
      "price.currency"
    ]
  }
},
{
  "id": 7,
  "code": "DOC_007",
  "title": "Доверенность на получение документов",
  "category": "Доверенности / Получение документов / Органы РК",

  "dev_notes": [
    "Доверитель всегда один — 2 обязательных скана.",
    "Поверенный может быть 1 или 2. На каждого — 2 скана.",
    "Срок выбирается: дни (1–31) или месяцы (1–36).",
    "Пользователь должен выбрать хотя бы одну группу документов.",
    "После выбора группы должны появляться подпункты (чекбоксы).",
    "В подпунктах обязательно иметь чекбокс 'Выбрать всё'.",
    "Места получения — множественный выбор + чекбокс 'Выбрать все учреждения'.",
    "Валидация должна блокировать Generate, если: доверитель не заполнен, поверенный(е) не заполнены, нет срока, не выбрана ни одна группа, нет подпунктов, не выбрано место получения.",
    "Для подпункта 'Прочие' обязателен ручной ввод.",
    "При генерации в документ вставляются списки категорий, подпунктов и учреждений."
  ],

  "rules_for_cursor": [
    "Показывать группы документов как компактный список из 8 чекбоксов.",
    "При выборе группы — раскрывать подпункты с чекбоксами.",
    "В блоке подпунктов всегда должен быть чекбокс 'Выбрать всё', который активирует все подпункты.",
    "Если пользователь выбрал несколько групп — показывать несколько раскрытых списков подпунктов.",
    "Все люди (доверитель, поверенный(е)) должны иметь обязательную загрузку 2 сканов.",
    "Места получения — множественный выбор + чекбокс 'Все учреждения'.",
    "Если включено 'Все учреждения' — список выбранных учреждений игнорируется.",
    "Валидационные сообщения — под соответствующими полями.",
    "placeholders документа должны иметь удобные имена: {{principal.full_name}}, {{agents}}, {{groups}}, {{subitems}}, {{institutions}}, {{term}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — Principal */
      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО" },
          { "name": "principal.iin", "type": "text", "label": "ИИН" },
          { "name": "principal.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "principal.address", "type": "text", "label": "Адрес" },
          { "name": "principal.document.type", "type": "text", "label": "Тип документа" },
          { "name": "principal.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "principal.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.document.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "principal.attachments[]",
            "type": "file",
            "label": "Сканы документа доверителя",
            "min": 2,
            "max": 2
          }
        ],
        "next": "agent_choice"
      },

      /* STEP 2 — Agent count */
      {
        "id": "agent_choice",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": "1", "label": "1 поверенный" },
          { "value": "2", "label": "2 поверенных" }
        ],
        "next": {
          "1": "agent_1",
          "2": "agent_1"
        }
      },

      /* STEP 3 — AGENT 1 */
      {
        "id": "agent_1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agent1.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent1.iin", "type": "text", "label": "ИИН" },
          { "name": "agent1.address", "type": "text", "label": "Адрес" },
          { "name": "agent1.document.type", "type": "text", "label": "Тип документа" },
          { "name": "agent1.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "agent1.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent1.document.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "agent1.attachments[]",
            "type": "file",
            "label": "Сканы документа поверенного 1",
            "min": 2,
            "max": 2
          }
        ],
        "next": {
          "default": "agent_2_or_next"
        }
      },

      /* STEP 4 — AGENT 2 (optional) */
      {
        "id": "agent_2_or_next",
        "type": "condition",
        "expression": "agent_choice == '2'",
        "next_if_true": "agent_2",
        "next_if_false": "term"
      },

      {
        "id": "agent_2",
        "type": "form",
        "title": "Поверенный 2",
        "fields": [
          { "name": "agent2.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent2.iin", "type": "text", "label": "ИИН" },
          { "name": "agent2.address", "type": "text", "label": "Адрес" },
          { "name": "agent2.document.type", "type": "text", "label": "Тип документа" },
          { "name": "agent2.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "agent2.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent2.document.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "agent2.attachments[]",
            "type": "file",
            "label": "Сканы документа поверенного 2",
            "min": 2,
            "max": 2
          }
        ],
        "next": "term"
      },

      /* STEP 5 — Term */
      {
        "id": "term",
        "type": "radio",
        "title": "Срок доверенности",
        "options": [
          { "value": "days", "label": "Дни (1–31)" },
          { "value": "months", "label": "Месяцы (1–36)" }
        ],
        "next": {
          "days": "term_days",
          "months": "term_months"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "min": 1, "max": 31, "label": "Количество дней" }
        ],
        "next": "doc_groups"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "min": 1, "max": 36, "label": "Количество месяцев" }
        ],
        "next": "doc_groups"
      },

      /* STEP 6 — Groups */
      {
        "id": "doc_groups",
        "type": "checkbox-group",
        "title": "Группы документов",
        "options": [
          { "value": "tax", "label": "Документы из налоговых органов" },
          { "value": "medical", "label": "Документы медучреждений" },
          { "value": "employer", "label": "Документы работодателя" },
          { "value": "transport", "label": "Документы по транспорту" },
          { "value": "real_estate", "label": "Документы недвижимости" },
          { "value": "bank", "label": "Банковские документы" },
          { "value": "court", "label": "Судебные/юридические документы" },
          { "value": "other", "label": "Прочие" }
        ],
        "min": 1,
        "next": "suboptions"
      },

      /* STEP 7 — Suboptions */
      {
        "id": "suboptions",
        "type": "dynamic-subgroups",
        "groups_source": "doc_groups",
        "subgroups": {
          "tax": [
            "Справка о задолженности",
            "Справки по налогам",
            "Выписка по счету КГД"
          ],
          "medical": [
            "Медицинская справка",
            "Выписка из медкарты",
            "Справка для органов"
          ],
          "employer": [
            "Справка о заработной плате",
            "Справка о месте работы",
            "Характеристика"
          ],
          "transport": [
            "Техпаспорт",
            "Свидетельство о регистрации ТС",
            "Дубликат номера"
          ],
          "real_estate": [
            "Технический паспорт",
            "Кадастровая выписка",
            "Справка о праве собственности"
          ],
          "bank": [
            "Выписка по счету",
            "Справка о остатке",
            "Справка по депозиту"
          ],
          "court": [
            "Решение суда",
            "Исполнительный лист",
            "Копия судебного акта"
          ],
          "other": [
            { "type": "text", "placeholder": "Введите свой вариант документа" }
          ]
        },
        "has_select_all": true,
        "next": "institutions"
      },

      /* STEP 8 — Institutions */
      {
        "id": "institutions",
        "type": "checkbox-group",
        "title": "Где получать документы",
        "options": [
          { "value": "tsone", "label": "ЦОН / СпецЦОН" },
          { "value": "bank", "label": "Банк" },
          { "value": "enpf", "label": "ЕНПФ" },
          { "value": "court", "label": "Суд" },
          { "value": "kgd", "label": "Налоговый комитет (КГД)" },
          { "value": "medical_org", "label": "Поликлиника / Больница" },
          { "value": "employer", "label": "Работодатель" },
          { "value": "archive", "label": "Архив" },
          { "value": "post", "label": "Казпочта" },
          { "value": "other", "label": "Другое (ручной ввод)" }
        ],
        "extra": {
          "select_all": true,
          "manual_input_key": "institution_custom"
        },
        "min": 1,
        "next": "validate"
      },

      /* STEP 9 — Validation */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required agent1.full_name",
          "required term",
          "required doc_groups (min 1)",
          "required suboptions (at least one selected in all chosen groups)",
          "required institutions (or select_all)"
        ],
        "next": "generate"
      },

      /* STEP 10 — Generate */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal.full_name",
      "principal.iin",
      "agent1.full_name",
      "agent2.full_name",
      "doc_groups[]",
      "suboptions[]",
      "institutions[]",
      "term.days",
      "term.months"
    ]
  }
},
{
  "id": 8,
  "code": "DOC_008",
  "title": "Доверенность на получение пособий",
  "category": "Доверенности / Пособия / Социальная защита",

  "dev_notes": [
    "Доверитель — всегда один. На него прикрепляется 2 обязательных скана.",
    "Поверенных может быть 1 или 2. На каждого — 2 обязательных скана.",
    "Пособия представлены категориями. Пользователь должен выбрать как минимум одну категорию.",
    "Под каждой категорией — собственный список подпунктов (чекбоксы).",
    "Если избранный подпункт требует указания ребёнка/инвалида, должен появляться соответствующий блок.",
    "Место получения — множественный выбор + чекбокс 'Выбрать всё учреждения'.",
    "Права поверенного — чекбоксы, обязательно ≥1 галочка.",
    "Тип выплаты — чекбоксы: разовая, ежемесячная, обе.",
    "Ограничение по сумме — либо «без ограничений», либо ввод суммы/диапазона.",
    "Блок 'Лично / по доверенности' — если по доверенности, обязательны реквизиты исходной доверенности.",
    "Генерация .docx — вставлять данные доверителя, поверенного(ых), категории, подпункты, данные ребёнка, места получения, права, ограничение по сумме, срок, данные исходной доверенности."
  ],

  "rules_for_cursor": [
    "Везде где есть люди (доверитель, поверенные), обязателен блок загрузки 2 сканов.",
    "Категории пособий показывать чекбоксами. При выборе хотя бы одной — переход разрешён.",
    "Подпункты должны отображаться динамически только для выбранных категорий.",
    "В подпунктах обязателен чекбокс 'Выбрать все'.",
    "Если выбран подпункт, требующий данных ребёнка/инвалида — показывать отдельный блок.",
    "Места получения — мультивыбор + 'Все учреждения'. При 'Все учреждения' список игнорируется.",
    "Права поверенного — чекбоксы + 'Выбрать всё'.",
    "Типы выплат — чекбоксы. Можно выбрать одну или несколько.",
    "Если ограничение по сумме = Да — показывать поля суммы/диапазона.",
    "Если выбран вариант 'По доверенности' — показывать обязательные реквизиты исходной доверенности.",
    "Все валидации должны блокировать кнопку Generate."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — Доверитель */
      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО" },
          { "name": "principal.iin", "type": "text", "label": "ИИН" },
          { "name": "principal.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "principal.address", "type": "text", "label": "Адрес" },
          { "name": "principal.document.type", "type": "text", "label": "Тип документа" },
          { "name": "principal.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "principal.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.document.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "principal.attachments[]",
            "type": "file",
            "min": 2,
            "max": 2,
            "label": "2 обязательных скана доверителя"
          }
        ],
        "next": "agent_choice"
      },

      /* STEP 2 — количество поверенных */
      {
        "id": "agent_choice",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": "1", "label": "1 поверенный" },
          { "value": "2", "label": "2 поверенных" }
        ],
        "next": {
          "1": "agent1",
          "2": "agent1"
        }
      },

      /* STEP 3 — Поверенный 1 */
      {
        "id": "agent1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agent1.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent1.iin", "type": "text", "label": "ИИН" },
          { "name": "agent1.address", "type": "text", "label": "Адрес" },
          { "name": "agent1.document.type", "type": "text", "label": "Тип документа" },
          { "name": "agent1.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "agent1.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent1.document.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "agent1.attachments[]",
            "type": "file",
            "label": "2 обязательных скана поверенного 1",
            "min": 2,
            "max": 2
          }
        ],
        "next": "agent2_or_categories"
      },

      /* STEP 4 — условный второй поверенный */
      {
        "id": "agent2_or_categories",
        "type": "condition",
        "expression": "agent_choice == '2'",
        "next_if_true": "agent2",
        "next_if_false": "benefit_categories"
      },

      {
        "id": "agent2",
        "type": "form",
        "title": "Поверенный 2",
        "fields": [
          { "name": "agent2.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent2.iin", "type": "text", "label": "ИИН" },
          { "name": "agent2.address", "type": "text", "label": "Адрес" },
          { "name": "agent2.document.type", "type": "text", "label": "Тип документа" },
          { "name": "agent2.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "agent2.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent2.document.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "agent2.attachments[]",
            "type": "file",
            "min": 2,
            "max": 2,
            "label": "2 обязательных скана поверенного 2"
          }
        ],
        "next": "benefit_categories"
      },

      /* STEP 5 — категории пособий */
      {
        "id": "benefit_categories",
        "type": "checkbox-group",
        "title": "Виды пособий",
        "options": [
          { "value": "social", "label": "Социальные" },
          { "value": "pension", "label": "Пенсии / ЕНПФ" },
          { "value": "lost_breadwinner", "label": "Пособие по потере кормильца" },
          { "value": "disability", "label": "Инвалидность / уход" },
          { "value": "ssf", "label": "Фонд соц. страхования" },
          { "value": "other", "label": "Прочие" }
        ],
        "min": 1,
        "next": "benefit_subitems"
      },

      /* STEP 6 — подпункты по категориям */
      {
        "id": "benefit_subitems",
        "type": "dynamic-subgroups",
        "groups_source": "benefit_categories",
        "subgroups": {
          "social": [
            "Пособие по беременности и родам",
            "Пособие по уходу за ребёнком",
            "Социальная помощь"
          ],
          "pension": [
            "Выписки ЕНПФ",
            "Сведения о пенсионных отчислениях"
          ],
          "lost_breadwinner": [
            "Назначение пособия",
            "Продление пособия"
          ],
          "disability": [
            "Пособие по инвалидности",
            "Пособие по уходу за инвалидом"
          ],
          "ssf": [
            "Выписки ФСС",
            "Назначение выплат"
          ],
          "other": [
            { "type": "text", "placeholder": "Укажите свой вариант" }
          ]
        },
        "has_select_all": true,
        "next": "child_condition"
      },

      /* STEP 7 — условный блок ребёнка/инвалида */
      {
        "id": "child_condition",
        "type": "condition",
        "expression": "benefit_subitems contains any of ['Пособие по уходу за ребёнком', 'Пособие по инвалидности', 'Пособие по уходу за инвалидом']",
        "next_if_true": "child_block",
        "next_if_false": "where_get"
      },

      {
        "id": "child_block",
        "type": "form",
        "title": "Данные ребёнка / инвалида",
        "fields": [
          { "name": "child.full_name", "type": "text", "label": "ФИО" },
          { "name": "child.iin", "type": "text", "label": "ИИН" },
          { "name": "child.birth_date", "type": "date", "label": "Дата рождения" },
          {
            "name": "child.disability_group",
            "type": "text",
            "label": "Группа инвалидности (если применимо)"
          },
          { "name": "child.document.type", "type": "text", "label": "Тип документа" },
          { "name": "child.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "child.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "child.document.issued_date", "type": "date", "label": "Дата выдачи" }
        ],
        "next": "where_get"
      },

      /* STEP 8 — где получать */
      {
        "id": "where_get",
        "type": "checkbox-group",
        "title": "Где получать документы",
        "options": [
          { "value": "gcvp", "label": "ГЦВП / Центр выплат" },
          { "value": "ssf", "label": "Фонд соц. страхования" },
          { "value": "enpf", "label": "ЕНПФ" },
          { "value": "akimat", "label": "Акимат / УСЗН" },
          { "value": "bank", "label": "Банк" },
          { "value": "post", "label": "Почта / Казпочта" },
          { "value": "other", "label": "Другое (ввод)" }
        ],
        "extra": {
          "select_all": true,
          "manual_input_key": "where_custom"
        },
        "min": 1,
        "next": "rights"
      },

      /* STEP 9 — права поверенного */
      {
        "id": "rights",
        "type": "checkbox-group",
        "title": "Права поверенного",
        "options": [
          { "value": "payments", "label": "Получать денежные выплаты" },
          { "value": "sign_docs", "label": "Подписывать заявления/документы" },
          { "value": "submit_apps", "label": "Подавать заявления" },
          { "value": "notifications", "label": "Получать уведомления" },
          { "value": "open_account", "label": "Открывать/управлять счетом для выплат" }
        ],
        "has_select_all": true,
        "min": 1,
        "next": "payment_type"
      },

      /* STEP 10 — типы выплат */
      {
        "id": "payment_type",
        "type": "checkbox-group",
        "title": "Типы выплат",
        "options": [
          { "value": "one_time", "label": "Разовая" },
          { "value": "monthly", "label": "Ежемесячная" },
          { "value": "both", "label": "Обе" }
        ],
        "min": 1,
        "next": "amount_limit"
      },

      /* STEP 11 — ограничения по сумме */
      {
        "id": "amount_limit",
        "type": "radio",
        "title": "Ограничение по сумме?",
        "options": [
          { "value": "no", "label": "Нет" },
          { "value": "yes", "label": "Да" }
        ],
        "next": {
          "no": "appears_requester",
          "yes": "amount_value"
        }
      },

      {
        "id": "amount_value",
        "type": "form",
        "title": "Сумма / диапазон",
        "fields": [
          { "name": "amount.min", "type": "number", "label": "Минимум (опц.)" },
          { "name": "amount.max", "type": "number", "label": "Максимум (опц.)" },
          { "name": "amount.currency", "type": "text", "label": "Валюта" }
        ],
        "next": "appears_requester"
      },

      /* STEP 12 — Лично / по доверенности */
      {
        "id": "appears_requester",
        "type": "radio",
        "title": "Кто пришёл?",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "next": {
          "personal": "validate",
          "poa": "poa_details"
        }
      },

      {
        "id": "poa_details",
        "type": "form",
        "title": "Реквизиты исходной доверенности",
        "fields": [
          { "name": "poa.registry_number", "type": "text", "label": "Реестровый номер" },
          { "name": "poa.notary_name", "type": "text", "label": "Кем выдана" },
          { "name": "poa.date", "type": "date", "label": "Дата выдачи доверенности" },
          { "name": "poa.license_number", "type": "text", "label": "Номер лицензии нотариуса" },
          { "name": "poa.license_date", "type": "date", "label": "Дата выдачи лицензии" },
          { "name": "poa.license_issued_by", "type": "text", "label": "Кем выдана лицензия" }
        ],
        "next": "validate"
      },

      /* STEP 13 — Валидация */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required agent1.full_name",
          "required benefit_categories (min 1)",
          "required rights (min 1)",
          "required payment_type (min 1)",
          "if appears_requester == 'poa' → required poa.registry_number"
        ],
        "next": "generate"
      },

      /* STEP 14 — Генерация */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal.full_name",
      "principal.iin",
      "agent1.full_name",
      "agent2.full_name",
      "benefit_categories[]",
      "benefit_subitems[]",
      "child.full_name",
      "where_get[]",
      "rights[]",
      "payment_type[]",
      "amount.min",
      "amount.max",
      "amount.currency",
      "poa.registry_number",
      "term"
    ]
  }
},
{
  "id": 9,
  "code": "DOC_009",
  "title": "Доверенность — представление интересов в суде",
  "category": "Доверенности / Суд / Юридическое представительство",

  "dev_notes": [
    "Доверитель — всегда один. Требуется загрузка 2 обязательных сканов.",
    "Поверенных может быть 1 или 2. На каждого — 2 обязательных скана.",
    "Тип суда — мультивыбор, обязателен ≥1 пункт, обязательно наличие чекбокса 'Выбрать всё'.",
    "Тип дела — чекбоксы, также обязателен ≥1 пункт, также 'Выбрать всё'.",
    "Предмет дела — обязательный текстовый ввод.",
    "Полномочия представлены списком чекбоксов, разделены на стандартные и расширенные. Требуется ≥1.",
    "Органы взаимодействия также чекбокс-группа, требуется ≥1, обязательно 'Выбрать всё'.",
    "Материальные полномочия — чекбоксы, необязательно, но должны быть корректно вставлены.",
    "Право передоверия — radio required.",
    "Срок выбирается: дни (1–31) или месяцы (1–36).",
    "Если пользователь выбирает 'По доверенности', показывать обязательный блок реквизитов исходной доверенности.",
    "Валидация: без заполнения обязательных полей кнопка Generate недоступна.",
    "Шаблон документа подставляет все выбранные опции в структурированном виде."
  ],

  "rules_for_cursor": [
    "Обязательные люди (доверитель, поверенные) должны иметь блок загрузки 2 сканов каждый.",
    "Тип суда показывать списком чекбоксов + чекбокс '[Выбрать всё]'.",
    "Тип дела — чекбоксы + чекбокс '[Выбрать всё]'.",
    "Предмет дела — обязательное текстовое поле.",
    "Полномочия — чекбоксы в двух секциях (стандартные / расширенные) + чекбокс 'Выбрать всё полномочия'.",
    "Органы взаимодействия — чекбоксы + 'Выбрать всё органы'.",
    "Материальные полномочия — чекбоксы с 'Выбрать всё мат. права'.",
    "Если выбран 'По доверенности', обязательные поля для реквизитов исходной доверенности должны быть показаны.",
    "Валидация обязательных полей блокирует Generate.",
    "placeholders должны иметь читабельные ключи: {{principal.full_name}}, {{agents}}, {{courts}}, {{case_types}}, {{powers}}, {{orgs}}, {{material_rights}}, {{term}}, {{poa}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — PRINCIPAL */
      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО / Наименование" },
          { "name": "principal.iin_bin", "type": "text", "label": "ИИН / БИН" },
          { "name": "principal.address", "type": "text", "label": "Адрес" },
          { "name": "principal.document.type", "type": "text", "label": "Тип документа" },
          { "name": "principal.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "principal.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "principal.contact", "type": "text", "label": "Контакт (тел./email)" },
          {
            "name": "principal.attachments[]",
            "type": "file",
            "min": 2,
            "max": 2,
            "label": "Сканы документа доверителя (2 файла)"
          }
        ],
        "next": "agent_choice"
      },

      /* STEP 2 — Number of agents */
      {
        "id": "agent_choice",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": "1", "label": "1 поверенный" },
          { "value": "2", "label": "2 поверенных" }
        ],
        "next": {
          "1": "agent1",
          "2": "agent1"
        }
      },

      /* STEP 3 — AGENT 1 */
      {
        "id": "agent1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agent1.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent1.iin", "type": "text", "label": "ИИН" },
          { "name": "agent1.document.type", "type": "text", "label": "Тип документа" },
          { "name": "agent1.document.number", "type": "text", "label": "Серия/номер" },
          { "name": "agent1.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent1.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agent1.address", "type": "text", "label": "Адрес" },
          { "name": "agent1.contact", "type": "text", "label": "Контакт" },
          {
            "name": "agent1.attachments[]",
            "type": "file",
            "label": "Сканы поверенного 1 (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "agent2_cond"
      },

      /* STEP 4 — optional AGENT 2 */
      {
        "id": "agent2_cond",
        "type": "condition",
        "expression": "agent_choice == '2'",
        "next_if_true": "agent2",
        "next_if_false": "court_types"
      },

      {
        "id": "agent2",
        "type": "form",
        "title": "Поверенный 2",
        "fields": [
          { "name": "agent2.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent2.iin", "type": "text", "label": "ИИН" },
          { "name": "agent2.document.type", "type": "text", "label": "Тип документа" },
          { "name": "agent2.document.number", "type": "text", "label": "Серия/номер" },
          { "name": "agent2.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent2.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agent2.address", "type": "text", "label": "Адрес" },
          { "name": "agent2.contact", "type": "text", "label": "Контакт" },
          {
            "name": "agent2.attachments[]",
            "type": "file",
            "label": "Сканы поверенного 2 (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "court_types"
      },

      /* STEP 5 — COURT TYPES */
      {
        "id": "court_types",
        "type": "checkbox-group",
        "title": "Тип суда",
        "options": [
          { "value": "district", "label": "Районный / Городской" },
          { "value": "regional", "label": "Областной" },
          { "value": "supreme", "label": "Верховный Суд" },
          { "value": "administrative", "label": "Административный" },
          { "value": "economic", "label": "Экономический / Арбитраж" },
          { "value": "specialized", "label": "Специализированный" }
        ],
        "has_select_all": true,
        "min": 1,
        "next": "case_types"
      },

      /* STEP 6 — CASE TYPES */
      {
        "id": "case_types",
        "type": "checkbox-group",
        "title": "Тип дела",
        "options": [
          { "value": "civil", "label": "Гражданское" },
          { "value": "administrative", "label": "Административное" },
          { "value": "criminal", "label": "Уголовное (огранич.)" },
          { "value": "economic", "label": "Экономическое" },
          { "value": "family", "label": "Семейное" },
          { "value": "enforcement", "label": "Исполнительное производство" },
          { "value": "appeals", "label": "Апелляции / Кассации" }
        ],
        "has_select_all": true,
        "min": 1,
        "next": "subject"
      },

      /* STEP 7 — SUBJECT */
      {
        "id": "subject",
        "type": "form",
        "title": "Предмет дела",
        "fields": [
          { "name": "subject.text", "type": "textarea", "label": "Описание предмета дела" }
        ],
        "required": true,
        "next": "powers"
      },

      /* STEP 8 — POWERS */
      {
        "id": "powers",
        "type": "checkbox-group",
        "title": "Полномочия поверенного",
        "sections": {
          "standard": [
            "Представлять интересы в судах выбранных уровней",
            "Заявлять иски и возражения",
            "Участвовать в заседаниях",
            "Знакомиться с материалами дела",
            "Снимать копии с материалов дела",
            "Пода⟨вать ходатайства",
            "Получать повестки и документы",
            "Заключать мировые соглашения"
          ],
          "extended": [
            "Подавать апелляции / кассации / надзор",
            "Подписывать и изменять иски",
            "Получать исполнительный лист",
            "Получать / распоряжаться денежными средствами"
          ]
        },
        "has_select_all": true,
        "min": 1,
        "next": "authorities"
      },

      /* STEP 9 — AUTHORITIES */
      {
        "id": "authorities",
        "type": "checkbox-group",
        "title": "Органы взаимодействия",
        "options": [
          { "value": "court", "label": "Суд" },
          { "value": "enforcement", "label": "Исполнительная служба" },
          { "value": "prosecutor", "label": "Прокуратура" },
          { "value": "police", "label": "Полиция / МВД" },
          { "value": "bank", "label": "Банк" },
          { "value": "registrars", "label": "Регистраторы / ЦОН" },
          { "value": "other", "label": "Прочие госорганы" }
        ],
        "has_select_all": true,
        "min": 1,
        "next": "material_rights"
      },

      /* STEP 10 — MATERIAL RIGHTS */
      {
        "id": "material_rights",
        "type": "checkbox-group",
        "title": "Материальные полномочия",
        "options": [
          { "value": "state_fee", "label": "Оплачивать госпошлины" },
          { "value": "money_receive", "label": "Получать / распоряжаться денежными средствами" },
          { "value": "agreements", "label": "Подписывать соглашения с финансовыми условиями" }
        ],
        "has_select_all": true,
        "min": 0,
        "next": "delegation"
      },

      /* STEP 11 — Delegation */
      {
        "id": "delegation",
        "type": "radio",
        "title": "Право передоверия",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "required": true,
        "next": "term"
      },

      /* STEP 12 — Term */
      {
        "id": "term",
        "type": "radio",
        "title": "Срок доверенности",
        "options": [
          { "value": "days", "label": "Дни (1–31)" },
          { "value": "months", "label": "Месяцы (1–36)" }
        ],
        "next": {
          "days": "term_days",
          "months": "term_months"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "min": 1, "max": 31, "label": "Количество дней" }
        ],
        "next": "appearance"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "min": 1, "max": 36, "label": "Количество месяцев" }
        ],
        "next": "appearance"
      },

      /* STEP 13 — appearance */
      {
        "id": "appearance",
        "type": "radio",
        "title": "Обращение",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "next": {
          "personal": "validate",
          "poa": "poa_details"
        }
      },

      /* STEP 14 — POA DETAILS */
      {
        "id": "poa_details",
        "type": "form",
        "title": "Реквизиты исходной доверенности",
        "fields": [
          { "name": "poa.registry_number", "type": "text", "label": "Реестровый номер" },
          { "name": "poa.notary_name", "type": "text", "label": "Кем выдана" },
          { "name": "poa.issue_date", "type": "date", "label": "Дата выдачи доверенности" },
          { "name": "poa.license_number", "type": "text", "label": "Номер лицензии нотариуса" },
          { "name": "poa.license_date", "type": "date", "label": "Дата выдачи лицензии" },
          { "name": "poa.license_issued_by", "type": "text", "label": "Кем выдана лицензия" }
        ],
        "next": "validate"
      },

      /* STEP 15 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required agent1.full_name",
          "required court_types (min 1)",
          "required case_types (min 1)",
          "required subject.text",
          "required powers (min 1)",
          "required authorities (min 1)",
          "required delegation",
          "required term",
          "if appearance == 'poa' → required poa.registry_number"
        ],
        "next": "generate"
      },

      /* STEP 16 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal.full_name",
      "principal.iin_bin",
      "agent1.full_name",
      "agent2.full_name",
      "court_types[]",
      "case_types[]",
      "subject.text",
      "powers[]",
      "authorities[]",
      "material_rights[]",
      "delegation",
      "term.days",
      "term.months",
      "poa.registry_number"
    ]
  }
}, 
{
  "id": 10,
  "code": "DOC_010",
  "title": "Доверенность — банковские операции (физлица)",
  "category": "Доверенности / Банковские операции / Финансы",

  "dev_notes": [
    "Доверитель — всегда 1. Обязательны 2 скана документа личности.",
    "Поверенных может быть 1 или 2. На каждого поверенного — также 2 обязательных скана.",
    "Выбор банков — через typeahead + мультивыбор. Есть верхний чекбокс 'Выбрать всё банки'.",
    "После выбора банка создаётся карточка банка с полями: филиал, счёт, валюта, флаги use_for_statements/use_for_cash_withdraw.",
    "Если выбран select_all_banks=true → необходимо автоматически создать карточки для всех банков.",
    "Некоторые операции требуют обязательного наличия банковского счёта (например: снятие наличных, получение выписки).",
    "Операции — чекбоксы + верхний чекбокс 'Выбрать всё операции'.",
    "Лимиты по суммам — если выбрана опция 'Да', появляются поля разового лимита, суммарного лимита и валюты.",
    "Блок 'Требования к документам' поддерживает чекбоксы + произвольный текст.",
    "Срок — переключатель Days/Months (1–31 / 1–36).",
    "Право передоверия — radio required.",
    "Валидация — строгая: не даём нажать Generate, пока не заполнены обязательные поля.",
    "При генерации документа нужно собрать в массив все банки, их карточки, операции, ограничения, срок, право передоверия."
  ],

  "rules_for_cursor": [
    "Всегда показывать обязательный блок загрузки 2 сканов либо для доверителя, либо для каждого поверенного.",
    "Мультивыбор банков должен создавать динамические карточки ‘bank_card’ для каждого банка.",
    "Если выбран чекбокс 'Выбрать всё банки', Cursor обязан создать карточки по всем банкам из справочника.",
    "Если выбрана операция, требующая счёта, и нет ни одной карточки с account_number — показывать ошибку.",
    "Операции должны иметь верхний чекбокс 'Выбрать всё операции'.",
    "Лимиты — если выбран 'Да', поля лимитов становятся обязательными.",
    "Срок — обязательный выбор между днями и месяцами, с соответствующим диапазоном.",
    "Право передоверия — строго обязательный radio.",
    "Валидация должна блокировать переход к генерации.",
    "Cursor должен использовать плейсхолдеры вида {{principal.full_name}}, {{banks}}, {{operations}}, {{limits}}, {{term}}, {{delegation}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — PRINCIPAL */
      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО" },
          { "name": "principal.iin", "type": "text", "label": "ИИН" },
          { "name": "principal.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "principal.address", "type": "text", "label": "Адрес регистрации" },
          { "name": "principal.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "principal.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "principal.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "principal.contact", "type": "text", "label": "Контакт (тел./email)" },
          {
            "name": "principal.attachments[]",
            "type": "file",
            "label": "Сканы удостоверения личности доверителя (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "agent_choice"
      },

      /* STEP 2 — AGENTS COUNT */
      {
        "id": "agent_choice",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": "1", "label": "1 поверенный" },
          { "value": "2", "label": "2 поверенных" }
        ],
        "required": true,
        "next": {
          "1": "agent1",
          "2": "agent1"
        }
      },

      /* STEP 3 — AGENT 1 */
      {
        "id": "agent1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agent1.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent1.iin", "type": "text", "label": "ИИН" },
          { "name": "agent1.address", "type": "text", "label": "Адрес" },
          { "name": "agent1.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "agent1.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "agent1.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent1.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agent1.contact", "type": "text", "label": "Контакт" },
          {
            "name": "agent1.attachments[]",
            "type": "file",
            "label": "Сканы поверенного 1 (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "agent2_cond"
      },

      /* STEP 4 — optional AGENT 2 */
      {
        "id": "agent2_cond",
        "type": "condition",
        "expression": "agent_choice == '2'",
        "next_if_true": "agent2",
        "next_if_false": "banks"
      },

      {
        "id": "agent2",
        "type": "form",
        "title": "Поверенный 2",
        "fields": [
          { "name": "agent2.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent2.iin", "type": "text", "label": "ИИН" },
          { "name": "agent2.address", "type": "text", "label": "Адрес" },
          { "name": "agent2.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "agent2.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "agent2.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent2.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agent2.contact", "type": "text", "label": "Контакт" },
          {
            "name": "agent2.attachments[]",
            "type": "file",
            "label": "Сканы поверенного 2 (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "banks"
      },

      /* STEP 5 — BANK SELECTION */
      {
        "id": "banks",
        "type": "bank-selection",
        "title": "Выбор банков",
        "fields": [
          {
            "name": "banks.select_all",
            "type": "checkbox",
            "label": "Выбрать все банки"
          },
          {
            "name": "banks.selected[]",
            "type": "typeahead-multiselect",
            "label": "Выберите банки"
          }
        ],
        "bank_card_template": {
          "fields": [
            { "name": "bank.branch", "type": "text", "label": "Филиал / отделение" },
            { "name": "bank.account_number", "type": "text", "label": "Номер счёта (IBAN)" },
            { "name": "bank.currency", "type": "select", "label": "Валюта", "options": ["KZT", "USD", "EUR", "RUB"] },
            { "name": "bank.use_for_statements", "type": "checkbox", "label": "Использовать для выписок" },
            { "name": "bank.use_for_cash_withdraw", "type": "checkbox", "label": "Разрешить снятие наличных" }
          ]
        },
        "required": true,
        "next": "operations"
      },

      /* STEP 6 — OPERATIONS */
      {
        "id": "operations",
        "type": "checkbox-group",
        "title": "Права и операции",
        "has_select_all": true,
        "options": [
          { "value": "statements", "label": "Получать банковские выписки" },
          { "value": "state_of_account", "label": "Получать справки о состоянии счёта" },
          { "value": "cash_withdraw", "label": "Снимать наличные" },
          { "value": "receive_docs", "label": "Получать платежные документы" },
          { "value": "sign_docs", "label": "Подписывать заявления/документы" },
          { "value": "cards_and_pin", "label": "Получать карточки / PIN" },
          { "value": "manage_deposits", "label": "Открывать / закрывать депозиты" },
          { "value": "incoming_transfers", "label": "Получать входящие переводы" },
          { "value": "service_contracts", "label": "Подписывать договоры обслуживания" },
          { "value": "represent", "label": "Представлять интересы в банке" }
        ],
        "min": 1,
        "next": "limits"
      },

      /* STEP 7 — LIMITS */
      {
        "id": "limits",
        "type": "radio",
        "title": "Ограничение по сумме",
        "options": [
          { "value": "none", "label": "Нет" },
          { "value": "yes", "label": "Да" }
        ],
        "next": {
          "none": "doc_req",
          "yes": "limit_values"
        }
      },

      {
        "id": "limit_values",
        "type": "form",
        "title": "Лимиты",
        "fields": [
          { "name": "limits.single", "type": "number", "label": "Разовый лимит" },
          { "name": "limits.total", "type": "number", "label": "Суммарный лимит" },
          { "name": "limits.currency", "type": "select", "options": ["KZT", "USD", "EUR", "RUB"], "label": "Валюта" }
        ],
        "next": "doc_req"
      },

      /* STEP 8 — DOCUMENT REQUIREMENTS */
      {
        "id": "doc_req",
        "type": "checkbox-group",
        "title": "Требования банка к документам",
        "options": [
          { "value": "original", "label": "Требуется оригинал доверенности" },
          { "value": "notary_copy", "label": "Нотариально заверенная копия" },
          { "value": "electronic", "label": "Электронная подпись (если банк принимает)" }
        ],
        "extra_fields": [
          { "name": "doc_req.special", "type": "textarea", "label": "Особые требования банка" }
        ],
        "next": "term"
      },

      /* STEP 9 — TERM */
      {
        "id": "term",
        "type": "radio",
        "title": "Срок доверенности",
        "options": [
          { "value": "days", "label": "Дни (1–31)" },
          { "value": "months", "label": "Месяцы (1–36)" }
        ],
        "next": {
          "days": "term_days",
          "months": "term_months"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "min": 1, "max": 31, "label": "Количество дней" }
        ],
        "next": "delegation"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "min": 1, "max": 36, "label": "Количество месяцев" }
        ],
        "next": "delegation"
      },

      /* STEP 10 — DELEGATION */
      {
        "id": "delegation",
        "type": "radio",
        "title": "Право передоверия",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "required": true,
        "next": "validate"
      },

      /* STEP 11 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required agent1.full_name",
          "required banks (>=1 selected)",
          "required operations (>=1)",
          "if operations include cash_withdraw or statements → require at least 1 bank.account_number",
          "if limits == yes → require limits.single, limits.currency",
          "required delegation",
          "required term"
        ],
        "next": "generate"
      },

      /* STEP 12 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal.full_name",
      "principal.iin",
      "agents[]",
      "banks[]",
      "operations[]",
      "limits.single",
      "limits.total",
      "term.days",
      "term.months",
      "delegation"
    ]
  }
},
{
  "id": 11,
  "code": "DOC_011",
  "title": "Доверенность — представление интересов (вне суда)",
  "category": "Доверенности / Представление интересов / Вне суда",

  "dev_notes": [
    "Доверитель — всегда 1. Обязательны 2 скана документа личности.",
    "Количество поверенных — 1 или 2. На каждого поверенного — 2 обязательных скана.",
    "Блоки SCOPE, ACTIONS, MATERIAL, WHERE должны иметь верхний чекбокс 'Выбрать всё'.",
    "SCOPE — большие категории (госорганы, налоговые, медучреждения, банки, ЖКХ и т.п.).",
    "ACTIONS — конкретные действия в рамках выбранных областей: подача/получение документов, подписи, переговоры, оплата, т.п.",
    "MATERIAL_BLOCK включается, если выбраны операции с денежными последствиями — выводить лимиты как обязательные.",
    "WHERE_BLOCK — typeahead + мультивыбор, с опцией 'Выбрать всё учреждения'.",
    "TERM — переключатель дней/месяцев (1–31 и 1–36).",
    "DELEGATION — обязательный radio 'Да/Нет'.",
    "APPEAR_TYPE — Лично / По доверенности. Если по доверенности — обязательный ввод реквизитов исходной доверенности + upload.",
    "VALIDATE — строгая, проверяет заполнение всех обязательных секций.",
    "Cursor обязан использовать плейсхолдеры {{PRINCIPAL}}, {{AGENTS}}, {{SCOPE}}, {{ACTIONS}}, {{MATERIAL_RIGHTS}}, {{WHERE}}, {{TERM}}, {{DELEGATION}}, {{POA_INFO}}."
  ],

  "rules_for_cursor": [
    "Всегда показывать поле загрузки 2 сканов паспорта доверителя.",
    "Для каждого поверенного создавать блок загрузки 2 сканов.",
    "SCOPE, ACTIONS, WHERE — чекбоксы с верхней опцией 'Выбрать всё'.",
    "MATERIAL_BLOCK активируется, если в ACTIONS отмечены пункты с денежными операциями.",
    "Если MATERIAL_BLOCK активен — лимит становится обязательным.",
    "WHERE_BLOCK — обязательно должен содержать typeahead + мультивыбор.",
    "APPEAR_TYPE == 'by_poa' → обязательные поля POA + upload.",
    "DELEGATION — строго required.",
    "Валидация блокирует генерацию, пока не заполнены обязательные поля.",
    "Генерация документа использует плейсхолдеры {{PRINCIPAL}}, {{AGENTS}}, {{SCOPE}}, {{ACTIONS}}, {{MATERIAL_RIGHTS}}, {{WHERE}}, {{TERM}}, {{DELEGATION}}, {{POA_INFO}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — PRINCIPAL */
      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО" },
          { "name": "principal.iin", "type": "text", "label": "ИИН" },
          { "name": "principal.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "principal.address", "type": "text", "label": "Адрес регистрации" },
          { "name": "principal.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "principal.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "principal.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "principal.contact", "type": "text", "label": "Контакт (тел./email)" },
          {
            "name": "principal.attachments[]",
            "type": "file",
            "label": "Сканы удостоверения доверителя (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "agent_choice"
      },

      /* STEP 2 — AGENTS COUNT */
      {
        "id": "agent_choice",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": "1", "label": "1 поверенный" },
          { "value": "2", "label": "2 поверенных" }
        ],
        "required": true,
        "next": {
          "1": "agent1",
          "2": "agent1"
        }
      },

      /* STEP 3 — AGENT 1 */
      {
        "id": "agent1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agent1.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent1.iin", "type": "text", "label": "ИИН" },
          { "name": "agent1.address", "type": "text", "label": "Адрес" },
          { "name": "agent1.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "agent1.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "agent1.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent1.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agent1.contact", "type": "text", "label": "Контакт" },
          {
            "name": "agent1.attachments[]",
            "type": "file",
            "label": "Сканы поверенного 1 (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "agent2_cond"
      },

      /* STEP 4 — optional AGENT 2 */
      {
        "id": "agent2_cond",
        "type": "condition",
        "expression": "agent_choice == '2'",
        "next_if_true": "agent2",
        "next_if_false": "scope"
      },

      {
        "id": "agent2",
        "type": "form",
        "title": "Поверенный 2",
        "fields": [
          { "name": "agent2.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent2.iin", "type": "text", "label": "ИИН" },
          { "name": "agent2.address", "type": "text", "label": "Адрес" },
          { "name": "agent2.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "agent2.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "agent2.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent2.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agent2.contact", "type": "text", "label": "Контакт" },
          {
            "name": "agent2.attachments[]",
            "type": "file",
            "label": "Сканы поверенного 2 (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "scope"
      },

      /* STEP 5 — SCOPE */
      {
        "id": "scope",
        "type": "checkbox-group",
        "title": "Области представления интересов",
        "has_select_all": true,
        "options": [
          { "value": "gov", "label": "Госорганы / Административные органы" },
          { "value": "registry", "label": "Регистрационные органы" },
          { "value": "tax", "label": "Налоговые органы" },
          { "value": "social", "label": "Социальные службы / ГЦВП" },
          { "value": "medical", "label": "Медучреждения" },
          { "value": "employer", "label": "Работодатель / Трудовые отношения" },
          { "value": "utilities", "label": "Коммунальные / ЖКХ" },
          { "value": "commercial", "label": "Коммерческие контрагенты / переговоры" },
          { "value": "banks", "label": "Банки (ограниченные полномочия)" },
          { "value": "other", "label": "Прочие (ввести вручную)" }
        ],
        "min": 1,
        "extra_fields": [
          { "name": "scope.other_text", "type": "textarea", "label": "Прочие области (ручной ввод)" }
        ],
        "next": "actions"
      },

      /* STEP 6 — ACTIONS */
      {
        "id": "actions",
        "type": "checkbox-group",
        "title": "Полномочия поверенного",
        "has_select_all": true,
        "options": [
          { "value": "submit_docs", "label": "Подавать документы" },
          { "value": "receive_docs", "label": "Получать документы" },
          { "value": "sign_docs", "label": "Подписывать заявления/документы" },
          { "value": "negotiations", "label": "Вести переговоры и подписывать договоры" },
          { "value": "payments", "label": "Оплата госпошлин и платежей" },
          { "value": "represent", "label": "Представлять интересы в органах" },
          { "value": "copies", "label": "Получать копии/справки/выписки" },
          { "value": "other", "label": "Иные полномочия (ручной ввод)" }
        ],
        "extra_fields": [
          { "name": "actions.other_text", "type": "textarea", "label": "Дополнительные полномочия" }
        ],
        "min": 1,
        "next": "material_cond"
      },

      /* STEP 7 — MATERIAL CONDITIONAL */
      {
        "id": "material_cond",
        "type": "condition",
        "expression": "actions includes 'payments' or actions includes 'negotiations'",
        "next_if_true": "material",
        "next_if_false": "where"
      },

      /* STEP 8 — MATERIAL BLOCK */
      {
        "id": "material",
        "type": "form",
        "title": "Материальные полномочия / ограничения",
        "fields": [
          { "name": "material.allow_money", "type": "checkbox", "label": "Разрешить операции с денежными средствами" },
          { "name": "material.single_limit", "type": "number", "label": "Разовый лимит (если требуется)" },
          { "name": "material.total_limit", "type": "number", "label": "Суммарный лимит" },
          { "name": "material.currency", "type": "select", "options": ["KZT", "USD", "EUR", "RUB"], "label": "Валюта" },
          { "name": "material.note", "type": "textarea", "label": "Ограничения / Примечания" }
        ],
        "next": "where"
      },

      /* STEP 9 — WHERE */
      {
        "id": "where",
        "type": "checkbox-group",
        "title": "Учреждения / места",
        "has_select_all": true,
        "options": [
          { "value": "ts", "label": "ЦОН / СпецЦОН" },
          { "value": "akimat", "label": "Акимат" },
          { "value": "tax", "label": "Налоговый комитет" },
          { "value": "gcvp", "label": "ГЦВП / Соцслужбы" },
          { "value": "hospital", "label": "Поликлиника / больница" },
          { "value": "utilities", "label": "Коммунальные службы" },
          { "value": "registries", "label": "Регистр недвижимости / кадастр" },
          { "value": "employer", "label": "Работодатель" },
          { "value": "post", "label": "Почта / Казпочта" },
          { "value": "other", "label": "Прочие (ручной ввод)" }
        ],
        "extra_fields": [
          { "name": "where.other_text", "type": "textarea", "label": "Другое учреждение" }
        ],
        "min": 1,
        "next": "term"
      },

      /* STEP 10 — TERM */
      {
        "id": "term",
        "type": "radio",
        "title": "Срок доверенности",
        "options": [
          { "value": "days", "label": "Дни (1–31)" },
          { "value": "months", "label": "Месяцы (1–36)" }
        ],
        "required": true,
        "next": {
          "days": "term_days",
          "months": "term_months"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "min": 1, "max": 31, "label": "Количество дней" }
        ],
        "next": "delegation"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "min": 1, "max": 36, "label": "Количество месяцев" }
        ],
        "next": "delegation"
      },

      /* STEP 11 — DELEGATION */
      {
        "id": "delegation",
        "type": "radio",
        "title": "Право передоверия",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "required": true,
        "next": "appear"
      },

      /* STEP 12 — APPEAR TYPE */
      {
        "id": "appear",
        "type": "radio",
        "title": "Как действует доверитель?",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "by_poa", "label": "По доверенности" }
        ],
        "required": true,
        "next": {
          "personal": "validate",
          "by_poa": "poa_fields"
        }
      },

      /* STEP 13 — POA FIELDS */
      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты исходной доверенности",
        "fields": [
          { "name": "poa.reg_number", "type": "text", "label": "Реестровый номер" },
          { "name": "poa.issued_by", "type": "text", "label": "Кем выдана" },
          { "name": "poa.issue_date", "type": "date", "label": "Дата выдачи" },
          { "name": "poa.license_number", "type": "text", "label": "Номер лицензии нотариуса" },
          { "name": "poa.license_date", "type": "date", "label": "Дата выдачи лицензии" },
          {
            "name": "poa.attachments[]",
            "type": "file",
            "label": "Скан доверенности",
            "min": 1,
            "max": 3
          }
        ],
        "next": "validate"
      },

      /* STEP 14 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required agent1.full_name",
          "required scope (>=1)",
          "required actions (>=1)",
          "if actions include payments → require material.single_limit",
          "required where (>=1)",
          "required term",
          "required delegation",
          "if appear == 'by_poa' → require poa.reg_number"
        ],
        "next": "generate"
      },

      /* STEP 15 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal",
      "agents[]",
      "scope[]",
      "actions[]",
      "material.*",
      "where[]",
      "term.days",
      "term.months",
      "delegation",
      "poa.*"
    ]
  }
},
{
  "id": 12,
  "code": "DOC_012",
  "title": "Согласие на предоставление юридического адреса",
  "category": "Согласия / Недвижимость / Юридический адрес",

  "dev_notes": [
    "Доверитель — физическое лицо, дающее согласие. Обязательны 2 скана документа личности.",
    "Получатель согласия может быть физическим лицом или юридическим лицом (ТОО).",
    "Тип недвижимости влияет только на текст подстановки, но все типы ведут к одному блоку данных объекта.",
    "Блок PROPERTY_DATA — обязателен: полный адрес, кадастровый номер (если есть), правоустанавлив. документ.",
    "Срок: только Days(1–31) или Months(1–36).",
    "Если пользователь выбирает 'По доверенности' — обязательные поля реквизитов исходной доверенности + upload.",
    "Генерация документа должна использовать плейсхолдеры: {{PRINCIPAL}}, {{RECEIVER}}, {{PROPERTY_TYPE}}, {{PROPERTY_ADDRESS}}, {{KADASTR}}, {{TERM}}, {{POA_INFO}}."
  ],

  "rules_for_cursor": [
    "Всегда показывать обязательный upload двух сканов удостоверения личности доверителя.",
    "Получатель: если выбран тип 'Юридическое лицо', обязательно требовать БИН и Наименование.",
    "Тип объекта — radio required; при выборе 'Другое' показывать обязательное текстовое поле для типа.",
    "Адрес объекта — обязательный текстовый блок.",
    "Если user выбрал 'По доверенности', появится обязательный блок ввода реквизитов + upload сканов.",
    "Срок — строго один вариант: Days или Months, не оба.",
    "При валидации запрещать генерацию, если отсутствуют обязательные поля по объекту.",
    "В шаблоне документа Cursor обязан подставлять плейсхолдеры из раздела placeholders."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — PRINCIPAL */
      {
        "id": "principal",
        "type": "form",
        "title": "Лицо, дающее согласие",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО" },
          { "name": "principal.iin", "type": "text", "label": "ИИН" },
          { "name": "principal.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "principal.address", "type": "text", "label": "Адрес регистрации" },
          { "name": "principal.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "principal.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "principal.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.document.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "principal.attachments[]",
            "type": "file",
            "label": "Сканы удостоверения личности (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "receiver"
      },

      /* STEP 2 — RECEIVER */
      {
        "id": "receiver",
        "type": "form",
        "title": "Получатель согласия",
        "fields": [
          {
            "name": "receiver.type",
            "type": "radio",
            "label": "Тип получателя",
            "options": [
              { "value": "physical", "label": "Физическое лицо" },
              { "value": "legal", "label": "Юридическое лицо / ТОО" }
            ],
            "required": true
          },
          { "name": "receiver.full_name", "type": "text", "label": "ФИО / Наименование" },
          { "name": "receiver.iin_bin", "type": "text", "label": "ИИН / БИН" },
          { "name": "receiver.address", "type": "text", "label": "Адрес" }
        ],
        "next": "property_type"
      },

      /* STEP 3 — PROPERTY TYPE */
      {
        "id": "property_type",
        "type": "radio",
        "title": "Тип объекта недвижимости",
        "options": [
          { "value": "apartment", "label": "Квартира" },
          { "value": "house", "label": "Жилой дом" },
          { "value": "land", "label": "Земельный участок" },
          { "value": "nonresidential", "label": "Нежилое помещение" },
          { "value": "other", "label": "Другое" }
        ],
        "required": true,
        "next": {
          "apartment": "property_data",
          "house": "property_data",
          "land": "property_data",
          "nonresidential": "property_data",
          "other": "property_type_other"
        }
      },

      {
        "id": "property_type_other",
        "type": "form",
        "title": "Укажите тип объекта",
        "fields": [
          { "name": "property.other_type", "type": "text", "label": "Тип объекта (ручной ввод)" }
        ],
        "next": "property_data"
      },

      /* STEP 4 — PROPERTY DATA */
      {
        "id": "property_data",
        "type": "form",
        "title": "Данные объекта недвижимости",
        "fields": [
          { "name": "property.address_full", "type": "textarea", "label": "Полный адрес объекта" },
          { "name": "property.kadastr_number", "type": "text", "label": "Кадастровый номер (если есть)" },
          { "name": "property.document_number", "type": "text", "label": "Номер правоустанавлив. документа" },
          { "name": "property.document_date", "type": "date", "label": "Дата правоустанавлив. документа" },
          { "name": "property.unit_number", "type": "text", "label": "Квартира/офис/помещение №" }
        ],
        "next": "term"
      },

      /* STEP 5 — TERM */
      {
        "id": "term",
        "type": "radio",
        "title": "Срок согласия",
        "options": [
          { "value": "days", "label": "Дни (1–31)" },
          { "value": "months", "label": "Месяцы (1–36)" }
        ],
        "required": true,
        "next": {
          "days": "term_days",
          "months": "term_months"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "min": 1, "max": 31, "label": "Количество дней" }
        ],
        "next": "appear_type"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "min": 1, "max": 36, "label": "Количество месяцев" }
        ],
        "next": "appear_type"
      },

      /* STEP 6 — APPEAR TYPE */
      {
        "id": "appear_type",
        "type": "radio",
        "title": "Обратившийся действует",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "by_poa", "label": "По доверенности" }
        ],
        "required": true,
        "next": {
          "personal": "validate",
          "by_poa": "poa_fields"
        }
      },

      /* STEP 7 — POA FIELDS */
      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты исходной доверенности",
        "fields": [
          { "name": "poa.reg_number", "type": "text", "label": "Реестровый номер" },
          { "name": "poa.notary_name", "type": "text", "label": "ФИО нотариуса" },
          { "name": "poa.license_number", "type": "text", "label": "Номер лицензии" },
          { "name": "poa.license_date", "type": "date", "label": "Дата выдачи лицензии" },
          { "name": "poa.issue_date", "type": "date", "label": "Дата выдачи доверенности" },
          {
            "name": "poa.attachments[]",
            "type": "file",
            "label": "Загрузить скан доверенности",
            "min": 1,
            "max": 3
          }
        ],
        "next": "validate"
      },

      /* STEP 8 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required receiver.full_name",
          "required property.address_full",
          "required term",
          "if appear_type == 'by_poa' → require poa.reg_number, poa.notary_name",
          "principal.attachments must contain 2 files"
        ],
        "next": "generate"
      },

      /* STEP 9 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal.full_name",
      "principal.iin",
      "receiver.full_name",
      "receiver.iin_bin",
      "property.address_full",
      "property.kadastr_number",
      "term.days",
      "term.months",
      "poa.reg_number",
      "poa.notary_name"
    ]
  }
},
{
  "id": 13,
  "code": "DOC_013",
  "title": "Согласие на приватизацию",
  "category": "Недвижимость / Приватизация",

  "dev_notes": [
    "Доверитель — один, обязательные паспортные данные и upload документа.",
    "Получатель согласия может быть: физлицо, несколько лиц, юрлицо, госорган.",
    "Тип приватизации — мультивыбор (квартира, дом, участок, доля и т.д.).",
    "Данные об объекте — обязательны для каждого типа: адрес, кадастр, правоуст. документы.",
    "Условия приватизации (бесплатно/оплата/доля/изменение назначения) — чекбоксы.",
    "При оплате приватизации → обязательное поле суммы.",
    "Документы — drop-list с возможностью 'выбрать всё'.",
    "Если заявитель действует по доверенности → обязательный блок реквизитов доверенности.",
    "Валидация должна блокировать генерацию, если: нет типа приватизации, нет данных объекта, нет документов.",
    "Плейсхолдеры: {{principal}}, {{recipient}}, {{priv_types}}, {{property}}, {{conditions}}, {{docs}}, {{where}}, {{poa}}"
  ],

  "rules_for_cursor": [
    "principal.passport_scan — required",
    "recipient — required",
    "priv_types — min 1",
    "property fields — all required",
    "If conditions.payment == true → require amount",
    "documents — min 1",
    "If appear_type == poa → require poa fields",
    "placeholders must map to template fields"
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — PRINCIPAL */
      {
        "id": "principal",
        "type": "form",
        "title": "Лицо, дающее согласие",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО / Наименование" },
          { "name": "principal.iin_bin", "type": "text", "label": "ИИН / БИН" },
          { "name": "principal.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "principal.address", "type": "text", "label": "Адрес регистрации" },
          { "name": "principal.passport.type", "type": "text", "label": "Тип документа" },
          { "name": "principal.passport.number", "type": "text", "label": "Серия и номер" },
          { "name": "principal.passport.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.passport.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "principal.contact", "type": "text", "label": "Телефон / e-mail" },
          { "name": "principal.passport_scan[]", "type": "file", "label": "Скан документа личности", "min": 1 }
        ],
        "next": "recipient"
      },

      /* STEP 2 — RECIPIENT */
      {
        "id": "recipient",
        "type": "radio",
        "title": "Кому даётся согласие",
        "options": [
          { "value": "person", "label": "Физическое лицо" },
          { "value": "several", "label": "Несколько физических лиц" },
          { "value": "company", "label": "Юридическое лицо" },
          { "value": "state", "label": "Государственный орган" }
        ],
        "required": true,
        "next": {
          "person": "recipient_person",
          "several": "recipient_multiple",
          "company": "recipient_company",
          "state": "recipient_state"
        }
      },

      {
        "id": "recipient_person",
        "type": "form",
        "title": "Получатель — физическое лицо",
        "fields": [
          { "name": "recipient.full_name", "type": "text", "label": "ФИО" },
          { "name": "recipient.iin", "type": "text", "label": "ИИН" },
          { "name": "recipient.contact", "type": "text", "label": "Контакт" }
        ],
        "next": "priv_type"
      },

      {
        "id": "recipient_multiple",
        "type": "list",
        "title": "Получатели — несколько лиц",
        "fields": [
          { "name": "recipient[].full_name", "type": "text", "label": "ФИО" },
          { "name": "recipient[].iin", "type": "text", "label": "ИИН" },
          { "name": "recipient[].contact", "type": "text", "label": "Контакт" }
        ],
        "min": 2,
        "next": "priv_type"
      },

      {
        "id": "recipient_company",
        "type": "form",
        "title": "Получатель — юридическое лицо",
        "fields": [
          { "name": "recipient.company_name", "type": "text", "label": "Наименование" },
          { "name": "recipient.bin", "type": "text", "label": "БИН" }
        ],
        "next": "priv_type"
      },

      {
        "id": "recipient_state",
        "type": "select",
        "title": "Государственный орган",
        "options": [
          "Акимат",
          "Отдел жилищных отношений",
          "Комитет по имуществу",
          "ЦОН",
          "СпецЦОН"
        ],
        "required": true,
        "next": "priv_type"
      },

      /* STEP 3 — PRIVATIZATION TYPE */
      {
        "id": "priv_type",
        "type": "checkbox-group",
        "title": "Тип приватизации",
        "min": 1,
        "options": [
          { "value": "housing", "label": "Жилая недвижимость" },
          { "value": "land", "label": "Земельный участок" },
          { "value": "nonres", "label": "Нежилое помещение / коммерческая недвижимость" },
          { "value": "share", "label": "Приватизация доли" },
          { "value": "other", "label": "Другое" }
        ],
        "next": "property"
      },

      /* STEP 4 — PROPERTY DATA */
      {
        "id": "property",
        "type": "form",
        "title": "Данные об объекте",
        "fields": [
          { "name": "property.address", "type": "text", "label": "Полный адрес" },
          { "name": "property.cadastral", "type": "text", "label": "Кадастровый номер" },
          { "name": "property.type", "type": "text", "label": "Тип / описание" },
          { "name": "property.area", "type": "text", "label": "Площадь" },
          { "name": "property.floor", "type": "text", "label": "Этаж / № помещения" },
          { "name": "property.docs", "type": "textarea", "label": "Правоустанавливающие документы" }
        ],
        "next": "conditions"
      },

      /* STEP 5 — PRIVATIZATION CONDITIONS */
      {
        "id": "conditions",
        "type": "checkbox-group",
        "title": "Условия приватизации",
        "options": [
          { "value": "free", "label": "Приватизация бесплатно" },
          { "value": "paid", "label": "Приватизация с оплатой" },
          { "value": "share", "label": "Приватизация доли" },
          { "value": "change_usage", "label": "Согласие на изменение назначения/перепланировку" },
          { "value": "transfer_rights", "label": "Согласие на передачу прав третьим лицам" }
        ],
        "next": "conditions_details"
      },

      {
        "id": "conditions_details",
        "type": "form",
        "title": "Детали условий (если применимо)",
        "fields": [
          { "name": "conditions.amount", "type": "text", "label": "Сумма оплаты (если есть)" },
          { "name": "conditions.share_percent", "type": "text", "label": "Доля (%) (если есть)" }
        ],
        "next": "documents"
      },

      /* STEP 6 — DOCUMENT LIST */
      {
        "id": "documents",
        "type": "checkbox-group",
        "title": "Подтверждающие документы",
        "options": [
          { "value": "tech_passport", "label": "Технический паспорт / БТИ" },
          { "value": "cadastral", "label": "Кадастровая выписка" },
          { "value": "social_rent", "label": "Договор социального найма" },
          { "value": "family_comp", "label": "Справка о составе семьи" },
          { "value": "passport", "label": "Паспорт доверителя" },
          { "value": "other", "label": "Иные документы" }
        ],
        "min": 1,
        "next": "where"
      },

      /* STEP 7 — WHERE TO SUBMIT */
      {
        "id": "where",
        "type": "select",
        "multiple": true,
        "title": "Куда подавать",
        "options": [
          "Акимат / отдел жилищных отношений",
          "Комитет по имуществу",
          "ЦОН",
          "СпецЦОН",
          "ЖЭК / управляющая компания",
          "Другое"
        ],
        "next": "appear_type"
      },

      /* STEP 8 — APPEAR TYPE */
      {
        "id": "appear_type",
        "type": "radio",
        "title": "Заявитель действует",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "required": true,
        "next": {
          "personal": "validate",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.registry", "type": "text", "label": "Реестровый номер" },
          { "name": "poa.issued_by", "type": "text", "label": "Кем выдана" },
          { "name": "poa.date", "type": "date", "label": "Дата выдачи" },
          { "name": "poa.notary_license", "type": "text", "label": "Лицензия нотариуса" }
        ],
        "next": "validate"
      },

      /* STEP 9 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required recipient",
          "required priv_type (>=1)",
          "required property.address",
          "required property.cadastral",
          "required documents (>=1)",
          "if appear_type == 'poa' → require poa.registry"
        ],
        "next": "generate"
      },

      /* STEP 10 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal",
      "recipient",
      "priv_types",
      "property",
      "conditions",
      "docs",
      "where",
      "poa"
    ]
  }
},
{
  "id": 14,
  "code": "DOC_014",
  "title": "Согласие на выезд ребёнка с одним из родителей",
  "category": "Дети / Путешествия / Согласия",

  "dev_notes": [
    "Варианты доверителя: мать, отец или оба родителя — генерировать один или два блока формы.",
    "Получатель согласия: другой родитель или третье лицо.",
    "Количество детей — динамический список от 1 до 10.",
    "Возрастная проверка: детям должно быть <18 лет.",
    "Маршрут: три варианта — весь мир, конкретные страны, только РК.",
    "Тип поездки: единичная, многократная, без ограничения.",
    "Доп. опции: медпомощь, визовые формальности, экстренный контакт, ограничения.",
    "Если оформление по доверенности → обязательные реквизиты доверенности + upload.",
    "Валидация запрещает генерацию при отсутствии маршрута, сроков, данных детей.",
    "Плейсхолдеры: {{giver}}, {{recipient}}, {{children}}, {{countries}}, {{dates}}, {{additional}}, {{poa_info}}"
  ],

  "rules_for_cursor": [
    "giver.* — required",
    "recipient.* — required",
    "children[].full_name — required",
    "children[].birth_date < 18 years",
    "trip.scope — required",
    "trip.type — required",
    "If trip.type == 'one' → require dates",
    "If trip.type == 'multi' → require term or date range",
    "If appear_type == 'poa' → require poa fields + scan",
    "Placeholders must map correctly to template"
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — WHO GIVES CONSENT */
      {
        "id": "giver_type",
        "type": "radio",
        "title": "Кто даёт согласие?",
        "options": [
          { "value": "mother", "label": "Мать" },
          { "value": "father", "label": "Отец" },
          { "value": "both", "label": "Оба родителя" }
        ],
        "required": true,
        "next": {
          "mother": "giver_mother",
          "father": "giver_father",
          "both": "giver_both"
        }
      },

      {
        "id": "giver_mother",
        "type": "form",
        "title": "Доверитель — Мать",
        "fields": [
          { "name": "giver.mother.full_name", "type": "text", "label": "ФИО" },
          { "name": "giver.mother.iin", "type": "text", "label": "ИИН" },
          { "name": "giver.mother.pass.type", "type": "text", "label": "Тип документа" },
          { "name": "giver.mother.pass.number", "type": "text", "label": "Серия и номер" },
          { "name": "giver.mother.pass.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "giver.mother.pass.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "giver.mother.address", "type": "text", "label": "Адрес регистрации" },
          { "name": "giver.mother.contact", "type": "text", "label": "Телефон / e-mail" }
        ],
        "next": "recipient_type"
      },

      {
        "id": "giver_father",
        "type": "form",
        "title": "Доверитель — Отец",
        "fields": [
          { "name": "giver.father.full_name", "type": "text", "label": "ФИО" },
          { "name": "giver.father.iin", "type": "text", "label": "ИИН" },
          { "name": "giver.father.pass.type", "type": "text", "label": "Тип документа" },
          { "name": "giver.father.pass.number", "type": "text", "label": "Серия и номер" },
          { "name": "giver.father.pass.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "giver.father.pass.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "giver.father.address", "type": "text", "label": "Адрес регистрации" },
          { "name": "giver.father.contact", "type": "text", "label": "Телефон / e-mail" }
        ],
        "next": "recipient_type"
      },

      {
        "id": "giver_both",
        "type": "form-multi",
        "title": "Доверители — Мать и Отец",
        "entities": [
          {
            "label": "Мать",
            "fields": [
              { "name": "giver.mother.full_name", "type": "text", "label": "ФИО" },
              { "name": "giver.mother.iin", "type": "text", "label": "ИИН" },
              { "name": "giver.mother.pass.type", "type": "text", "label": "Тип документа" },
              { "name": "giver.mother.pass.number", "type": "text", "label": "Серия и номер" },
              { "name": "giver.mother.pass.issued_by", "type": "text", "label": "Кем выдан" },
              { "name": "giver.mother.pass.issued_date", "type": "date", "label": "Дата выдачи" },
              { "name": "giver.mother.address", "type": "text", "label": "Адрес регистрации" },
              { "name": "giver.mother.contact", "type": "text", "label": "Телефон / e-mail" }
            ]
          },
          {
            "label": "Отец",
            "fields": [
              { "name": "giver.father.full_name", "type": "text", "label": "ФИО" },
              { "name": "giver.father.iin", "type": "text", "label": "ИИН" },
              { "name": "giver.father.pass.type", "type": "text", "label": "Тип документа" },
              { "name": "giver.father.pass.number", "type": "text", "label": "Серия и номер" },
              { "name": "giver.father.pass.issued_by", "type": "text", "label": "Кем выдан" },
              { "name": "giver.father.pass.issued_date", "type": "date", "label": "Дата выдачи" },
              { "name": "giver.father.address", "type": "text", "label": "Адрес регистрации" },
              { "name": "giver.father.contact", "type": "text", "label": "Телефон / e-mail" }
            ]
          }
        ],
        "next": "recipient_type"
      },

      /* STEP 2 — RECIPIENT */
      {
        "id": "recipient_type",
        "type": "radio",
        "title": "Кому даётся согласие?",
        "options": [
          { "value": "parent", "label": "Другому родителю" },
          { "value": "third", "label": "Третьему лицу" }
        ],
        "required": true,
        "next": {
          "parent": "recipient_parent",
          "third": "recipient_third"
        }
      },

      {
        "id": "recipient_parent",
        "type": "form",
        "title": "Получатель — другой родитель",
        "fields": [
          { "name": "recipient.full_name", "type": "text", "label": "ФИО" },
          { "name": "recipient.iin", "type": "text", "label": "ИИН" },
          { "name": "recipient.passport", "type": "text", "label": "Документ личности" },
          { "name": "recipient.contact", "type": "text", "label": "Контакты" }
        ],
        "next": "children_count"
      },

      {
        "id": "recipient_third",
        "type": "form",
        "title": "Получатель — сопровождающее лицо",
        "fields": [
          { "name": "recipient.full_name", "type": "text", "label": "ФИО" },
          { "name": "recipient.id", "type": "text", "label": "ИИН / Паспорт" },
          { "name": "recipient.status", "type": "text", "label": "Степень родства / статус" },
          { "name": "recipient.contact", "type": "text", "label": "Контакты" }
        ],
        "next": "children_count"
      },

      /* STEP 3 — CHILDREN */
      {
        "id": "children_count",
        "type": "number",
        "title": "Сколько детей?",
        "min": 1,
        "max": 10,
        "next": "children"
      },

      {
        "id": "children",
        "type": "list",
        "title": "Данные детей",
        "fields": [
          { "name": "children[].full_name", "type": "text", "label": "ФИО" },
          { "name": "children[].iin", "type": "text", "label": "ИИН (если есть)" },
          { "name": "children[].birth_date", "type": "date", "label": "Дата рождения — проверка <18" },
          { "name": "children[].doc", "type": "text", "label": "Свидетельство/паспорт" }
        ],
        "minItemsFrom": "children_count",
        "maxItemsFrom": "children_count",
        "next": "trip_scope"
      },

      /* STEP 4 — TRIP SCOPE */
      {
        "id": "trip_scope",
        "type": "radio",
        "title": "Маршрут поездки",
        "options": [
          { "value": "world", "label": "Весь мир" },
          { "value": "countries", "label": "Выбор конкретных стран" },
          { "value": "rk", "label": "Только внутри РК" }
        ],
        "required": true,
        "next": {
          "world": "trip_type",
          "countries": "countries_list",
          "rk": "trip_type"
        }
      },

      {
        "id": "countries_list",
        "type": "multiselect",
        "title": "Список стран",
        "options_source": "country_list",
        "required": true,
        "next": "trip_type"
      },

      /* STEP 5 — TRIP TYPE */
      {
        "id": "trip_type",
        "type": "radio",
        "title": "Тип поездки",
        "options": [
          { "value": "one", "label": "Единичный выезд" },
          { "value": "multi", "label": "Многократные поездки" },
          { "value": "open", "label": "Без ограничения" }
        ],
        "required": true,
        "next": {
          "one": "trip_one",
          "multi": "trip_multi",
          "open": "consent_additional"
        }
      },

      {
        "id": "trip_one",
        "type": "form",
        "title": "Единичный выезд",
        "fields": [
          { "name": "trip.dates.from", "type": "date", "label": "Дата выезда" },
          { "name": "trip.dates.to", "type": "date", "label": "Дата возвращения (опц.)" }
        ],
        "next": "consent_additional"
      },

      {
        "id": "trip_multi",
        "type": "form",
        "title": "Многократные поездки / срок",
        "fields": [
          { "name": "trip.term", "type": "text", "label": "Срок (дни или месяцы) или диапазон дат" }
        ],
        "next": "consent_additional"
      },

      /* STEP 6 — ADDITIONAL OPTIONS */
      {
        "id": "consent_additional",
        "type": "checkbox-group",
        "title": "Дополнительные опции",
        "options": [
          { "value": "medical", "label": "Разрешение на получение медицинской помощи" },
          { "value": "visa", "label": "Разрешение на визовые формальности" },
          { "value": "emergency", "label": "Контакт для экстренной связи" },
          { "value": "restrictions", "label": "Ограничения (страны/запрет передоверия и т.п.)" }
        ],
        "next": "additional_fields"
      },

      {
        "id": "additional_fields",
        "type": "form",
        "title": "Детали дополнительных опций",
        "fields": [
          { "name": "additional.emergency_contact", "type": "text", "label": "Экстренный контакт (если выбран)" },
          { "name": "additional.restrictions_text", "type": "textarea", "label": "Ограничения" }
        ],
        "next": "appear_type"
      },

      /* STEP 7 — APPEAR TYPE */
      {
        "id": "appear_type",
        "type": "radio",
        "title": "Как подаётся согласие?",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности / с копией документа" }
        ],
        "required": true,
        "next": {
          "personal": "validate",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности / копии",
        "fields": [
          { "name": "poa.registry", "type": "text", "label": "Реестровый номер / серия" },
          { "name": "poa.issued_by", "type": "text", "label": "Кем выдана" },
          { "name": "poa.date", "type": "date", "label": "Дата выдачи" },
          { "name": "poa.notary_license", "type": "text", "label": "Номер лицензии нотариуса (опц.)" },
          { "name": "poa.scan", "type": "file", "label": "Копия доверенности", "min": 1 }
        ],
        "next": "validate"
      },

      /* STEP 8 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required giver",
          "required recipient",
          "required children",
          "children[].birth_date < 18 years",
          "required trip.scope",
          "required trip.type",
          "if trip.type == 'one' → trip.dates.from required",
          "if appear_type == 'poa' → poa.registry required"
        ],
        "next": "generate"
      },

      /* STEP 9 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "giver",
      "recipient",
      "children",
      "countries",
      "dates",
      "additional",
      "poa_info"
    ]
  }
},
{
  "id": 15,
  "code": "DOC_015",
  "title": "Иное согласие физического лица",
  "category": "Согласия / Универсальные действия / Персональные данные / Документы",

  "dev_notes": [
    "Документ универсальный — пользователь может выбрать 1 или несколько категорий согласия (персональные данные, выдача документов, административные действия и т.д.).",
    "Для каждой категории показываются динамические подтипы (чекбоксы).",
    "Если выбрана категория 'Иные действия' → обязательно показывать поле ручного ввода.",
    "Получатель согласия: физлицо, организация, госорган или иное — соответствующие поля обязательны.",
    "Объект согласия появляется только если выбранная категория требует указания объекта (например: имущество, документ, ребёнок).",
    "Срок — 4 варианта (дни, месяцы, период, бессрочно).",
    "Дополнительные параметры — чекбоксы, плюс возможность ручного ввода ограничений и особых условий.",
    "Если оформляется 'по доверенности' — обязательные поля исходной доверенности + upload скана.",
    "Валидация запрещает Generate до заполнения всех обязательных блоков.",
    "Document generation: шаблон должен подставлять категории, подтипы, получателя, объект, срок, доп. условия."
  ],

  "rules_for_cursor": [
    "Если выбрана хотя бы одна категория — отобразить подтипы для каждой выбранной.",
    "Категория 'Иные действия' требует обязательного текстового поля.",
    "Если категория связана с объектом → OBJ_NEEDED = true → показать блок объекта.",
    "Получатель согласия: все поля выбранного типа обязательны.",
    "Срок: один из вариантов обязателен. Если выбран период — нужны обе даты.",
    "Доп. параметры: если включена опция с ручным вводом — поле требуется.",
    "При appear_type == 'poa' → обязательны все поля по доверенности и upload.",
    "Cursor должен создать финальные placeholders: {{PRINCIPAL}}, {{CATEGORIES}}, {{SUBTYPES}}, {{TARGET}}, {{OBJECT}}, {{TERM}}, {{EXTRA}}, {{POA_INFO}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — PRINCIPAL */
      {
        "id": "principal",
        "type": "form",
        "title": "Лицо, дающее согласие",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО" },
          { "name": "principal.iin", "type": "text", "label": "ИИН" },
          { "name": "principal.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "principal.address", "type": "text", "label": "Адрес" },
          { "name": "principal.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "principal.document.number", "type": "text", "label": "Серия/номер" },
          { "name": "principal.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "principal.contact", "type": "text", "label": "Контакт" }
        ],
        "next": "consent_categories"
      },

      /* STEP 2 — CONSENT CATEGORIES */
      {
        "id": "consent_categories",
        "type": "checkbox-group",
        "title": "Категории согласия",
        "has_select_all": true,
        "options": [
          { "value": "personal_data", "label": "На обработку персональных данных" },
          { "value": "docs_issue", "label": "На получение / выдачу документов" },
          { "value": "admin_actions", "label": "На выполнение административных действий" },
          { "value": "events_children", "label": "На участие в мероприятиях / поездках" },
          { "value": "legal_actions", "label": "На выполнение юридически значимых действий" },
          { "value": "access_info", "label": "На предоставление доступа к информации" },
          { "value": "use_property", "label": "На использование имущества / объекта" },
          { "value": "child_actions", "label": "На действия в отношении ребенка" },
          { "value": "custom", "label": "Иные действия (ручной ввод)" }
        ],
        "min": 1,
        "next": "subtypes"
      },

      /* STEP 3 — SUBTYPES (dynamic) */
      {
        "id": "subtypes",
        "type": "dynamic-multi-block",
        "title": "Подтипы выбранных категорий",
        "blocks": {
          "personal_data": [
            { "name": "personal.store", "type": "checkbox", "label": "Обработка / хранение / передача" },
            { "name": "personal.third_parties", "type": "checkbox", "label": "Передача третьим лицам" },
            { "name": "personal.systems", "type": "checkbox", "label": "Обработка в электронных системах" }
          ],
          "docs_issue": [
            { "name": "docs.spravki", "type": "checkbox", "label": "Выдача справок" },
            { "name": "docs.copies", "type": "checkbox", "label": "Выдача копий документов" },
            { "name": "docs.personal_docs", "type": "text", "label": "Выдача личных документов (ручной ввод)" }
          ],
          "admin_actions": [
            { "name": "admin.apply", "type": "checkbox", "label": "Подача заявлений" },
            { "name": "admin.result", "type": "checkbox", "label": "Получение результата госуслуги" },
            { "name": "admin.notifications", "type": "checkbox", "label": "Получение уведомлений" }
          ],
          "events_children": [
            { "name": "events.participation", "type": "checkbox", "label": "Участие в мероприятиях" },
            { "name": "events.docs", "type": "checkbox", "label": "Оформление документов" },
            { "name": "events.support", "type": "checkbox", "label": "Сопровождение" }
          ],
          "legal_actions": [
            { "name": "legal.signing", "type": "checkbox", "label": "Подписание документов" },
            { "name": "legal.submission", "type": "checkbox", "label": "Подача заявлений" }
          ],
          "access_info": [
            { "name": "info.access", "type": "checkbox", "label": "Предоставление доступа к информации" }
          ],
          "use_property": [
            { "name": "prop.use", "type": "checkbox", "label": "Использование имущества" },
            { "name": "prop.location", "type": "text", "label": "Адрес/описание объекта" }
          ],
          "child_actions": [
            { "name": "child.docs", "type": "checkbox", "label": "Оформление документов" },
            { "name": "child.events", "type": "checkbox", "label": "Участие в мероприятиях" }
          ],
          "custom": [
            { "name": "custom.text", "type": "textarea", "label": "Описание иного действия (обязательно)" }
          ]
        },
        "next": "target"
      },

      /* STEP 4 — TARGET */
      {
        "id": "target",
        "type": "radio",
        "title": "Кому даётся согласие",
        "options": [
          { "value": "physical", "label": "Физическое лицо" },
          { "value": "organization", "label": "Организация" },
          { "value": "gov", "label": "Госорган" },
          { "value": "other", "label": "Иное" }
        ],
        "required": true,
        "next": {
          "physical": "target_phys",
          "organization": "target_org",
          "gov": "target_gov",
          "other": "target_other"
        }
      },

      {
        "id": "target_phys",
        "type": "form",
        "title": "Физическое лицо",
        "fields": [
          { "name": "target.full_name", "type": "text", "label": "ФИО" },
          { "name": "target.iin", "type": "text", "label": "ИИН" },
          { "name": "target.contact", "type": "text", "label": "Контакт" },
          { "name": "target.document", "type": "text", "label": "Документ" }
        ],
        "next": "object_needed"
      },

      {
        "id": "target_org",
        "type": "form",
        "title": "Организация",
        "fields": [
          { "name": "target.name", "type": "text", "label": "Наименование" },
          { "name": "target.bin", "type": "text", "label": "БИН" },
          { "name": "target.address", "type": "text", "label": "Адрес" }
        ],
        "next": "object_needed"
      },

      {
        "id": "target_gov",
        "type": "typeahead",
        "title": "Госорган",
        "fields": [
          { "name": "target.gov", "type": "typeahead", "label": "Выберите орган или введите вручную" }
        ],
        "next": "object_needed"
      },

      {
        "id": "target_other",
        "type": "form",
        "title": "Иное",
        "fields": [
          { "name": "target.other", "type": "text", "label": "Название / данные" }
        ],
        "next": "object_needed"
      },

      /* STEP 5 — OBJECT NEEDED? */
      {
        "id": "object_needed",
        "type": "radio",
        "title": "Требуется ли указание объекта?",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "required": true,
        "next": {
          "yes": "object_fields",
          "no": "term"
        }
      },

      {
        "id": "object_fields",
        "type": "form",
        "title": "Объект согласия",
        "fields": [
          { "name": "object.type", "type": "text", "label": "Тип объекта" },
          { "name": "object.address", "type": "text", "label": "Адрес / местонахождение" },
          { "name": "object.details", "type": "text", "label": "Описание / реквизиты документа" },
          { "name": "object.child_full_name", "type": "text", "label": "ФИО ребёнка (если применимо)" },
          { "name": "object.child_iin", "type": "text", "label": "ИИН ребёнка" }
        ],
        "next": "term"
      },

      /* STEP 6 — TERM */
      {
        "id": "term",
        "type": "radio",
        "title": "Срок согласия",
        "options": [
          { "value": "days", "label": "Дни (1–31)" },
          { "value": "months", "label": "Месяцы (1–36)" },
          { "value": "period", "label": "Период (дата с – по)" },
          { "value": "unlimited", "label": "Бессрочно" }
        ],
        "required": true,
        "next": {
          "days": "term_days",
          "months": "term_months",
          "period": "term_period",
          "unlimited": "extra"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "label": "Количество дней", "min": 1, "max": 31 }
        ],
        "next": "extra"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "label": "Количество месяцев", "min": 1, "max": 36 }
        ],
        "next": "extra"
      },

      {
        "id": "term_period",
        "type": "form",
        "fields": [
          { "name": "term.from", "type": "date", "label": "Дата начала" },
          { "name": "term.to", "type": "date", "label": "Дата окончания" }
        ],
        "next": "extra"
      },

      /* STEP 7 — EXTRA OPTIONS */
      {
        "id": "extra",
        "type": "checkbox-group",
        "title": "Дополнительные параметры",
        "options": [
          { "value": "third_parties", "label": "Передача третьим лицам" },
          { "value": "notifications", "label": "Получение уведомлений" },
          { "value": "signing", "label": "Подписание документов" },
          { "value": "originals", "label": "Получение оригиналов документов" },
          { "value": "personal_data", "label": "Получение персональных данных" },
          { "value": "limits", "label": "Ограничения (ручной ввод)" },
          { "value": "special", "label": "Особые условия (ручной ввод)" }
        ],
        "extra_fields": [
          { "name": "extra.limits_text", "type": "textarea", "label": "Ограничения" },
          { "name": "extra.special_text", "type": "textarea", "label": "Особые условия" }
        ],
        "next": "appear_type"
      },

      /* STEP 8 — APPEAR TYPE */
      {
        "id": "appear_type",
        "type": "radio",
        "title": "Как оформляется согласие?",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "required": true,
        "next": {
          "personal": "validate",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.number", "type": "text", "label": "Реестровый номер" },
          { "name": "poa.notary", "type": "text", "label": "Кем выдана" },
          { "name": "poa.issue_date", "type": "date", "label": "Дата выдачи" },
          { "name": "poa.license", "type": "text", "label": "Номер лицензии" },
          { "name": "poa.license_date", "type": "date", "label": "Дата выдачи лицензии" },
          {
            "name": "poa.attachments[]",
            "type": "file",
            "label": "Прикрепить копию доверенности",
            "min": 1,
            "max": 3
          }
        ],
        "next": "validate"
      },

      /* STEP 9 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required categories (>=1)",
          "required target",
          "if custom selected → required custom.text",
          "if object_needed == yes → required object.type",
          "required term",
          "if term.period → require term.from and term.to",
          "if appear_type == 'poa' → required poa.number"
        ],
        "next": "generate"
      },

      /* STEP 10 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal.full_name",
      "categories[]",
      "subtypes[]",
      "target.*",
      "object.*",
      "term.*",
      "extra.*",
      "poa.*"
    ]
  }
},
{
  "id": 16,
  "code": "DOC_016",
  "title": "Доверенность — участие в собраниях (ОСИ / КСК)",
  "category": "Доверенности / Собрания / ОСИ / КСК",

  "dev_notes": [
    "Доверитель всегда один. Обязательны данные личности и контакт.",
    "Поверенных может быть 1 или 2. На каждого — стандартный набор полей и 2 обязательных скана.",
    "Выбор организации (ТСЖ/ОСИ/КСК) — typeahead + множественный выбор + опция 'Выбрать всё'.",
    "Блок UNIT_DETAILS допускает множественные объекты (несколько квартир/долей).",
    "Тип собрания: единичное / многократное / период — у каждого свои поля.",
    "Повестка — чекбоксы + 'Выбрать всё', возможно добавление ручных пунктов.",
    "Инструкции по голосованию: глобальная инструкция, покомпонентная или 'делегировать решение'.",
    "Полномочия — чекбоксы + 'Выбрать всё', дополнительные ограничения.",
    "Если выбраны финансовые полномочия — показывать MATERIAL_LIMITS (лимиты).",
    "Если приход по доверенности — обязательные реквизиты исходной доверенности + upload скана.",
    "Валидация должна блокировать генерацию до заполнения всех обязательных полей.",
    "Генерация документа должна собирать: организацию, данные объектов, повестку, голосование, полномочия, лимиты, срок, делегирование."
  ],

  "rules_for_cursor": [
    "Показывать обязательные два скана для каждого поверенного.",
    "Если организация выбрана множественно — для каждой создать отдельный объект.",
    "UNIT_DETAILS может быть массивом объектов собственности.",
    "AGENDA имеет верхний чекбокс 'Выбрать всё'.",
    "Если выбран VOTING_INSTRUCTIONS = per_item — для каждого пункта нужно поле выбора (За/Против/Воздержаться/Делегировать).",
    "Если выбраны финансовые полномочия — MATERIAL_LIMITS обязательны.",
    "Срок — обязателен и зависит от типа режима.",
    "Право передоверия — strict required.",
    "Если appear_type == 'poa' — обязательны все поля по доверенности и скан.",
    "Cursor должен подставлять placeholders: {{PRINCIPAL}}, {{AGENTS}}, {{ASSOCIATION}}, {{UNIT_DETAILS}}, {{MEETING_SCOPE}}, {{AGENDA}}, {{VOTING}}, {{POWERS}}, {{LIMITS}}, {{POA_INFO}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — PRINCIPAL */
      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО" },
          { "name": "principal.iin", "type": "text", "label": "ИИН" },
          { "name": "principal.address", "type": "text", "label": "Адрес регистрации" },
          { "name": "principal.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "principal.document.number", "type": "text", "label": "Серия/номер" },
          { "name": "principal.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "principal.contact", "type": "text", "label": "Контакт" }
        ],
        "next": "agent_choice"
      },

      /* STEP 2 — AGENTS COUNT */
      {
        "id": "agent_choice",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": "1", "label": "1 поверенный" },
          { "value": "2", "label": "2 поверенных" }
        ],
        "required": true,
        "next": {
          "1": "agent1",
          "2": "agent1"
        }
      },

      /* STEP 3 — AGENT 1 */
      {
        "id": "agent1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agent1.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent1.iin", "type": "text", "label": "ИИН" },
          { "name": "agent1.address", "type": "text", "label": "Адрес" },
          { "name": "agent1.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "agent1.document.number", "type": "text", "label": "Серия/номер" },
          { "name": "agent1.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent1.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agent1.contact", "type": "text", "label": "Контакт" },
          {
            "name": "agent1.attachments[]",
            "type": "file",
            "label": "Сканы поверенного 1 (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "agent2_cond"
      },

      /* STEP 4 — Optional AGENT 2 */
      {
        "id": "agent2_cond",
        "type": "condition",
        "expression": "agent_choice == '2'",
        "next_if_true": "agent2",
        "next_if_false": "association"
      },

      {
        "id": "agent2",
        "type": "form",
        "title": "Поверенный 2",
        "fields": [
          { "name": "agent2.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent2.iin", "type": "text", "label": "ИИН" },
          { "name": "agent2.address", "type": "text", "label": "Адрес" },
          { "name": "agent2.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "agent2.document.number", "type": "text", "label": "Серия/номер" },
          { "name": "agent2.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent2.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agent2.contact", "type": "text", "label": "Контакт" },
          {
            "name": "agent2.attachments[]",
            "type": "file",
            "label": "Сканы поверенного 2 (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "association"
      },

      /* STEP 5 — ASSOCIATION SELECTION */
      {
        "id": "association",
        "type": "typeahead-multiselect",
        "title": "Организация / объект (ОСИ / КСК / ТСЖ)",
        "has_select_all": true,
        "fields": [
          { "name": "association.selected[]", "type": "typeahead", "label": "Выберите организацию" }
        ],
        "next": "unit_details"
      },

      /* STEP 6 — UNIT DETAILS */
      {
        "id": "unit_details",
        "type": "repeatable",
        "title": "Объекты собственности",
        "min": 1,
        "template": {
          "fields": [
            { "name": "unit.number", "type": "text", "label": "Квартира / помещение №" },
            { "name": "unit.share", "type": "text", "label": "Доля (%) или площадь" },
            { "name": "unit.docs", "type": "text", "label": "Правоустанавливающие документы" }
          ]
        },
        "next": "meeting_scope"
      },

      /* STEP 7 — MEETING SCOPE */
      {
        "id": "meeting_scope",
        "type": "radio",
        "title": "Режим собрания",
        "options": [
          { "value": "single", "label": "Единичное собрание" },
          { "value": "multiple", "label": "Несколько дат / повторяющиеся" },
          { "value": "period", "label": "Все собрания за период" }
        ],
        "required": true,
        "next": {
          "single": "meeting_single",
          "multiple": "meeting_multi",
          "period": "meeting_period"
        }
      },

      {
        "id": "meeting_single",
        "type": "form",
        "fields": [
          { "name": "meeting.date", "type": "datetime", "label": "Дата и время" },
          { "name": "meeting.place", "type": "text", "label": "Место проведения" }
        ],
        "next": "agenda"
      },

      {
        "id": "meeting_multi",
        "type": "form",
        "fields": [
          { "name": "meeting.dates[]", "type": "date", "label": "Дата (можно несколько)" },
          { "name": "meeting.rule", "type": "text", "label": "Правило (например: ежемесячно)" }
        ],
        "next": "agenda"
      },

      {
        "id": "meeting_period",
        "type": "form",
        "fields": [
          { "name": "meeting.from", "type": "date", "label": "Период: с" },
          { "name": "meeting.to", "type": "date", "label": "Период: по" }
        ],
        "next": "agenda"
      },

      /* STEP 8 — AGENDA */
      {
        "id": "agenda",
        "type": "checkbox-group",
        "title": "Повестка собрания",
        "has_select_all": true,
        "options": [
          { "value": "report", "label": "Отчёт правления / бухгалтерский отчёт" },
          { "value": "elections", "label": "Выборы правления / председателя" },
          { "value": "tariffs", "label": "Утверждение тарифов / сборов" },
          { "value": "repair", "label": "Капитальный ремонт / распределение средств" },
          { "value": "common_property", "label": "Сделки с общим имуществом" },
          { "value": "contracts", "label": "Проекты договоров с подрядчиками" },
          { "value": "other", "label": "Иные вопросы (ручной ввод)" }
        ],
        "extra_fields": [
          { "name": "agenda.other_text", "type": "textarea", "label": "Иные вопросы" }
        ],
        "min": 1,
        "next": "voting"
      },

      /* STEP 9 — VOTING INSTRUCTIONS */
      {
        "id": "voting",
        "type": "radio",
        "title": "Инструкции по голосованию",
        "options": [
          { "value": "global", "label": "Одна инструкция для всех пунктов" },
          { "value": "per_item", "label": "Раздельно по каждому пункту" },
          { "value": "free", "label": "На усмотрение поверенного" }
        ],
        "required": true,
        "next": {
          "global": "voting_global",
          "per_item": "voting_per_item",
          "free": "powers"
        }
      },

      {
        "id": "voting_global",
        "type": "radio",
        "title": "Глобальная инструкция",
        "options": [
          { "value": "for", "label": "За" },
          { "value": "against", "label": "Против" },
          { "value": "abstain", "label": "Воздержаться" },
          { "value": "delegate", "label": "Делегировать решение поверенному" }
        ],
        "required": true,
        "next": "powers"
      },

      {
        "id": "voting_per_item",
        "type": "dynamic-per-item",
        "title": "Голосование по каждому пункту",
        "options": [
          { "value": "for", "label": "За" },
          { "value": "against", "label": "Против" },
          { "value": "abstain", "label": "Воздержаться" },
          { "value": "delegate", "label": "Делегировать" }
        ],
        "next": "powers"
      },

      /* STEP 10 — POWERS */
      {
        "id": "powers",
        "type": "checkbox-group",
        "title": "Полномочия поверенного",
        "has_select_all": true,
        "options": [
          { "value": "represent", "label": "Представлять интересы" },
          { "value": "attend", "label": "Присутствовать на собрании" },
          { "value": "vote", "label": "Голосовать по повестке" },
          { "value": "sign_protocol", "label": "Подписывать протокол" },
          { "value": "propose", "label": "Предлагать пункты повестки" },
          { "value": "sign_contracts", "label": "Подписывать договоры" },
          { "value": "receive_docs", "label": "Получать документы" },
          { "value": "submit_claims", "label": "Подача заявлений/жалоб" },
          { "value": "other", "label": "Иные полномочия" }
        ],
        "extra_fields": [
          { "name": "powers.other_text", "type": "textarea", "label": "Иные полномочия" }
        ],
        "min": 1,
        "next": "limits"
      },

      /* STEP 11 — LIMITS */
      {
        "id": "limits",
        "type": "form",
        "title": "Финансовые ограничения (опционально)",
        "fields": [
          { "name": "limits.amount", "type": "number", "label": "Лимит суммы" },
          { "name": "limits.contract_limit", "type": "number", "label": "Лимит на договоры" }
        ],
        "next": "delegation"
      },

      /* STEP 12 — DELEGATION */
      {
        "id": "delegation",
        "type": "radio",
        "title": "Право передоверия",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "required": true,
        "next": "appear_type"
      },

      /* STEP 13 — APPEAR TYPE */
      {
        "id": "appear_type",
        "type": "radio",
        "title": "Приход",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "required": true,
        "next": {
          "personal": "validate",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты исходной доверенности",
        "fields": [
          { "name": "poa.number", "type": "text", "label": "Реестровый номер" },
          { "name": "poa.notary", "type": "text", "label": "Кем выдана" },
          { "name": "poa.issue_date", "type": "date", "label": "Дата выдачи" },
          { "name": "poa.license", "type": "text", "label": "Номер лицензии" },
          { "name": "poa.license_date", "type": "date", "label": "Дата выдачи лицензии" },
          {
            "name": "poa.attachments[]",
            "type": "file",
            "label": "Скан доверенности (1 файл)",
            "min": 1,
            "max": 3
          }
        ],
        "next": "validate"
      },

      /* STEP 14 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required association.selected (>=1)",
          "required unit_details",
          "required meeting_scope",
          "required agenda (>=1)",
          "required powers (>=1)",
          "if appear_type == 'poa' → required poa.number"
        ],
        "next": "generate"
      },

      /* STEP 15 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal.full_name",
      "agents[]",
      "association[]",
      "unit_details[]",
      "meeting_scope",
      "agenda[]",
      "voting",
      "powers[]",
      "limits.*",
      "delegation",
      "poa.*"
    ]
  }
},
{
  "id": 17,
  "code": "DOC_017",
  "title": "Доверенность — управление недвижимым имуществом (кроме продажи)",
  "category": "Доверенности / Недвижимость / Управление",

  "dev_notes": [
    "Доверитель всегда один. На доверителя — обязательные стандартные поля.",
    "Поверенных может быть 1 или 2. На каждого — обязательные 2 скана документа.",
    "PROPERTY_BLOCK должен поддерживать множественные объекты недвижимости (repeatable).",
    "При выборе полномочий, связанных с финансами (оплата, аренда, получение платежей) — MATERIAL_LIMITS становятся обязательными.",
    "POWERS_BLOCK должен иметь 'Выбрать всё'.",
    "Формат срока — дни или месяцы.",
    "Право передоверия — обязательный radio.",
    "Если приход по доверенности — обязательные реквизиты исходной доверенности и загрузка скана.",
    "Валидация: объект недвижимости обязателен, минимум одно полномочие обяз., срок обяз., делегирование обяз.",
    "Генерация документа должна собирать: объекты, полномочия, финансовые лимиты, срок, делегирование, реквизиты доверенности."
  ],

  "rules_for_cursor": [
    "Всегда требовать 2 скана для каждого поверенного.",
    "PROPERTY_BLOCK может содержать несколько объектов — repeatable.",
    "Если выбраны полномочия, требующие финансовых операций → MATERIAL_LIMITS обязательны.",
    "POWERS_BLOCK — использовать чекбокс 'Выбрать всё'.",
    "Срок — обязательный выбор между днями и месяцами.",
    "Право передоверия — required.",
    "Если appear_type == 'poa' → обязательны реквизиты poa + upload.",
    "Cursor должен использовать плейсхолдеры: {{PRINCIPAL}}, {{AGENTS}}, {{PROPERTY}}, {{POWERS_LIST}}, {{FIN_LIMITS}}, {{DOC_REQ}}, {{TERM}}, {{DELEGATION}}, {{POA_INFO}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — PRINCIPAL */
      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО" },
          { "name": "principal.iin", "type": "text", "label": "ИИН" },
          { "name": "principal.address", "type": "text", "label": "Адрес регистрации" },
          { "name": "principal.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "principal.document.number", "type": "text", "label": "Серия/номер" },
          { "name": "principal.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "principal.contact", "type": "text", "label": "Контакт" }
        ],
        "next": "agent_choice"
      },

      /* STEP 2 — Number of Agents */
      {
        "id": "agent_choice",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": "1", "label": "1 поверенный" },
          { "value": "2", "label": "2 поверенных" }
        ],
        "required": true,
        "next": {
          "1": "agent1",
          "2": "agent1"
        }
      },

      /* STEP 3 — AGENT 1 */
      {
        "id": "agent1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agent1.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent1.iin", "type": "text", "label": "ИИН" },
          { "name": "agent1.address", "type": "text", "label": "Адрес" },
          { "name": "agent1.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "agent1.document.number", "type": "text", "label": "Серия/номер" },
          { "name": "agent1.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent1.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agent1.contact", "type": "text", "label": "Контакт" },
          {
            "name": "agent1.attachments[]",
            "type": "file",
            "label": "Сканы поверенного 1 (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "agent2_cond"
      },

      /* STEP 4 — AGENT 2 (conditional) */
      {
        "id": "agent2_cond",
        "type": "condition",
        "expression": "agent_choice == '2'",
        "next_if_true": "agent2",
        "next_if_false": "property"
      },

      {
        "id": "agent2",
        "type": "form",
        "title": "Поверенный 2",
        "fields": [
          { "name": "agent2.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent2.iin", "type": "text", "label": "ИИН" },
          { "name": "agent2.address", "type": "text", "label": "Адрес" },
          { "name": "agent2.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "agent2.document.number", "type": "text", "label": "Серия/номер" },
          { "name": "agent2.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent2.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "agent2.contact", "type": "text", "label": "Контакт" },
          {
            "name": "agent2.attachments[]",
            "type": "file",
            "label": "Сканы поверенного 2 (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "property"
      },

      /* STEP 5 — PROPERTY BLOCK */
      {
        "id": "property",
        "type": "repeatable",
        "title": "Объекты недвижимости",
        "min": 1,
        "template": {
          "fields": [
            {
              "name": "property.type",
              "type": "select",
              "label": "Тип объекта",
              "options": ["Квартира", "Дом", "Нежилое помещение", "Земельный участок"]
            },
            { "name": "property.address", "type": "text", "label": "Полный адрес" },
            { "name": "property.kadastr", "type": "text", "label": "Кадастровый номер" },
            { "name": "property.docs", "type": "text", "label": "Правоустанавливающие документы" },
            { "name": "property.share", "type": "text", "label": "Доля (%)" }
          ]
        },
        "next": "powers"
      },

      /* STEP 6 — POWERS */
      {
        "id": "powers",
        "type": "checkbox-group",
        "title": "Полномочия по управлению объектом",
        "has_select_all": true,
        "options": [
          { "value": "manage", "label": "Управление и содержание объекта" },
          { "value": "registration", "label": "Оформлять прописку/снятие с учета" },
          { "value": "rent_contracts", "label": "Заключать/расторгать договоры аренды" },
          { "value": "act_sign", "label": "Подписывать акты приема-передачи" },
          { "value": "receive_payments", "label": "Получать арендную плату" },
          { "value": "pay_utilities", "label": "Оплачивать коммунальные услуги" },
          { "value": "maintenance", "label": "Организовывать ремонт" },
          { "value": "submit_docs", "label": "Подача/получение документов в органах" },
          { "value": "third_party_poa", "label": "Передоверие третьим лицам" },
          { "value": "other", "label": "Иные полномочия" }
        ],
        "extra_fields": [
          { "name": "powers.other_text", "type": "textarea", "label": "Уточните иные полномочия" }
        ],
        "min": 1,
        "next": "fin_limits"
      },

      /* STEP 7 — FINANCIAL LIMITS */
      {
        "id": "fin_limits",
        "type": "form",
        "title": "Финансовые ограничения",
        "fields": [
          { "name": "limits.single", "type": "number", "label": "Разовый лимит" },
          { "name": "limits.total", "type": "number", "label": "Суммарный лимит" },
          { "name": "limits.contract_limit", "type": "number", "label": "Лимит на договоры" }
        ],
        "next": "doc_req"
      },

      /* STEP 8 — ADDITIONAL REQUIREMENTS */
      {
        "id": "doc_req",
        "type": "checkbox-group",
        "title": "Дополнительные требования",
        "options": [
          { "value": "original_required", "label": "Требуется оригинал доверенности" },
          { "value": "notary_copy", "label": "Нотариальная копия допускается" },
          { "value": "reporting", "label": "Потребовать периодический отчёт" },
          { "value": "other", "label": "Особые требования" }
        ],
        "extra_fields": [
          { "name": "doc_req.other_text", "type": "textarea", "label": "Особые условия" }
        ],
        "next": "term"
      },

      /* STEP 9 — TERM */
      {
        "id": "term",
        "type": "radio",
        "title": "Срок доверенности",
        "options": [
          { "value": "days", "label": "Дни (1–31)" },
          { "value": "months", "label": "Месяцы (1–36)" }
        ],
        "required": true,
        "next": {
          "days": "term_days",
          "months": "term_months"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "min": 1, "max": 31, "label": "Количество дней" }
        ],
        "next": "delegation"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "min": 1, "max": 36, "label": "Количество месяцев" }
        ],
        "next": "delegation"
      },

      /* STEP 10 — DELEGATION */
      {
        "id": "delegation",
        "type": "radio",
        "title": "Право передоверия",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "required": true,
        "next": "appear"
      },

      /* STEP 11 — APPEAR TYPE */
      {
        "id": "appear",
        "type": "radio",
        "title": "Как пришёл доверитель?",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "required": true,
        "next": {
          "personal": "validate",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты исходной доверенности",
        "fields": [
          { "name": "poa.number", "type": "text", "label": "Реестровый номер" },
          { "name": "poa.notary", "type": "text", "label": "Кем выдана" },
          { "name": "poa.issue_date", "type": "date", "label": "Дата выдачи" },
          { "name": "poa.license", "type": "text", "label": "Номер лицензии" },
          { "name": "poa.license_date", "type": "date", "label": "Дата выдачи лицензии" },
          {
            "name": "poa.attachments[]",
            "type": "file",
            "label": "Скан доверенности",
            "min": 1,
            "max": 3
          }
        ],
        "next": "validate"
      },

      /* STEP 12 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required property (>=1)",
          "required powers (>=1)",
          "required term",
          "required delegation",
          "if appear == 'poa' → required poa.number"
        ],
        "next": "generate"
      },

      /* STEP 13 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal.full_name",
      "agents[]",
      "property[]",
      "powers[]",
      "limits.*",
      "doc_req.*",
      "term.*",
      "delegation",
      "poa.*"
    ]
  }
}, 
{
  "id": 18,
  "code": "DOC_018",
  "title": "Согласие родственника на выезд на ПМЖ",
  "category": "ПМЖ / Согласия / Родственники",

  "dev_notes": [
    "4 варианта дающего согласие: родитель, супруг/супруга, совершеннолетний ребенок, иной родственник.",
    "У каждого варианта — одинаковая структура данных: ФИО, ИИН, документ, адрес.",
    "Выезжающий на ПМЖ — обязательный блок: ФИО, ИИН, дата рождения, документ.",
    "Страна ПМЖ — обязательна (одно значение из списка).",
    "При выборе 'Весь мир' — фактически select all.",
    "Дополнительные параметры — чекбоксы + поле для ручного ввода.",
    "Несовершеннолетние дети — массив 0–10 детей.",
    "Если выбрано 'По доверенности' → обязательные реквизиты доверенности + upload.",
    "Плейсхолдеры для документа: {{giver}}, {{recipient}}, {{country}}, {{city}}, {{minors}}, {{extra}}, {{term}}, {{poa_info}}."
  ],

  "rules_for_cursor": [
    "giver.* — required",
    "recipient.* — required",
    "country — required",
    "term.* — required",
    "If minors_count > 0 → minors[].full_name required",
    "If appear_type == 'poa' → require poa.registry, poa.scan",
    "Placeholders must match Word template exactly"
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — WHO GIVES CONSENT */
      {
        "id": "giver_type",
        "type": "radio",
        "title": "Кто даёт согласие?",
        "required": true,
        "options": [
          { "value": "parent", "label": "Родитель" },
          { "value": "spouse", "label": "Супруг / супруга" },
          { "value": "adult_child", "label": "Совершеннолетний ребёнок" },
          { "value": "relative", "label": "Иной родственник" }
        ],
        "next": {
          "parent": "giver_parent",
          "spouse": "giver_spouse",
          "adult_child": "giver_child",
          "relative": "giver_relative"
        }
      },

      {
        "id": "giver_parent",
        "type": "form",
        "title": "Дает согласие — Родитель",
        "fields": [
          { "name": "giver.full_name", "label": "ФИО", "type": "text" },
          { "name": "giver.iin", "label": "ИИН", "type": "text" },
          { "name": "giver.birth_date", "label": "Дата рождения", "type": "date" },
          { "name": "giver.pass.type", "label": "Тип документа", "type": "text" },
          { "name": "giver.pass.number", "label": "Серия и номер", "type": "text" },
          { "name": "giver.pass.issued_by", "label": "Кем выдан", "type": "text" },
          { "name": "giver.pass.issued_date", "label": "Дата выдачи", "type": "date" },
          { "name": "giver.address", "label": "Адрес регистрации", "type": "text" }
        ],
        "next": "recipient"
      },

      {
        "id": "giver_spouse",
        "type": "form",
        "title": "Дает согласие — Супруг / супруга",
        "fields": [
          { "name": "giver.full_name", "type": "text", "label": "ФИО" },
          { "name": "giver.iin", "type": "text", "label": "ИИН" },
          { "name": "giver.passport", "type": "text", "label": "Документ личности" },
          { "name": "giver.address", "type": "text", "label": "Адрес" },
          { "name": "giver.marriage_info", "type": "text", "label": "Данные о браке (опц.)" }
        ],
        "next": "recipient"
      },

      {
        "id": "giver_child",
        "type": "form",
        "title": "Дает согласие — Совершеннолетний ребенок",
        "fields": [
          { "name": "giver.full_name", "type": "text", "label": "ФИО" },
          { "name": "giver.iin", "type": "text", "label": "ИИН" },
          { "name": "giver.passport", "type": "text", "label": "Документ личности" },
          { "name": "giver.address", "type": "text", "label": "Адрес" }
        ],
        "next": "recipient"
      },

      {
        "id": "giver_relative",
        "type": "form",
        "title": "Дает согласие — Иной родственник",
        "fields": [
          { "name": "giver.full_name", "type": "text", "label": "ФИО" },
          { "name": "giver.iin", "type": "text", "label": "ИИН" },
          { "name": "giver.relation", "type": "text", "label": "Родство" },
          { "name": "giver.passport", "type": "text", "label": "Документ личности" },
          { "name": "giver.address", "type": "text", "label": "Адрес" }
        ],
        "next": "recipient"
      },

      /* STEP 2 — RECIPIENT */
      {
        "id": "recipient",
        "type": "form",
        "title": "Лицо, выезжающее на ПМЖ",
        "fields": [
          { "name": "recipient.full_name", "type": "text", "label": "ФИО" },
          { "name": "recipient.iin", "type": "text", "label": "ИИН" },
          { "name": "recipient.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "recipient.passport", "type": "text", "label": "Документ личности" }
        ],
        "required": true,
        "next": "country"
      },

      /* STEP 3 — COUNTRY */
      {
        "id": "country",
        "type": "radio",
        "title": "Страна ПМЖ",
        "required": true,
        "options": [
          { "value": "world", "label": "Весь мир" },
          { "value": "select", "label": "Выбрать страну" }
        ],
        "next": {
          "world": "city",
          "select": "country_list"
        }
      },

      {
        "id": "country_list",
        "type": "select",
        "title": "Выберите страну",
        "options_source": "country_list",
        "required": true,
        "next": "city"
      },

      {
        "id": "city",
        "type": "text",
        "title": "Город / регион ПМЖ",
        "name": "city",
        "required": false,
        "next": "purpose"
      },

      /* STEP 4 — PURPOSE (auto) */
      {
        "id": "purpose",
        "type": "info",
        "title": "Суть согласия",
        "text": "Даю согласие на выезд {{recipient.full_name}} на постоянное место жительства в {{country}}.",
        "next": "add_info"
      },

      /* STEP 5 — ADDITIONAL OPTIONS */
      {
        "id": "add_info",
        "type": "checkbox-group",
        "title": "Дополнительные параметры",
        "options": [
          { "value": "deregistration", "label": "Согласие на снятие с регистрационного учета" },
          { "value": "documents", "label": "Согласие на оформление выездных документов" },
          { "value": "with_children", "label": "Согласие на выезд вместе с несовершеннолетними детьми" },
          { "value": "no_property_claims", "label": "Подтверждение отсутствия имущественных претензий" },
          { "value": "no_obstacles", "label": "Отсутствие препятствий со стороны родственника" },
          { "value": "other", "label": "Иное" }
        ],
        "next": "minors"
      },

      /* STEP 6 — MINORS */
      {
        "id": "minors",
        "type": "radio",
        "title": "Выезжают ли несовершеннолетние дети?",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "required": true,
        "next": {
          "yes": "minors_data",
          "no": "term"
        }
      },

      {
        "id": "minors_data",
        "type": "list",
        "title": "Данные несовершеннолетних детей",
        "fields": [
          { "name": "minors[].full_name", "label": "ФИО", "type": "text" },
          { "name": "minors[].iin", "label": "ИИН", "type": "text" },
          { "name": "minors[].birth_date", "label": "Дата рождения", "type": "date" },
          { "name": "minors[].doc", "label": "Свидетельство о рождении", "type": "text" }
        ],
        "minItems": 1,
        "maxItems": 10,
        "next": "term"
      },

      /* STEP 7 — TERM */
      {
        "id": "term",
        "type": "radio",
        "title": "Срок действия согласия",
        "options": [
          { "value": "days", "label": "На количество дней" },
          { "value": "months", "label": "На количество месяцев" },
          { "value": "open", "label": "Бессрочно" }
        ],
        "required": true,
        "next": {
          "days": "term_days",
          "months": "term_months",
          "open": "appear"
        }
      },

      {
        "id": "term_days",
        "type": "number",
        "title": "Количество дней",
        "min": 1,
        "max": 31,
        "name": "term.days",
        "next": "appear"
      },

      {
        "id": "term_months",
        "type": "number",
        "title": "Количество месяцев",
        "min": 1,
        "max": 36,
        "name": "term.months",
        "next": "appear"
      },

      /* STEP 8 — APPEAR TYPE */
      {
        "id": "appear",
        "type": "radio",
        "title": "Обратившийся действует:",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "required": true,
        "next": {
          "personal": "validate",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.registry", "type": "text", "label": "Реестровый номер" },
          { "name": "poa.issued_by", "type": "text", "label": "Кем выдана" },
          { "name": "poa.license", "type": "text", "label": "Номер лицензии" },
          { "name": "poa.date", "type": "date", "label": "Дата выдачи доверенности" },
          { "name": "poa.license_date", "type": "date", "label": "Дата выдачи лицензии" },
          { "name": "poa.scan", "type": "file", "label": "Прикрепить копию", "min": 1 }
        ],
        "next": "validate"
      },

      /* STEP 9 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required giver",
          "required recipient",
          "required country",
          "if minors selected → require minors data",
          "required term",
          "if appear_type == 'poa' → require poa.registry and poa.scan"
        ],
        "next": "generate"
      },

      /* STEP 10 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "giver",
      "recipient",
      "country",
      "city",
      "minors",
      "extra",
      "term",
      "poa_info"
    ]
  }
},
{
  "id": 19,
  "code": "DOC_019",
  "title": "Согласие на регистрацию (временную / постоянную)",
  "category": "Согласия / Регистрация / Проживание",

  "dev_notes": [
    "Доверитель может быть: собственник, арендодатель, проживающий совладелец.",
    "Получатель согласия — одно лицо или несколько (семья). Для каждого: ФИО, ИИН, дата рождения, документ.",
    "Тип регистрации — временная или постоянная. Можно выбрать один или оба.",
    "Если временная регистрация — обязательно указать срок: даты или количество дней/месяцев.",
    "Блок адреса обязателен: улица, дом, корпус, квартира, кадастр, основание собственности/договора.",
    "Список документов — drop-list + чекбокс 'Выбрать всё'.",
    "Если приход 'по доверенности' — обязательные реквизиты исходной доверенности + upload скана.",
    "Валидация строго блокирует переход.",
    "Вывод документа: получатели, тип регистрации, срок, адрес, документы, основания, условия, реквизиты доверенности.",
    "Плейсхолдеры должны перечислять всех получателей, срок, дату начала/окончания, документы."
  ],

  "rules_for_cursor": [
    "WHO_GIVES — обязательный radio (3 варианта).",
    "RECIPIENTS — repeatable: min=1, max=10.",
    "REGISTRATION_TYPE — минимум один из двух чекбоксов.",
    "Если выбрана временная регистрация → обязательно TERM или DATE_RANGE.",
    "ADDRESS_BLOCK обязателен и не может быть пропущен.",
    "DOCS_BLOCK имеет 'Выбрать всё'.",
    "Если appear == poa — обязательные poa поля + файл.",
    "Валидация: доверитель обязателен, минимум один получатель, адрес заполнен, документы выбраны.",
    "Cursor должен использовать плейсхолдеры {{giver}}, {{recipients}}, {{address}}, {{reg_type}}, {{term}}, {{docs}}, {{poa_info}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — GIVER TYPE */
      {
        "id": "giver_type",
        "type": "radio",
        "title": "Кто даёт согласие?",
        "options": [
          { "value": "owner", "label": "Собственник помещения" },
          { "value": "landlord", "label": "Наниматель / арендодатель" },
          { "value": "resident", "label": "Проживающий (совладелец, сосед)" }
        ],
        "required": true,
        "next": "giver"
      },

      /* STEP 2 — GIVER FORM */
      {
        "id": "giver",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "giver.full_name", "type": "text", "label": "ФИО / Наименование" },
          { "name": "giver.iin_bin", "type": "text", "label": "ИИН / БИН" },
          { "name": "giver.address", "type": "text", "label": "Адрес прописки / регистрации" },
          { "name": "giver.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "giver.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "giver.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "giver.document.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "giver.contact", "type": "text", "label": "Контакт" }
        ],
        "next": "recipients"
      },

      /* STEP 3 — RECIPIENTS */
      {
        "id": "recipients",
        "type": "repeatable",
        "title": "Кому даётся согласие",
        "min": 1,
        "max": 10,
        "template": {
          "fields": [
            { "name": "recipient.full_name", "type": "text", "label": "ФИО" },
            { "name": "recipient.iin", "type": "text", "label": "ИИН" },
            { "name": "recipient.birth_date", "type": "date", "label": "Дата рождения" },
            { "name": "recipient.document", "type": "text", "label": "Документ личности" }
          ]
        },
        "next": "reg_type"
      },

      /* STEP 4 — REGISTRATION TYPE */
      {
        "id": "reg_type",
        "type": "checkbox-group",
        "title": "Тип регистрации",
        "options": [
          { "value": "temporary", "label": "Временная" },
          { "value": "permanent", "label": "Постоянная" }
        ],
        "min": 1,
        "next": "address"
      },

      /* STEP 5 — ADDRESS BLOCK */
      {
        "id": "address",
        "type": "form",
        "title": "Адрес объекта",
        "fields": [
          { "name": "address.full_address", "type": "text", "label": "Полный адрес" },
          { "name": "address.kadastr", "type": "text", "label": "Кадастровый / адресный код" },
          { "name": "address.document_number", "type": "text", "label": "Правоустанавливающий документ №" },
          { "name": "address.rental_contract", "type": "text", "label": "Договор аренды № (опц.)" }
        ],
        "required": true,
        "next": "temp_cond"
      },

      /* STEP 6 — IF TEMPORARY */
      {
        "id": "temp_cond",
        "type": "condition",
        "expression": "includes(reg_type, 'temporary')",
        "next_if_true": "temp_term_type",
        "next_if_false": "purpose"
      },

      {
        "id": "temp_term_type",
        "type": "radio",
        "title": "Формат срока временной регистрации",
        "options": [
          { "value": "dates", "label": "Даты начала и окончания" },
          { "value": "term", "label": "Срок в днях/месяцах" }
        ],
        "next": {
          "dates": "temp_dates",
          "term": "temp_duration"
        }
      },

      {
        "id": "temp_dates",
        "type": "form",
        "title": "Даты",
        "fields": [
          { "name": "temp.start_date", "type": "date", "label": "Дата начала" },
          { "name": "temp.end_date", "type": "date", "label": "Дата окончания" }
        ],
        "next": "purpose"
      },

      {
        "id": "temp_duration",
        "type": "form",
        "title": "Срок",
        "fields": [
          { "name": "temp.days", "type": "number", "label": "Дни (1–31)", "min": 1, "max": 31 },
          { "name": "temp.months", "type": "number", "label": "Месяцы (1–36)", "min": 1, "max": 36 }
        ],
        "next": "purpose"
      },

      /* STEP 7 — PURPOSE BLOCK */
      {
        "id": "purpose",
        "type": "checkbox-group",
        "title": "Цель / условия согласия",
        "options": [
          { "value": "residence", "label": "Регистрация для проживания" },
          { "value": "temporary_reason", "label": "Временное проживание (учёба/работа)" },
          { "value": "set_remove", "label": "Постановка/снятие с регистрационного учета" },
          { "value": "notify_only", "label": "Только с уведомлением собственника" }
        ],
        "extra_fields": [
          { "name": "purpose.custom", "type": "textarea", "label": "Ограничения / условия" }
        ],
        "next": "docs"
      },

      /* STEP 8 — DOCUMENTS */
      {
        "id": "docs",
        "type": "checkbox-group",
        "title": "Подтверждающие документы",
        "has_select_all": true,
        "options": [
          { "value": "passport", "label": "Паспорт / удостоверение" },
          { "value": "rental_contract", "label": "Договор аренды" },
          { "value": "ownership_doc", "label": "Правоустанавливающий документ" },
          { "value": "coowners", "label": "Согласие совладельцев" },
          { "value": "family_certificate", "label": "Справка о составе семьи" }
        ],
        "extra_fields": [
          { "name": "docs.other", "type": "text", "label": "Другое" }
        ],
        "min": 1,
        "next": "appear"
      },

      /* STEP 9 — APPEAR */
      {
        "id": "appear",
        "type": "radio",
        "title": "Как подаётся согласие?",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "required": true,
        "next": {
          "personal": "validate",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.number", "type": "text", "label": "Реестровый номер доверенности" },
          { "name": "poa.issued_by", "type": "text", "label": "Кем выдана" },
          { "name": "poa.issue_date", "type": "date", "label": "Дата выдачи" },
          { "name": "poa.license", "type": "text", "label": "Номер лицензии нотариуса" },
          {
            "name": "poa.attachments[]",
            "type": "file",
            "label": "Скан доверенности",
            "min": 1,
            "max": 3
          }
        ],
        "next": "validate"
      },

      /* STEP 10 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required giver.full_name",
          "required recipients (>=1)",
          "required address.full_address",
          "required docs (>=1)",
          "if includes(reg_type, 'temporary') → require temp fields",
          "if appear == 'poa' → require poa.number"
        ],
        "next": "generate"
      },

      /* STEP 11 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "giver.full_name",
      "recipients[]",
      "address.*",
      "reg_type[]",
      "temp.*",
      "purpose[]",
      "docs[]",
      "poa.*"
    ]
  }
},
{
  "id": 20,
  "code": "DOC_020",
  "title": "Заявление об отмене (отзыве) доверенности",
  "category": "Доверенности / Отмена / Юридические действия",

  "dev_notes": [
    "Тип заявителя — 3 варианта: доверитель, поверенный, иное лицо.",
    "Реквизиты отменяемой доверенности — обязательный блок.",
    "Если оригинал или копия доверенности загружается — файл обязателен.",
    "Если нет оригинала/копии — система должна потребовать текстовое обоснование.",
    "Проверка данных доверенности — часть логики (можно расширить в будущем).",
    "При выборе 'по доверенности' — обязателен upload + поля реквизитов.",
    "Процесс включает решение: есть основания или нужны дополнительные документы.",
    "Плейсхолдеры должны включать заявителя, реквизиты доверенности, причины, статус документов, результат.",
    "Строгая валидация: без обязательных реквизитов документ не генерируем.",
    "Cursor должен соблюдать branching: ORIGINAL / COPY / NO_DOCS → разные обязательные поля."
  ],

  "rules_for_cursor": [
    "APPLICANT_TYPE — обязательный выбор из 3 вариантов.",
    "Если applicant == 'other' → поле relationship обязательно.",
    "POA_DETAILS — все поля обязательны.",
    "ORIGINAL_AVAIL — три варианта → ORIGINAL_UPLOAD / COPY_UPLOAD / NO_DOCS.",
    "Если ORIGINAL_UPLOAD → мин. 1 файл.",
    "Если COPY_UPLOAD → мин. 1 файл.",
    "Если NO_DOCS → require justification_reason.",
    "Валидация должна блокировать генерацию при отсутствии обязательных данных.",
    "Cursor использует плейсхолдеры: {{applicant}}, {{poa}}, {{reason}}, {{notify_agent}}, {{attachments}}, {{registry_status}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — APPLICANT TYPE */
      {
        "id": "applicant_type",
        "type": "radio",
        "title": "Кто подаёт заявление?",
        "options": [
          { "value": "principal", "label": "Доверитель (кто выдавал доверенность)" },
          { "value": "agent", "label": "Поверенный" },
          { "value": "other", "label": "Иное лицо / представитель" }
        ],
        "required": true,
        "next": {
          "principal": "applicant_form",
          "agent": "applicant_form",
          "other": "applicant_other"
        }
      },

      /* STEP 2 — APPLICANT OTHER (extra field) */
      {
        "id": "applicant_other",
        "type": "form",
        "title": "Данные заявителя (иное лицо)",
        "fields": [
          { "name": "applicant.full_name", "type": "text", "label": "ФИО" },
          { "name": "applicant.iin", "type": "text", "label": "ИИН" },
          { "name": "applicant.document", "type": "text", "label": "Документ личности" },
          { "name": "applicant.address", "type": "text", "label": "Адрес" },
          { "name": "applicant.relationship", "type": "text", "label": "Отношение к доверенности" },
          { "name": "applicant.contact", "type": "text", "label": "Контакт" }
        ],
        "next": "poa_details"
      },

      /* STEP 3 — APPLICANT FORM */
      {
        "id": "applicant_form",
        "type": "form",
        "title": "Данные заявителя",
        "fields": [
          { "name": "applicant.full_name", "type": "text", "label": "ФИО" },
          { "name": "applicant.iin", "type": "text", "label": "ИИН" },
          { "name": "applicant.document", "type": "text", "label": "Документ личности" },
          { "name": "applicant.address", "type": "text", "label": "Адрес" },
          { "name": "applicant.contact", "type": "text", "label": "Контакт" }
        ],
        "next": "poa_details"
      },

      /* STEP 4 — POA DETAILS (mandatory) */
      {
        "id": "poa_details",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.reg_number", "type": "text", "label": "Реестровый номер" },
          { "name": "poa.issue_date", "type": "date", "label": "Дата выдачи" },
          { "name": "poa.issued_by", "type": "text", "label": "Кем выдана (ФИО нотариуса / контора)" },
          { "name": "poa.license_number", "type": "text", "label": "Номер лицензии нотариуса" },
          { "name": "poa.license_issue_date", "type": "date", "label": "Дата выдачи лицензии" },
          { "name": "poa.license_issuer", "type": "text", "label": "Кем выдана лицензия" },
          { "name": "poa.summary", "type": "textarea", "label": "Краткое содержание доверенности / цель" }
        ],
        "required": true,
        "next": "original_avail"
      },

      /* STEP 5 — ORIGINAL / COPY / NO DOCS */
      {
        "id": "original_avail",
        "type": "radio",
        "title": "Наличие оригинала или копии доверенности",
        "options": [
          { "value": "original", "label": "Есть оригинал" },
          { "value": "copy", "label": "Есть копия" },
          { "value": "none", "label": "Нет документов" }
        ],
        "required": true,
        "next": {
          "original": "original_upload",
          "copy": "copy_upload",
          "none": "no_docs"
        }
      },

      /* STEP 6A — ORIGINAL UPLOAD */
      {
        "id": "original_upload",
        "type": "form",
        "title": "Загрузка оригинала доверенности",
        "fields": [
          {
            "name": "attachments.original[]",
            "type": "file",
            "label": "Скан оригинала",
            "min": 1,
            "max": 5
          }
        ],
        "next": "registry_check"
      },

      /* STEP 6B — COPY UPLOAD */
      {
        "id": "copy_upload",
        "type": "form",
        "title": "Загрузка копии доверенности",
        "fields": [
          {
            "name": "attachments.copy[]",
            "type": "file",
            "label": "Скан копии",
            "min": 1,
            "max": 5
          }
        ],
        "next": "registry_check"
      },

      /* STEP 6C — NO DOCS JUSTIFICATION */
      {
        "id": "no_docs",
        "type": "form",
        "title": "Нет документов",
        "fields": [
          { "name": "no_docs.reason", "type": "textarea", "label": "Укажите причину отсутствия документов" }
        ],
        "required": true,
        "next": "registry_check"
      },

      /* STEP 7 — REGISTRY CHECK (simulated) */
      {
        "id": "registry_check",
        "type": "selection",
        "title": "Проверка реестра доверенностей",
        "options": [
          { "value": "found", "label": "Запись найдена" },
          { "value": "not_found", "label": "Запись не найдена" }
        ],
        "next": "decision"
      },

      /* STEP 8 — DECISION */
      {
        "id": "decision",
        "type": "radio",
        "title": "Есть ли основания для отмены?",
        "options": [
          { "value": "yes", "label": "Да, основания есть" },
          { "value": "no", "label": "Нужны дополнительные документы" }
        ],
        "next": {
          "yes": "revoke_form",
          "no": "request_more_docs"
        }
      },

      /* STEP 9A — REQUEST MORE DOCS */
      {
        "id": "request_more_docs",
        "type": "form",
        "title": "Запрос дополнительных документов",
        "fields": [
          { "name": "extra_docs.note", "type": "textarea", "label": "Комментарий для заявителя" }
        ],
        "next": "validate"
      },

      /* STEP 9B — REVOKE FORM */
      {
        "id": "revoke_form",
        "type": "form",
        "title": "Оформление заявления об отмене",
        "fields": [
          { "name": "revoke.reason", "type": "textarea", "label": "Причина отмены доверенности" },
          { "name": "revoke.notify_agent", "type": "checkbox", "label": "Уведомить поверенного" },
          { "name": "revoke.agent_contact", "type": "text", "label": "Контакт поверенного (если уведомление выбрано)" }
        ],
        "next": "validate"
      },

      /* STEP 10 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required applicant.full_name",
          "required poa.reg_number",
          "if original_avail == 'none' → required no_docs.reason",
          "if revoke.notify_agent == true → required revoke.agent_contact"
        ],
        "next": "generate"
      },

      /* STEP 11 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "applicant.*",
      "poa.*",
      "attachments.*",
      "no_docs.reason",
      "registry_check",
      "revoke.reason",
      "revoke.notify_agent",
      "revoke.agent_contact"
    ]
  }
},
{
  "id": 21,
  "code": "DOC_021",
  "title": "Заявление о принятии / отказе от наследства",
  "category": "Наследство / Заявления / Нотариальные действия",

  "dev_notes": [
    "Обязательно выбрать действие: принять наследство или отказаться.",
    "Податель заявления может быть наследником, представителем, опекуном, исполнителем завещания или кредитором.",
    "Если податель не является наследником — обязательно загрузить документ полномочий.",
    "Обязателен ввод данных умершего: ФИО, дата смерти, место последнего жительства.",
    "Обязательно загрузить свидетельство о смерти.",
    "Если несовершеннолетний / недееспособный — обязательны документы опеки/попечительства.",
    "При отказе уточнить: полный отказ или частичный отказ.",
    "При принятии указать: полное принятие или с ограничением (например, после инвентаризации).",
    "Документы заявителя и подтверждающие документы должны загружаться через upload-блоки.",
    "Валидация — строгая: без обязательных файлов нельзя переходить к генерации.",
    "Нотариус должен иметь внутреннюю панель с чеклистом проверки и возможностью отметить 'ожидание документов' или 'рекомендовано уведомление наследников'.",
    "Итоговый документ — формируемая справка/акт принятия или отказа от наследства."
  ],

  "rules_for_cursor": [
    "Поле ACTION (принятие / отказ) — обязательно.",
    "Блок APPLICANT_TYPE — обязателен; при выборе 'представитель' или 'опекун' — автоматически включать upload документа полномочий.",
    "Если APPLICANT_TYPE ≠ наследник → показывать блок CHECK_AUTH с обязательной загрузкой подтверждающих документов.",
    "Данные умершего всегда обязательны: ФИО, дата смерти, место жительства.",
    "Upload свидетельства о смерти — обязательно.",
    "Если выбран несовершеннолетний или недееспособный участник — показывать GUARDIAN_BLOCK и делать документы опеки обязательными.",
    "При выборе ACCEPT (принять) — показывать подблок с выбором 'полностью' или 'с ограничением'.",
    "При выборе RENOUNCE (отказаться) — показывать подблок 'полный отказ / частичный' и поле описания.",
    "Список обязательных документов — чекбоксы + upload.",
    "Валидация должна блокировать формирование заявления, пока не загружены все требуемые документы.",
    "Cursor должен использовать плейсхолдеры: {{applicant}}, {{deceased}}, {{action}}, {{documents}}, {{notes}}, {{notary_checks}}, {{result}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — Action selection */
      {
        "id": "action",
        "type": "radio",
        "title": "Выберите действие",
        "options": [
          { "value": "accept", "label": "Принять наследство" },
          { "value": "renounce", "label": "Отказаться от наследства" }
        ],
        "required": true,
        "next": "applicant_type"
      },

      /* STEP 2 — Applicant type */
      {
        "id": "applicant_type",
        "type": "select",
        "title": "Кто подаёт заявление?",
        "options": [
          { "value": "heir_will", "label": "Наследник по завещанию" },
          { "value": "heir_law", "label": "Наследник по закону" },
          { "value": "executor", "label": "Исполнитель завещания" },
          { "value": "guardian", "label": "Законный представитель (опекун/попечитель)" },
          { "value": "representative", "label": "Представитель по доверенности" },
          { "value": "creditor", "label": "Кредитор / иное лицо" }
        ],
        "required": true,
        "next": "check_auth"
      },

      /* STEP 3 — Check authorisation if not heir */
      {
        "id": "check_auth",
        "type": "condition",
        "expression": "applicant_type != 'heir_will' && applicant_type != 'heir_law'",
        "next_if_true": "auth_upload",
        "next_if_false": "deceased_data"
      },

      /* STEP 4 — Upload authority documents */
      {
        "id": "auth_upload",
        "type": "form",
        "title": "Документы полномочий",
        "fields": [
          {
            "name": "auth.documents[]",
            "type": "file",
            "label": "Загрузите документы полномочий (доверенность, решение опеки, судебный акт)",
            "min": 1
          }
        ],
        "next": "deceased_data"
      },

      /* STEP 5 — Deceased data */
      {
        "id": "deceased_data",
        "type": "form",
        "title": "Данные умершего",
        "fields": [
          { "name": "deceased.full_name", "type": "text", "label": "ФИО" },
          { "name": "deceased.death_date", "type": "date", "label": "Дата смерти" },
          { "name": "deceased.last_residence", "type": "text", "label": "Место последнего жительства" },
          {
            "name": "deceased.death_certificate",
            "type": "file",
            "label": "Свидетельство о смерти",
            "min": 1,
            "max": 1
          },
          {
            "name": "deceased.will_file",
            "type": "file",
            "label": "Завещание (если имеется)",
            "optional": true
          }
        ],
        "required": true,
        "next": "docs_required"
      },

      /* STEP 6 — Required documents */
      {
        "id": "docs_required",
        "type": "checkbox-group",
        "title": "Обязательные документы",
        "options": [
          { "value": "passport", "label": "Паспорт заявителя" },
          { "value": "relationship", "label": "Документы подтверждающие право наследования" },
          { "value": "property_docs", "label": "Документы на имущество (если частичное принятие)" },
          { "value": "other", "label": "Иные документы (по требованию)" }
        ],
        "upload_map": {
          "passport": true,
          "relationship": false,
          "property_docs": false,
          "other": true
        },
        "next": "minors_check"
      },

      /* STEP 7 — Minor/disabled block */
      {
        "id": "minors_check",
        "type": "radio",
        "title": "Есть несовершеннолетние / недееспособные?",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "next": {
          "yes": "guardian_block",
          "no": "action_specific"
        }
      },

      {
        "id": "guardian_block",
        "type": "form",
        "title": "Документы представителя",
        "fields": [
          {
            "name": "guardian.documents[]",
            "type": "file",
            "label": "Загрузите документы опеки / решения суда",
            "min": 1
          }
        ],
        "next": "action_specific"
      },

      /* STEP 8 — Action-specific logic */
      {
        "id": "action_specific",
        "type": "dynamic",
        "title": "Особенности действия",
        "sections": {
          "accept": [
            {
              "type": "radio",
              "name": "accept.type",
              "title": "Тип принятия",
              "options": [
                { "value": "full", "label": "Полностью" },
                { "value": "limited", "label": "С ограничением (инвентаризация / условия)" }
              ]
            }
          ],
          "renounce": [
            {
              "type": "radio",
              "name": "renounce.type",
              "title": "Тип отказа",
              "options": [
                { "value": "full", "label": "Полный отказ" },
                { "value": "partial", "label": "Частичный отказ (указать объекты)" }
              ]
            },
            {
              "type": "textarea",
              "name": "renounce.details",
              "label": "Описание отказа"
            }
          ]
        },
        "next": "notary_checks"
      },

      /* STEP 9 — Notary checks */
      {
        "id": "notary_checks",
        "type": "checklist",
        "title": "Проверки нотариуса",
        "options": [
          "Проверка личности заявителя",
          "Проверка документов умершего",
          "Проверка прав заявителя",
          "Проверка реестров / баз",
          "Проверка наличия других наследников"
        ],
        "next": "final_validation"
      },

      /* STEP 10 — Validation */
      {
        "id": "final_validation",
        "type": "validation",
        "rules": [
          "required action",
          "required deceased.full_name",
          "required deceased.death_certificate",
          "required applicant_type",
          "if applicant_type != heir_will && applicant_type != heir_law → require auth.documents",
          "required docs_required (>=1)",
          "if minors_check == yes → require guardian.documents"
        ],
        "next": "generate"
      },

      /* STEP 11 — Generate */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "action",
      "applicant",
      "applicant_type",
      "deceased",
      "documents",
      "accept.type",
      "renounce.type",
      "renounce.details",
      "notary_checks"
    ]
  }
},
{
  "id": 22,
  "code": "DOC_022",
  "title": "Заявление на получение дубликата",
  "category": "Документы / Дубликаты / Утрата / Замена",

  "dev_notes": [
    "Документ универсальный: позволяет запрашивать дубликаты любых документов — паспорт, свидетельства, техпаспорт, диплом, право собственности и т.д.",
    "Выбор типа заявителя (владелец, представитель, иное лицо).",
    "У каждого заявителя — свои обязательные данные + upload документа-основания (доверенность, решение суда).",
    "Причина запроса — множественный выбор, но минимум один пункт.",
    "При утере/краже — обязательная справка из полиции.",
    "При повреждении — обязательное фото/скан повреждённого документа.",
    "Срочность: обычный / срочно (включает плату).",
    "Поля для оплаты: сумма госпошлины, квитанция, подтверждение.",
    "Плейсхолдеры: {{applicant}}, {{doc_type}}, {{doc_details}}, {{reason}}, {{supporting_docs}}, {{payment}}, {{poa_info}}."
  ],

  "rules_for_cursor": [
    "If applicant_type = owner → no poa required",
    "If applicant_type = representative → require poa.scan and poa.registry fields",
    "If reason includes 'loss' or 'theft' → supporting_docs.police_certificate required",
    "If reason includes 'damage' → supporting_docs.damaged_photo required",
    "Payment receipt required if payment.online != true",
    "doc_type required",
    "consents[] must include truthfulness + PD processing"
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — WHO APPLIES */
      {
        "id": "applicant_type",
        "type": "radio",
        "title": "Кто подаёт заявление?",
        "required": true,
        "options": [
          { "value": "owner", "label": "Сам владелец" },
          { "value": "representative", "label": "Представитель по доверенности" },
          { "value": "other", "label": "Иное лицо (на основании закона)" }
        ],
        "next": {
          "owner": "applicant_owner",
          "representative": "applicant_rep",
          "other": "applicant_other"
        }
      },

      /* OWNER */
      {
        "id": "applicant_owner",
        "type": "form",
        "title": "Заявитель — владелец",
        "fields": [
          { "name": "applicant.full_name", "label": "ФИО", "type": "text" },
          { "name": "applicant.iin", "label": "ИИН", "type": "text" },
          { "name": "applicant.birth_date", "label": "Дата рождения", "type": "date" },
          { "name": "applicant.address", "label": "Адрес регистрации", "type": "text" },
          { "name": "applicant.pass.type", "label": "Тип документа", "type": "text" },
          { "name": "applicant.pass.number", "label": "Серия/номер", "type": "text" },
          { "name": "applicant.pass.issued_by", "label": "Кем выдан", "type": "text" },
          { "name": "applicant.pass.issued_date", "label": "Дата выдачи", "type": "date" },
          { "name": "applicant.contact", "label": "Контакт", "type": "text" }
        ],
        "next": "doc_type"
      },

      /* REPRESENTATIVE */
      {
        "id": "applicant_rep",
        "type": "form",
        "title": "Заявитель — представитель по доверенности",
        "fields": [
          { "name": "applicant.full_name", "type": "text", "label": "ФИО представителя" },
          { "name": "applicant.iin", "type": "text", "label": "ИИН" },
          { "name": "applicant.pass", "type": "text", "label": "Документ личности" },
          { "name": "applicant.contact", "type": "text", "label": "Контакт" },
          { "name": "poa.scan", "type": "file", "label": "Доверенность (scan/upload)", "min": 1 }
        ],
        "next": "doc_type"
      },

      /* OTHER */
      {
        "id": "applicant_other",
        "type": "form",
        "title": "Иное лицо (на основании закона)",
        "fields": [
          { "name": "applicant.full_name", "type": "text", "label": "ФИО" },
          { "name": "applicant.iin", "type": "text", "label": "ИИН" },
          { "name": "applicant.basis", "type": "text", "label": "Основание (решение суда/опека)" },
          { "name": "basis.scan", "type": "file", "label": "Загрузить документ-основание", "min": 1 }
        ],
        "next": "doc_type"
      },

      /* STEP 2 — DOCUMENT TYPE */
      {
        "id": "doc_type",
        "type": "select",
        "title": "Тип запрашиваемого дубликата",
        "required": true,
        "options_source": "duplicate_doc_types",
        "allow_other": true,
        "name": "doc.type",
        "next": "doc_details"
      },

      /* STEP 3 — ORIGINAL DOCUMENT DETAILS */
      {
        "id": "doc_details",
        "type": "form",
        "title": "Реквизиты исходного документа (если известны)",
        "fields": [
          { "name": "doc.series_number", "label": "Серия / номер", "type": "text" },
          { "name": "doc.issue_date", "label": "Дата выдачи", "type": "date" },
          { "name": "doc.issued_by", "label": "Кем/где выдан", "type": "text" },
          { "name": "doc.note", "label": "Пометка: утерян/повреждён/иное", "type": "text" }
        ],
        "next": "reason"
      },

      /* STEP 4 — REASON */
      {
        "id": "reason",
        "type": "checkbox-group",
        "title": "Причина запроса дубликата",
        "required": true,
        "options": [
          { "value": "loss", "label": "Утеря / кража" },
          { "value": "damage", "label": "Повреждение" },
          { "value": "spoiled", "label": "Испорчен / негоден" },
          { "value": "data_change", "label": "Изменение данных (ФИО и др.)" },
          { "value": "expired", "label": "Истёк срок действия" },
          { "value": "other", "label": "Иное" }
        ],
        "next": "supporting_docs"
      },

      /* STEP 5 — SUPPORTING DOCS */
      {
        "id": "supporting_docs",
        "type": "checkbox-upload",
        "title": "Подтверждающие документы",
        "options": [
          { "value": "police_certificate", "label": "Справка из полиции (при утере/краже)" },
          { "value": "damaged_photo", "label": "Фото/скан повреждённого документа" },
          { "value": "name_change_docs", "label": "Документы об изменении ФИО" },
          { "value": "poa", "label": "Доверенность (при представителе)" },
          { "value": "court_docs", "label": "Судебные решения / опека" },
          { "value": "other_docs", "label": "Иные документы" }
        ],
        "next": "expedite"
      },

      /* STEP 6 — EXPEDITE */
      {
        "id": "expedite",
        "type": "radio",
        "title": "Режим обработки",
        "options": [
          { "value": "regular", "label": "Обычный" },
          { "value": "urgent", "label": "Срочно (платно)" }
        ],
        "required": true,
        "next": "payment"
      },

      /* STEP 7 — PAYMENT */
      {
        "id": "payment",
        "type": "form",
        "title": "Оплата госпошлины/сбора",
        "fields": [
          { "name": "payment.amount", "type": "number", "label": "Сумма госпошлины" },
          { "name": "payment.method", "type": "radio", "label": "Способ оплаты", "options": [
            { "value": "online", "label": "Онлайн" },
            { "value": "terminal", "label": "Терминал / касса" }
          ]},
          { "name": "payment.receipt", "type": "file", "label": "Квитанция (если оплата не онлайн)" }
        ],
        "next": "consents"
      },

      /* STEP 8 — CONSENTS */
      {
        "id": "consents",
        "type": "checkbox-group",
        "title": "Согласия",
        "required": true,
        "options": [
          { "value": "truth", "label": "Подтверждаю правдивость данных" },
          { "value": "pd", "label": "Согласие на обработку персональных данных" },
          { "value": "registry", "label": "Согласие на поиск по реестрам" },
          { "value": "notifications", "label": "Согласие на уведомления" }
        ],
        "next": "appear_type"
      },

      /* STEP 9 — APPEAR TYPE */
      {
        "id": "appear_type",
        "type": "radio",
        "title": "Как подаётся заявление?",
        "required": true,
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "next": {
          "personal": "validate",
          "poa": "poa_fields"
        }
      },

      /* POA FIELDS IF NEEDED */
      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.registry", "label": "Реестровый номер", "type": "text" },
          { "name": "poa.issued_by", "label": "Кем выдана", "type": "text" },
          { "name": "poa.date", "label": "Дата выдачи", "type": "date" },
          { "name": "poa.license", "label": "Номер лицензии нотариуса", "type": "text" },
          { "name": "poa.scan", "label": "Upload доверенности", "type": "file", "min": 1 }
        ],
        "next": "validate"
      },

      /* STEP 10 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required applicant",
          "required doc.type",
          "required reason",
          "if reason contains loss/theft → police_certificate required",
          "if reason contains damage → damaged_photo required",
          "if appear_type == 'poa' → poa.registry & poa.scan required",
          "payment.amount required",
          "consents must include truth and pd"
        ],
        "next": "submit"
      },

      /* STEP 11 — SUBMIT */
      {
        "id": "submit",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "applicant",
      "doc_type",
      "doc_details",
      "reason",
      "supporting_docs",
      "payment",
      "poa_info"
    ]
  }
},
{
  "id": 23,
  "code": "DOC_023",
  "title": "Заявление об отсутствии брачных отношений",
  "category": "Недвижимость / Сделки / Семейное положение",

  "dev_notes": [
    "Документ подтверждает, что заявитель не состоял(а) в браке в момент приобретения объекта и не состоит (или не состоял) в момент продажи.",
    "Может применяться для одной или нескольких сделок.",
    "Поддерживается множественный выбор объектов недвижимости.",
    "При наличии брака — требуется либо справка семейного положения, либо документ, подтверждающий развод/смерть супруга, либо согласие супруга.",
    "Плейсхолдеры: {{applicant}}, {{properties}}, {{acquisition_info}}, {{marital_status}}, {{documents}}, {{notary_verification}}."
  ],

  "rules_for_cursor": [
    "properties[] must include address and cadastre",
    "acquisition_date required",
    "sale_date required OR 'current'",
    "If marital status = 'acq_married' OR 'sale_married' → require supporting_docs.spouse_doc",
    "If request marital check = true → require upload of ZAGS certificate",
    "Applicant passport scan required",
    "Validation must block generation until notary verifies marital status"
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — APPLICANT */
      {
        "id": "applicant",
        "type": "form",
        "title": "Данные заявителя",
        "required": true,
        "fields": [
          { "name": "applicant.full_name", "label": "ФИО", "type": "text" },
          { "name": "applicant.iin", "label": "ИИН", "type": "text" },
          { "name": "applicant.birth_date", "label": "Дата рождения", "type": "date" },
          { "name": "applicant.pass.type", "label": "Документ личности — тип", "type": "text" },
          { "name": "applicant.pass.number", "label": "Серия / номер", "type": "text" },
          { "name": "applicant.pass.issued_by", "label": "Кем выдан", "type": "text" },
          { "name": "applicant.pass.issued_date", "label": "Дата выдачи", "type": "date" },
          { "name": "applicant.address", "label": "Адрес регистрации", "type": "text" },
          { "name": "applicant.contact", "label": "Контактный номер / e-mail", "type": "text" },
          { "name": "applicant.pass.scan", "label": "Паспорт (scan/upload)", "type": "file", "min": 1 }
        ],
        "next": "property_select"
      },

      /* STEP 2 — PROPERTY SELECT */
      {
        "id": "property_select",
        "type": "multi-object",
        "title": "Объекты недвижимости",
        "description": "Можно добавить несколько объектов. Для каждого требуется адрес, кадастр и правоустанавливающие реквизиты.",
        "item_fields": [
          { "name": "property.type", "label": "Тип недвижимости", "type": "select",
            "options": ["Квартира", "Жилой дом/дача", "Земельный участок", "Нежилое помещение", "Паркинг", "Доля в праве", "Доля в ТОО"] },
          { "name": "property.address", "label": "Адрес", "type": "text" },
          { "name": "property.cadastre", "label": "Кадастровый номер", "type": "text" },
          { "name": "property.docs", "label": "Правоустанавливающий документ", "type": "text" }
        ],
        "min": 1,
        "name": "properties",
        "next": "acquisition_info"
      },

      /* STEP 3 — ACQUISITION & SALE INFO */
      {
        "id": "acquisition_info",
        "type": "form",
        "title": "Сведения о приобретении и продаже",
        "fields": [
          { "name": "acq.date", "label": "Дата приобретения", "type": "date", "required": true },
          { "name": "acq.doc", "label": "Документ приобретения (договор/акт)", "type": "text", "required": true },

          { "name": "sale.date", "label": "Дата продажи (или 'настоящее')", "type": "text", "required": true }
        ],
        "next": "marital_status_check"
      },

      /* STEP 4 — MARITAL STATUS */
      {
        "id": "marital_status_check",
        "type": "radio",
        "title": "Брачный статус на момент сделки",
        "options": [
          {
            "value": "status_ok",
            "label": "Не состоял в браке при приобретении и не состоит сейчас"
          },
          {
            "value": "acq_married",
            "label": "Состоял(а) в браке при приобретении"
          },
          {
            "value": "sale_married",
            "label": "Состоит в браке сейчас (момент продажи)"
          },
          {
            "value": "need_check",
            "label": "Нужен поиск по реестру ЗАГС"
          }
        ],
        "required": true,
        "next": {
          "status_ok": "docs_upload",
          "acq_married": "docs_upload",
          "sale_married": "docs_upload",
          "need_check": "docs_upload"
        }
      },

      /* STEP 5 — DOCUMENTS UPLOAD */
      {
        "id": "docs_upload",
        "type": "checkbox-upload",
        "title": "Загрузить подтверждающие документы",
        "options": [
          { "value": "passport", "label": "Паспорт заявителя (scan)" },
          { "value": "acq_doc", "label": "Документ на приобретение" },
          { "value": "sale_doc", "label": "Документ о продаже (если есть)" },
          { "value": "zags", "label": "Выписка ЗАГС / справка о семейном положении" },
          { "value": "divorce", "label": "Свидетельство о разводе (если ранее состоял(а) в браке)" },
          { "value": "spouse_death", "label": "Свидетельство о смерти супруга (если применимо)" },
          { "value": "spouse_consent", "label": "Согласие супруга (нотариальное)" },
          { "value": "property_docs", "label": "Доп. документы об объекте (кадастр и др.)" },
          { "value": "other_docs", "label": "Иные документы" }
        ],
        "min": 1,
        "name": "supporting_docs",
        "next": "notary_verification"
      },

      /* STEP 6 — NOTARY VERIFICATION (LOGIC BLOCK) */
      {
        "id": "notary_verification",
        "type": "info",
        "title": "Проверка нотариусом",
        "text": "На этом этапе нотариус проверяет личность заявителя, данные о брачном статусе, даты сделок, наличие подтверждающих документов. Если заявитель состоял в браке или состоит сейчас — требуется дополнительное подтверждение.",
        "next": "verif_decision"
      },

      /* STEP 7 — NOTARY DECISION */
      {
        "id": "verif_decision",
        "type": "radio",
        "title": "Решение после проверки",
        "options": [
          { "value": "ok", "label": "Все документы в порядке — можно оформлять заявление" },
          { "value": "need_docs", "label": "Не хватает документов — запросить дополнительно" },
          { "value": "require_spouse", "label": "Необходимо согласие супруга — отказ в оформлении" }
        ],
        "required": true,
        "next": {
          "ok": "generate",
          "need_docs": "wait_docs",
          "require_spouse": "end_reject"
        }
      },

      {
        "id": "wait_docs",
        "type": "info",
        "title": "Ожидание дополнительных документов",
        "text": "Заявителю необходимо загрузить недостающие документы.",
        "next": "notary_verification"
      },

      /* STEP 8 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      },

      {
        "id": "end_reject",
        "type": "final",
        "output": "reject"
      }
    ],

    "placeholders": [
      "applicant",
      "properties",
      "acquisition_info",
      "marital_status",
      "documents",
      "notary_verification"
    ]
  }
},
{
  "id": 24,
  "code": "DOC_024",
  "title": "Доверенность — сделки с недвижимостью (купля-продажа, обмен, оформление прав)",
  "category": "Доверенности / Недвижимость / Нотариальные документы",

  "dev_notes": [
    "Документ охватывает любые доверенности для сделок с недвижимостью: купля-продажа, обмен, передача прав, регистрация в ЦОН/кадастре.",
    "Доверитель может быть только физическим лицом.",
    "Поверенный — 1 или 2 человека. Если выбрано 2 — генерировать два полностью идентичных блока.",
    "Если объект недвижимости — несколько, генерация N карточек объектов.",
    "Обязательные документы: паспорт доверителя и поверенного(ых) — по 2 скана.",
    "Опционально — согласие супруга доверителя (если имущество совместное).",
    "Вариант цены: фиксированная, диапазон, по усмотрению поверенного, по оценке — влияет на открытие/валидацию полей.",
    "Если выбрана сделка 'продажа' — обязательна цена. Если 'покупка' — цена необязательна.",
    "Передоверие — строго обязательный выбор: да/нет.",
    "Срок доверенности: дни/месяцы/дата — обязательный."
  ],

  "rules_for_cursor": [
    "При выборе 2 поверенных — создавать 2 независимых блока данных (ФИО, ИИН, документ, контакты, upload).",
    "Для каждого объекта недвижимости — карточка с типом, адресом, кадастром и правоустанавливающими документами.",
    "Если выбран вариант цены = фиксированная или диапазон → сумма обязательна.",
    "Если выбрано 'по усмотрению' — обязательны лимиты или критерии.",
    "Если доверитель состоит в браке и выбрана функция 'продажа' объекта, приобретённого в браке → требуется загрузить согласие супруга.",
    "Всегда проверять обязательность загрузки паспортов (2 файла).",
    "Срок доверенности нельзя оставлять пустым — должна быть завязка на days/months/date.",
    "Вывод на печать — формировать docx/pdf с плейсхолдерами {{principal}}, {{agent}}, {{objects}}, {{scope}}, {{price}}, {{limits}}, {{term}}, {{delegation}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — PRINCIPAL */
      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО" },
          { "name": "principal.iin", "type": "text", "label": "ИИН" },
          { "name": "principal.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "principal.address", "type": "text", "label": "Адрес проживания" },
          { "name": "principal.document.type", "type": "text", "label": "Тип документа" },
          { "name": "principal.document.number", "type": "text", "label": "Серия / номер документа" },
          { "name": "principal.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.document.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "principal.attachments[]",
            "type": "file",
            "label": "Сканы паспорта доверителя (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "required": true,
        "next": "agents_count"
      },

      /* STEP 2 — AGENTS COUNT */
      {
        "id": "agents_count",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": "1", "label": "Один поверенный" },
          { "value": "2", "label": "Два поверенных" }
        ],
        "required": true,
        "next": {
          "1": "agent1",
          "2": "agent1"
        }
      },

      /* STEP 3A — AGENT 1 */
      {
        "id": "agent1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agent1.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent1.iin", "type": "text", "label": "ИИН" },
          { "name": "agent1.address", "type": "text", "label": "Адрес" },
          { "name": "agent1.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "agent1.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "agent1.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent1.document.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "agent1.attachments[]",
            "type": "file",
            "label": "Сканы паспорта поверенного (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "check_second_agent"
      },

      /* STEP 3B — conditional AGENT 2 */
      {
        "id": "check_second_agent",
        "type": "condition",
        "expression": "agents_count == '2'",
        "next_if_true": "agent2",
        "next_if_false": "scope"
      },

      {
        "id": "agent2",
        "type": "form",
        "title": "Поверенный 2",
        "fields": [
          { "name": "agent2.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent2.iin", "type": "text", "label": "ИИН" },
          { "name": "agent2.address", "type": "text", "label": "Адрес" },
          { "name": "agent2.document.type", "type": "text", "label": "Документ: тип" },
          { "name": "agent2.document.number", "type": "text", "label": "Серия / номер" },
          { "name": "agent2.document.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent2.document.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "agent2.attachments[]",
            "type": "file",
            "label": "Сканы паспорта поверенного (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "scope"
      },

      /* STEP 4 — SCOPE OF POWERS */
      {
        "id": "scope",
        "type": "checkbox-group",
        "title": "Полномочия поверенного",
        "has_select_all": true,
        "options": [
          { "value": "buy", "label": "Приобретение недвижимости" },
          { "value": "sell", "label": "Продажа недвижимости" },
          { "value": "exchange", "label": "Обмен / мена" },
          { "value": "register", "label": "Регистрация прав в ЦОН/кадастре" },
          { "value": "sign_docs", "label": "Подписание договоров, актов, заявлений" },
          { "value": "receive_money", "label": "Получение денежных средств" }
        ],
        "min": 1,
        "next": "objects"
      },

      /* STEP 5 — OBJECTS */
      {
        "id": "objects",
        "type": "list",
        "title": "Объекты недвижимости",
        "item_title": "Объект",
        "fields": [
          { "name": "object.type", "type": "text", "label": "Тип объекта (квартира/дом/участок/доля)" },
          { "name": "object.address", "type": "text", "label": "Адрес" },
          { "name": "object.cadastral", "type": "text", "label": "Кадастровый номер" },
          { "name": "object.docs.series", "type": "text", "label": "Правоустанавливающие: серия" },
          { "name": "object.docs.number", "type": "text", "label": "Номер" },
          { "name": "object.docs.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "object.docs.issued_date", "type": "date", "label": "Дата выдачи" }
        ],
        "min_items": 1,
        "next": "price_required"
      },

      /* STEP 6 — conditional price */
      {
        "id": "price_required",
        "type": "condition",
        "expression": "scope includes 'sell'",
        "next_if_true": "price_block",
        "next_if_false": "delegation"
      },

      {
        "id": "price_block",
        "type": "radio",
        "title": "Цена продажи",
        "options": [
          { "value": "fixed", "label": "Фиксированная сумма" },
          { "value": "range", "label": "Диапазон" },
          { "value": "discretion", "label": "По усмотрению поверенного" },
          { "value": "market", "label": "По оценке / рыночной стоимости" }
        ],
        "next": {
          "fixed": "price_fixed",
          "range": "price_range",
          "discretion": "price_discretion",
          "market": "delegation"
        }
      },

      {
        "id": "price_fixed",
        "type": "form",
        "fields": [
          { "name": "price.amount", "type": "number", "label": "Сумма (KZT)" }
        ],
        "next": "delegation"
      },

      {
        "id": "price_range",
        "type": "form",
        "fields": [
          { "name": "price.min", "type": "number", "label": "Минимум" },
          { "name": "price.max", "type": "number", "label": "Максимум" }
        ],
        "next": "delegation"
      },

      {
        "id": "price_discretion",
        "type": "form",
        "fields": [
          { "name": "price.limit_min", "type": "number", "label": "Минимальный лимит" },
          { "name": "price.limit_max", "type": "number", "label": "Максимальный лимит" },
          { "name": "price.criteria", "type": "text", "label": "Критерии принятия решений" }
        ],
        "next": "delegation"
      },

      /* STEP 7 — DELEGATION */
      {
        "id": "delegation",
        "type": "radio",
        "title": "Право передоверия",
        "options": [
          { "value": "yes", "label": "Да, разрешено" },
          { "value": "no", "label": "Нет, запрещено" }
        ],
        "required": true,
        "next": "term"
      },

      /* STEP 8 — TERM */
      {
        "id": "term",
        "type": "radio",
        "title": "Срок доверенности",
        "options": [
          { "value": "days", "label": "Количество дней (1–31)" },
          { "value": "months", "label": "Количество месяцев (1–36)" },
          { "value": "date", "label": "До даты" }
        ],
        "next": {
          "days": "term_days",
          "months": "term_months",
          "date": "term_date"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "min": 1, "max": 31, "label": "Дней" }
        ],
        "next": "validate"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "min": 1, "max": 36, "label": "Месяцев" }
        ],
        "next": "validate"
      },

      {
        "id": "term_date",
        "type": "form",
        "fields": [
          { "name": "term.until", "type": "date", "label": "Дата окончания" }
        ],
        "next": "validate"
      },

      /* STEP 9 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required agents_count",
          "required agent1.full_name",
          "if agents_count == '2' → required agent2.full_name",
          "required objects (>=1)",
          "if scope includes 'sell' → required price_block",
          "required term",
          "required principal.attachments",
          "required agent1.attachments",
          "if agents_count == '2' → required agent2.attachments"
        ],
        "next": "generate"
      },

      /* STEP 10 — FINAL */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal",
      "agent",
      "objects",
      "scope",
      "price",
      "term",
      "delegation"
    ]
  }
},
{
  "id": 25,
  "code": "DOC_025",
  "title": "Договор купли-продажи недвижимости",
  "category": "Сделки / Недвижимость / Купля-продажа",

  "dev_notes": [
    "Договор купли-продажи поддерживает любые виды объектов: квартира, дом, участок, нежилое помещение, доля.",
    "У каждой стороны (продавец/покупатель) могут быть супруги — обязательные логики согласия.",
    "Если продавец или покупатель в браке → обязательный блок супруг(и).",
    "Если основание права продавца — договор/решение/наследство → обязательны реквизиты и upload.",
    "Цена сделки обязательна: цифрами и словами.",
    "Условия оплаты: немедленная, задаток, эскроу, ипотека — обязательно выбрать хотя бы один вариант.",
    "Если стороны действуют по доверенности — обязательные реквизиты доверенности + upload.",
    "Обременения блокируют сделку или требуют загрузки подтверждений снятия.",
    "Генерация: договор, акт приёма-передачи, приложения.",
    "Placeholders должны совпадать с docx-шаблоном."
  ],

  "rules_for_cursor": [
    "Если продавец в браке → автоматически открыть блок супруга.",
    "Если продавец указал, что не состоит в браке → разрешить upload справки о семейном положении.",
    "Если выбран тип основания = договор → require: дата, нотариус, лицензия, номер реестра, upload.",
    "Цена сделки обязательна всегда и в двух форматах: цифрами и прописью.",
    "Согласия супругов обязательны, если основание приобретения подпадает под совместную собственность.",
    "Если обременения есть → запретить генерацию без указания условия снятия или файла подтверждения.",
    "Акт приёма-передачи генерируется автоматически для всех типов объектов.",
    "Для всех upload полей — требовать минимум 1 файл.",
    "Валидация перед генерацией — жёсткая, как в нотариальной практике.",
    "Шаги Wizard должны строго следовать указанной логике ветвлений."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — META */
      {
        "id": "meta",
        "type": "form",
        "title": "Метаданные сделки",
        "fields": [
          { "name": "txn.id", "type": "text", "label": "ID сделки (генерируется автоматически)" },
          { "name": "txn.location", "type": "text", "label": "Место составления (город)" }
        ],
        "next": "property_type"
      },

      /* STEP 2 — PROPERTY TYPE */
      {
        "id": "property_type",
        "type": "radio",
        "title": "Тип объекта недвижимости",
        "options": [
          { "value": "apartment", "label": "Квартира" },
          { "value": "house", "label": "Жилой дом / дача" },
          { "value": "land", "label": "Земельный участок" },
          { "value": "commercial", "label": "Нежилое помещение" },
          { "value": "garage", "label": "Гараж / паркинг" },
          { "value": "share", "label": "Доля в праве" }
        ],
        "required": true,
        "next": "property_details"
      },

      /* STEP 3 — PROPERTY DETAILS */
      {
        "id": "property_details",
        "type": "form",
        "title": "Данные объекта",
        "fields": [
          { "name": "property.address", "type": "text", "label": "Адрес объекта" },
          { "name": "property.cadastral", "type": "text", "label": "Кадастровый номер" },
          { "name": "property.area", "type": "text", "label": "Площадь (кв.м)" },
          { "name": "property.docs.series", "type": "text", "label": "Правоустан. документ: серия" },
          { "name": "property.docs.number", "type": "text", "label": "Номер" },
          { "name": "property.docs.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "property.docs.issued_date", "type": "date", "label": "Дата выдачи" }
        ],
        "required": true,
        "next": "parties"
      },

      /* STEP 4 — PARTIES */
      {
        "id": "parties",
        "type": "section",
        "title": "Стороны договора",
        "children": [
          {
            "id": "seller",
            "type": "form",
            "title": "Продавец",
            "fields": [
              { "name": "seller.full_name", "type": "text", "label": "ФИО" },
              { "name": "seller.iin", "type": "text", "label": "ИИН" },
              { "name": "seller.address", "type": "text", "label": "Адрес" },
              { "name": "seller.passport.number", "type": "text", "label": "Паспорт: номер" },
              { "name": "seller.passport.issued_by", "type": "text", "label": "Кем выдан" },
              { "name": "seller.passport.issued_date", "type": "date", "label": "Дата выдачи" },
              { "name": "seller.attachments[]", "type": "file", "label": "Скан паспорта продавца", "min": 1 }
            ]
          },
          {
            "id": "buyer",
            "type": "form",
            "title": "Покупатель",
            "fields": [
              { "name": "buyer.full_name", "type": "text", "label": "ФИО" },
              { "name": "buyer.iin", "type": "text", "label": "ИИН" },
              { "name": "buyer.address", "type": "text", "label": "Адрес" },
              { "name": "buyer.passport.number", "type": "text", "label": "Паспорт: номер" },
              { "name": "buyer.passport.issued_by", "type": "text", "label": "Кем выдан" },
              { "name": "buyer.passport.issued_date", "type": "date", "label": "Дата выдачи" },
              { "name": "buyer.attachments[]", "type": "file", "label": "Скан паспорта покупателя", "min": 1 }
            ]
          }
        ],
        "next": "seller_marital"
      },

      /* STEP 5 — marital statuses */
      {
        "id": "seller_marital",
        "type": "radio",
        "title": "Статус продавца относительно брака",
        "options": [
          { "value": "married", "label": "В браке сейчас" },
          { "value": "not_married", "label": "Не состоит / не состоял" },
          { "value": "consent_available", "label": "Согласие супруга уже имеется" }
        ],
        "required": true,
        "next": {
          "married": "seller_spouse",
          "not_married": "buyer_marital",
          "consent_available": "seller_consent_upload"
        }
      },

      {
        "id": "seller_spouse",
        "type": "form",
        "title": "Супруг(а) продавца",
        "fields": [
          { "name": "seller_spouse.full_name", "type": "text", "label": "ФИО" },
          { "name": "seller_spouse.iin", "type": "text", "label": "ИИН" },
          { "name": "seller_spouse.passport.number", "type": "text", "label": "Номер паспорта" },
          { "name": "seller_spouse.consent_file", "type": "file", "label": "Согласие супруга (upload)", "min": 1 }
        ],
        "next": "buyer_marital"
      },

      {
        "id": "seller_consent_upload",
        "type": "form",
        "title": "Согласие супруга продавца",
        "fields": [
          { "name": "seller_spouse.consent_file", "type": "file", "label": "Файл согласия", "min": 1 }
        ],
        "next": "buyer_marital"
      },

      {
        "id": "buyer_marital",
        "type": "radio",
        "title": "Статус покупателя относительно брака",
        "options": [
          { "value": "married", "label": "В браке" },
          { "value": "not_married", "label": "Не состоит" },
          { "value": "consent_available", "label": "Согласие супруга имеется" }
        ],
        "required": true,
        "next": {
          "married": "buyer_spouse",
          "not_married": "ownership",
          "consent_available": "buyer_consent_upload"
        }
      },

      {
        "id": "buyer_spouse",
        "type": "form",
        "title": "Супруг(а) покупателя",
        "fields": [
          { "name": "buyer_spouse.full_name", "type": "text", "label": "ФИО" },
          { "name": "buyer_spouse.iin", "type": "text", "label": "ИИН" },
          { "name": "buyer_spouse.passport.number", "type": "text", "label": "Номер паспорта" }
        ],
        "next": "ownership"
      },

      {
        "id": "buyer_consent_upload",
        "type": "form",
        "title": "Согласие супруга покупателя",
        "fields": [
          { "name": "buyer_spouse.consent_file", "type": "file", "label": "Файл согласия", "min": 1 }
        ],
        "next": "ownership"
      },

      /* STEP 6 — ownership */
      {
        "id": "ownership",
        "type": "radio",
        "title": "Основание права собственности продавца",
        "options": [
          { "value": "sale_contract", "label": "Договор купли-продажи" },
          { "value": "gift_contract", "label": "Договор дарения" },
          { "value": "inheritance", "label": "Наследство" },
          { "value": "akim_decision", "label": "Решение акима / органа" },
          { "value": "other", "label": "Иное" }
        ],
        "required": true,
        "next": {
          "sale_contract": "ownership_contract",
          "gift_contract": "ownership_contract",
          "inheritance": "ownership_inheritance",
          "akim_decision": "ownership_akim",
          "other": "ownership_other"
        }
      },

      {
        "id": "ownership_contract",
        "type": "form",
        "fields": [
          { "name": "ownership.contract.type", "type": "text", "label": "Тип договора" },
          { "name": "ownership.contract.date", "type": "date", "label": "Дата договора" },
          { "name": "ownership.contract.notary_name", "type": "text", "label": "ФИО нотариуса" },
          { "name": "ownership.contract.notary_license", "type": "text", "label": "Номер лицензии нотариуса" },
          { "name": "ownership.contract.registry_number", "type": "text", "label": "Реестровый номер" },
          { "name": "ownership.contract.upload", "type": "file", "min": 1, "label": "Загрузить копию договора" }
        ],
        "next": "price"
      },

      {
        "id": "ownership_akim",
        "type": "form",
        "fields": [
          { "name": "ownership.akim.number", "type": "text", "label": "Номер решения" },
          { "name": "ownership.akim.date", "type": "date", "label": "Дата решения" },
          { "name": "ownership.akim.organ", "type": "text", "label": "Орган" },
          { "name": "ownership.akim.upload", "type": "file", "min": 1, "label": "Загрузить документ" }
        ],
        "next": "price"
      },

      {
        "id": "ownership_inheritance",
        "type": "form",
        "fields": [
          { "name": "ownership.inheritance.number", "type": "text", "label": "Номер акта" },
          { "name": "ownership.inheritance.date", "type": "date", "label": "Дата" },
          { "name": "ownership.inheritance.upload", "type": "file", "min": 1, "label": "Загрузить файл" }
        ],
        "next": "price"
      },

      {
        "id": "ownership_other",
        "type": "form",
        "fields": [
          { "name": "ownership.other.description", "type": "text", "label": "Описание документа" },
          { "name": "ownership.other.upload", "type": "file", "min": 1, "label": "Загрузить файл" }
        ],
        "next": "price"
      },

      /* STEP 7 — PRICE */
      {
        "id": "price",
        "type": "form",
        "title": "Цена сделки",
        "fields": [
          { "name": "price.amount", "type": "number", "label": "Сумма (цифрами)" },
          { "name": "price.amount_words", "type": "text", "label": "Сумма (прописью)" }
        ],
        "required": true,
        "next": "expenses"
      },

      /* STEP 8 — EXPENSES PAYER */
      {
        "id": "expenses",
        "type": "radio",
        "title": "Кто оплачивает расходы по сделке?",
        "options": [
          { "value": "seller", "label": "Продавец" },
          { "value": "buyer", "label": "Покупатель" },
          { "value": "shared", "label": "50/50" }
        ],
        "required": true,
        "next": "documents"
      },

      /* STEP 9 — DOCUMENTS */
      {
        "id": "documents",
        "type": "checkbox-group",
        "title": "Обязательные документы",
        "options": [
          { "value": "id_docs", "label": "Паспортные данные сторон" },
          { "value": "ownership_docs", "label": "Правоустанавливающий документ" },
          { "value": "registry_extract", "label": "Выписка из реестра прав" },
          { "value": "spouse_consents", "label": "Согласия супругов (если необходимо)" },
          { "value": "payments", "label": "Документы об оплате / задатке / эскроу" }
        ],
        "min": 1,
        "next": "payment"
      },

      /* STEP 10 — PAYMENT TERMS */
      {
        "id": "payment",
        "type": "section",
        "title": "Условия оплаты",
        "children": [
          {
            "id": "payment_form",
            "type": "checkbox-group",
            "options": [
              { "value": "direct", "label": "Немедленная оплата" },
              { "value": "deposit", "label": "Задаток / аванс" },
              { "value": "escrow", "label": "Эскроу" },
              { "value": "mortgage", "label": "Ипотека / рассрочка" }
            ],
            "min": 1
          }
        ],
        "next": "representation"
      },

      /* STEP 11 — REPRESENTATION (POA) */
      {
        "id": "representation",
        "type": "section",
        "title": "Кто пришёл на сделку?",
        "children": [
          {
            "id": "seller_rep",
            "type": "radio",
            "title": "Продавец",
            "options": [
              { "value": "personal", "label": "Лично" },
              { "value": "poa", "label": "По доверенности" }
            ],
            "next": {
              "poa": "seller_poa",
              "personal": "buyer_rep"
            }
          },

          {
            "id": "seller_poa",
            "type": "form",
            "fields": [
              { "name": "seller_poa.registry", "type": "text", "label": "Реестровый № доверенности" },
              { "name": "seller_poa.notary", "type": "text", "label": "Нотариус" },
              { "name": "seller_poa.date", "type": "date", "label": "Дата выдачи" },
              { "name": "seller_poa.license", "type": "text", "label": "Номер лицензии" },
              { "name": "seller_poa.upload", "type": "file", "min": 1, "label": "Скан доверенности" }
            ],
            "next": "buyer_rep"
          },

          {
            "id": "buyer_rep",
            "type": "radio",
            "title": "Покупатель",
            "options": [
              { "value": "personal", "label": "Лично" },
              { "value": "poa", "label": "По доверенности" }
            ],
            "next": {
              "poa": "buyer_poa",
              "personal": "validate"
            }
          },

          {
            "id": "buyer_poa",
            "type": "form",
            "fields": [
              { "name": "buyer_poa.registry", "type": "text", "label": "Реестровый №" },
              { "name": "buyer_poa.notary", "type": "text", "label": "Нотариус" },
              { "name": "buyer_poa.date", "type": "date", "label": "Дата выдачи" },
              { "name": "buyer_poa.license", "type": "text", "label": "Лицензия нотариуса" },
              { "name": "buyer_poa.upload", "type": "file", "min": 1, "label": "Файл доверенности" }
            ],
            "next": "validate"
          }
        ]
      },

      /* STEP 12 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required property_type",
          "required property_details",
          "required seller.full_name",
          "required buyer.full_name",
          "required price.amount",
          "required documents",
          "if seller_rep == 'poa' → require seller_poa.upload",
          "if buyer_rep == 'poa' → require buyer_poa.upload",
          "if seller_marital == 'married' → require seller_spouse.consent_file",
          "if buyer_marital == 'married' → require buyer_spouse (ФИО/ИИН)"
        ],
        "next": "generate"
      },

      /* STEP 13 — GENERATION */
      {
        "id": "generate",
        "type": "final",
        "output": "docx+pdf"
      }
    ],

    "placeholders": [
      "txn",
      "property",
      "seller",
      "buyer",
      "seller_spouse",
      "buyer_spouse",
      "ownership",
      "price",
      "documents",
      "payment",
      "representation"
    ]
  }
},
{
  "id": 26,
  "code": "DOC_026",
  "title": "Договор Мены Недвижимости",
  "category": "Сделки / Недвижимость / Мена",

  "dev_notes": [
    "Сделка мены всегда включает два объекта: Объект A (Сторона 1) и Объект B (Сторона 2).",
    "У каждой стороны обязательны паспортные данные, ИИН, контакты.",
    "Для каждого объекта обязательны адрес, кадастр, тип, правоустанавливающие документы.",
    "Брачный статус обеих сторон — обязательный с логикой согласий супругов.",
    "Если основание права = договор/решение/наследство → обязательные реквизиты + upload.",
    "Стоимость обоих объектов обязательна. Если стоимости отличаются — появляется блок 'Доплата'.",
    "Расходы сделки — обязательный выбор: сторона 1 / сторона 2 / 50/50.",
    "Если хоть одна сторона действует по доверенности — обязательные реквизиты доверенности + upload.",
    "Документы: выписки из реестра на оба объекта обязательны.",
    "Генерация: договор мены, акты приёма-передачи для A и B, приложения."
  ],

  "rules_for_cursor": [
    "Всегда требовать два блока объектов: A и B.",
    "Если сторона состоит в браке → открывать блок супруга, требовать согласие (upload).",
    "Если сторона указывает 'согласие имеется' → upload обязателен.",
    "Если основание права = договор → обязательны все реквизиты + скан.",
    "Если стоимости A и B различаются → обязательный блок 'Доплата' (кто кому и сколько).",
    "Не давать продолжить без выписок из реестра на оба объекта.",
    "Если сторона действует по доверенности → require upload доверенности.",
    "Валидация жёсткая, как в нотариальной практике.",
    "Генерация должна включать: договор, два акта приёма-передачи, приложения.",
    "Все placeholders должны совпадать со структурой документов DOCX."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — META */
      {
        "id": "meta",
        "type": "form",
        "title": "Метаданные сделки",
        "fields": [
          { "name": "txn.id", "type": "text", "label": "ID сделки" },
          { "name": "txn.location", "type": "text", "label": "Место составления" }
        ],
        "next": "parties"
      },

      /* STEP 2 — PARTIES */
      {
        "id": "parties",
        "type": "section",
        "title": "Стороны сделки",
        "children": [

          {
            "id": "party_a",
            "type": "form",
            "title": "Сторона 1",
            "fields": [
              { "name": "party_a.full_name", "type": "text", "label": "ФИО" },
              { "name": "party_a.iin", "type": "text", "label": "ИИН" },
              { "name": "party_a.passport", "type": "text", "label": "Паспорт (серия/№)" },
              { "name": "party_a.contact", "type": "text", "label": "Контакт" },
              { "name": "party_a.upload_passport[]", "type": "file", "label": "Скан паспорта", "min": 1 }
            ]
          },

          {
            "id": "party_b",
            "type": "form",
            "title": "Сторона 2",
            "fields": [
              { "name": "party_b.full_name", "type": "text", "label": "ФИО" },
              { "name": "party_b.iin", "type": "text", "label": "ИИН" },
              { "name": "party_b.passport", "type": "text", "label": "Паспорт (серия/№)" },
              { "name": "party_b.contact", "type": "text", "label": "Контакт" },
              { "name": "party_b.upload_passport[]", "type": "file", "label": "Скан паспорта", "min": 1 }
            ]
          }
        ],
        "next": "marriage_a"
      },

      /* STEP 3 — MARRIAGE STATUS A */
      {
        "id": "marriage_a",
        "type": "radio",
        "title": "Брачный статус Стороны 1",
        "options": [
          { "value": "married", "label": "В браке" },
          { "value": "not_married", "label": "Не состоит" },
          { "value": "consent_available", "label": "Согласие имеется" }
        ],
        "required": true,
        "next": {
          "married": "marriage_a_spouse",
          "not_married": "object_a_type",
          "consent_available": "marriage_a_upload"
        }
      },

      {
        "id": "marriage_a_spouse",
        "type": "form",
        "title": "Супруг(а) Стороны 1",
        "fields": [
          { "name": "party_a_spouse.full_name", "type": "text", "label": "ФИО" },
          { "name": "party_a_spouse.iin", "type": "text", "label": "ИИН" },
          { "name": "party_a_spouse.consent_upload", "type": "file", "label": "Загрузить согласие супруга", "min": 1 }
        ],
        "next": "object_a_type"
      },

      {
        "id": "marriage_a_upload",
        "type": "form",
        "title": "Загрузить согласие супруга",
        "fields": [
          { "name": "party_a_spouse.consent_file", "type": "file", "label": "Файл согласия", "min": 1 }
        ],
        "next": "object_a_type"
      },

      /* STEP 4 — OBJECT A */
      {
        "id": "object_a_type",
        "type": "radio",
        "title": "Тип объекта A",
        "options": [
          { "value": "apartment", "label": "Квартира" },
          { "value": "house", "label": "Дом / дача" },
          { "value": "land", "label": "Земельный участок" },
          { "value": "commercial", "label": "Нежилое помещение" },
          { "value": "garage", "label": "Гараж / паркинг" },
          { "value": "share", "label": "Доля" }
        ],
        "required": true,
        "next": "object_a_details"
      },

      {
        "id": "object_a_details",
        "type": "form",
        "title": "Данные объекта A",
        "fields": [
          { "name": "object_a.address", "type": "text", "label": "Адрес" },
          { "name": "object_a.cadastral", "type": "text", "label": "Кадастровый номер" },
          { "name": "object_a.docs.upload[]", "type": "file", "label": "Правоустан. документы", "min": 1 }
        ],
        "required": true,
        "next": "ownership_a"
      },

      /* STEP 5 — OWNERSHIP A */
      {
        "id": "ownership_a",
        "type": "radio",
        "title": "Основание права собственности (Объект A)",
        "options": [
          { "value": "sale_contract", "label": "Договор купли-продажи" },
          { "value": "gift_contract", "label": "Договор дарения" },
          { "value": "inheritance", "label": "Наследство" },
          { "value": "akim_decision", "label": "Решение акима" },
          { "value": "other", "label": "Иное" }
        ],
        "required": true,
        "next": {
          "sale_contract": "ownership_a_contract",
          "gift_contract": "ownership_a_contract",
          "inheritance": "ownership_a_inheritance",
          "akim_decision": "ownership_a_akim",
          "other": "ownership_a_other"
        }
      },

      {
        "id": "ownership_a_contract",
        "type": "form",
        "fields": [
          { "name": "object_a_contract.type", "type": "text", "label": "Тип договора" },
          { "name": "object_a_contract.date", "type": "date", "label": "Дата" },
          { "name": "object_a_contract.notary", "type": "text", "label": "Нотариус" },
          { "name": "object_a_contract.registry_number", "type": "text", "label": "Реестровый №" },
          { "name": "object_a_contract.upload", "type": "file", "min": 1 }
        ],
        "next": "object_b_type"
      },

      {
        "id": "ownership_a_inheritance",
        "type": "form",
        "fields": [
          { "name": "object_a_inheritance.act", "type": "text", "label": "Акт наследства" },
          { "name": "object_a_inheritance.upload", "type": "file", "min": 1 }
        ],
        "next": "object_b_type"
      },

      {
        "id": "ownership_a_akim",
        "type": "form",
        "fields": [
          { "name": "object_a_akim.number", "type": "text", "label": "Номер решения" },
          { "name": "object_a_akim.date", "type": "date", "label": "Дата" },
          { "name": "object_a_akim.organ", "type": "text", "label": "Орган" },
          { "name": "object_a_akim.upload", "type": "file", "min": 1 }
        ],
        "next": "object_b_type"
      },

      {
        "id": "ownership_a_other",
        "type": "form",
        "fields": [
          { "name": "object_a_other.description", "type": "text", "label": "Описание документа" },
          { "name": "object_a_other.upload", "type": "file", "min": 1 }
        ],
        "next": "object_b_type"
      },

      /* STEP 6 — OBJECT B (mirror of A) */
      {
        "id": "object_b_type",
        "type": "radio",
        "title": "Тип объекта B",
        "options": [
          { "value": "apartment", "label": "Квартира" },
          { "value": "house", "label": "Дом / дача" },
          { "value": "land", "label": "Земельный участок" },
          { "value": "commercial", "label": "Нежилое помещение" },
          { "value": "garage", "label": "Гараж / паркинг" },
          { "value": "share", "label": "Доля" }
        ],
        "required": true,
        "next": "object_b_details"
      },

      {
        "id": "object_b_details",
        "type": "form",
        "title": "Данные объекта B",
        "fields": [
          { "name": "object_b.address", "type": "text", "label": "Адрес" },
          { "name": "object_b.cadastral", "type": "text", "label": "Кадастровый номер" },
          { "name": "object_b.docs.upload[]", "type": "file", "label": "Правоустан. документы", "min": 1 }
        ],
        "next": "ownership_b"
      },

      /* STEP 7 — OWNERSHIP B */
      {
        "id": "ownership_b",
        "type": "radio",
        "title": "Основание права собственного (Объект B)",
        "options": [
          { "value": "sale_contract", "label": "Договор купли-продажи" },
          { "value": "gift_contract", "label": "Договор дарения" },
          { "value": "inheritance", "label": "Наследство" },
          { "value": "akim_decision", "label": "Решение акима" },
          { "value": "other", "label": "Иное" }
        ],
        "required": true,
        "next": {
          "sale_contract": "ownership_b_contract",
          "gift_contract": "ownership_b_contract",
          "inheritance": "ownership_b_inheritance",
          "akim_decision": "ownership_b_akim",
          "other": "ownership_b_other"
        }
      },

      {
        "id": "ownership_b_contract",
        "type": "form",
        "fields": [
          { "name": "object_b_contract.type", "type": "text" },
          { "name": "object_b_contract.date", "type": "date" },
          { "name": "object_b_contract.notary", "type": "text" },
          { "name": "object_b_contract.registry_number", "type": "text" },
          { "name": "object_b_contract.upload", "type": "file", "min": 1 }
        ],
        "next": "values"
      },

      {
        "id": "ownership_b_inheritance",
        "type": "form",
        "fields": [
          { "name": "object_b_inheritance.act", "type": "text" },
          { "name": "object_b_inheritance.upload", "type": "file", "min": 1 }
        ],
        "next": "values"
      },

      {
        "id": "ownership_b_akim",
        "type": "form",
        "fields": [
          { "name": "object_b_akim.number", "type": "text" },
          { "name": "object_b_akim.date", "type": "date" },
          { "name": "object_b_akim.organ", "type": "text" },
          { "name": "object_b_akim.upload", "type": "file", "min": 1 }
        ],
        "next": "values"
      },

      {
        "id": "ownership_b_other",
        "type": "form",
        "fields": [
          { "name": "object_b_other.description", "type": "text" },
          { "name": "object_b_other.upload", "type": "file", "min": 1 }
        ],
        "next": "values"
      },

      /* STEP 8 — VALUES */
      {
        "id": "values",
        "type": "form",
        "title": "Стоимость объектов",
        "fields": [
          { "name": "object_a.value", "type": "number", "label": "Стоимость объекта A" },
          { "name": "object_b.value", "type": "number", "label": "Стоимость объекта B" }
        ],
        "next": "doplate_cond"
      },

      /* STEP 9 — EXTRA PAYMENT */
      {
        "id": "doplate_cond",
        "type": "condition",
        "expression": "object_a.value != object_b.value",
        "next_if_true": "doplate",
        "next_if_false": "expenses"
      },

      {
        "id": "doplate",
        "type": "form",
        "fields": [
          { "name": "doplate.who", "type": "radio", "options": [
            { "value": "a_to_b", "label": "Доплата от A к B" },
            { "value": "b_to_a", "label": "Доплата от B к A" }
          ]},
          { "name": "doplate.amount", "type": "number", "label": "Сумма доплаты" }
        ],
        "next": "expenses"
      },

      /* STEP 10 — EXPENSES */
      {
        "id": "expenses",
        "type": "radio",
        "title": "Расходы по сделке",
        "options": [
          { "value": "party_a", "label": "Сторона A" },
          { "value": "party_b", "label": "Сторона B" },
          { "value": "shared", "label": "50/50" }
        ],
        "required": true,
        "next": "representation"
      },

      /* STEP 11 — REPRESENTATION */
      {
        "id": "representation",
        "type": "section",
        "title": "Представительство",
        "children": [
          {
            "id": "rep_a",
            "type": "radio",
            "title": "Сторона A",
            "options": [
              { "value": "personal", "label": "Лично" },
              { "value": "poa", "label": "По доверенности" }
            ],
            "next": {
              "poa": "rep_a_poa",
              "personal": "rep_b"
            }
          },

          {
            "id": "rep_a_poa",
            "type": "form",
            "fields": [
              { "name": "rep_a_poa.registry", "type": "text", "label": "Реестровый №" },
              { "name": "rep_a_poa.notary", "type": "text", "label": "Нотариус" },
              { "name": "rep_a_poa.date", "type": "date", "label": "Дата выдачи" },
              { "name": "rep_a_poa.upload", "type": "file", "min": 1 }
            ],
            "next": "rep_b"
          },

          {
            "id": "rep_b",
            "type": "radio",
            "title": "Сторона B",
            "options": [
              { "value": "personal", "label": "Лично" },
              { "value": "poa", "label": "По доверенности" }
            ],
            "next": {
              "poa": "rep_b_poa",
              "personal": "validate"
            }
          },

          {
            "id": "rep_b_poa",
            "type": "form",
            "fields": [
              { "name": "rep_b_poa.registry", "type": "text" },
              { "name": "rep_b_poa.notary", "type": "text" },
              { "name": "rep_b_poa.date", "type": "date" },
              { "name": "rep_b_poa.upload", "type": "file", "min": 1 }
            ],
            "next": "validate"
          }
        ]
      },

      /* STEP 12 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required party_a.full_name",
          "required party_b.full_name",
          "required object_a",
          "required object_b",
          "required object_a.value",
          "required object_b.value",
          "if rep_a == 'poa' → require rep_a_poa.upload",
          "if rep_b == 'poa' → require rep_b_poa.upload",
          "require registry extracts for both objects"
        ],
        "next": "generate"
      },

      /* STEP 13 — GENERATION */
      {
        "id": "generate",
        "type": "final",
        "output": "docx+pdf"
      }
    ],

    "placeholders": [
      "txn",
      "party_a",
      "party_b",
      "party_a_spouse",
      "party_b_spouse",
      "object_a",
      "object_b",
      "ownership_a",
      "ownership_b",
      "doplate",
      "expenses",
      "representation"
    ]
  }
},
{
  "id": 27,
  "code": "DOC_027",
  "title": "Договор дарения недвижимости",
  "category": "Недвижимость / Дарение / Сделки",
  
  "dev_notes": [
    "Поддерживает дарение квартиры, дома, участка, нежилого помещения, гаража/паркинга и доли.",
    "Требует обязательного указания брачного статуса дарителя — это влияет на обязательность согласия супруга.",
    "Система должна проверять наличие прав собственности и отсутствие обременений по выписке.",
    "Условия дарения могут быть: обычный дар, дар с обременением, пожизненное содержание, дар с условиями отмены, частичный дар (доля).",
    "При действии по доверенности обязательны реквизиты доверенности и upload.",
    "Плейсхолдеры: {{object}}, {{donor}}, {{donee}}, {{marriage_status}}, {{ownership_basis}}, {{gift_conditions}}, {{documents}}, {{poa}}, {{registration}}."
  ],

  "rules_for_cursor": [
    "object.type required",
    "donor and donee required",
    "donor.marriage_status required",
    "If donor.marriage_status = married → require spouse_consent",
    "ownership_basis.type required",
    "If basis = contract → require contract fields and upload",
    "If basis = inheritance → require act fields and upload",
    "gift_conditions.required = true",
    "If gift_conditions include obligations → require description and upload",
    "Upload of title documents required",
    "Upload of registry extract required",
    "Validation must block generation until all required uploads and fields are present"
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — META */
      {
        "id": "meta",
        "type": "form",
        "title": "Метаданные сделки",
        "fields": [
          { "name": "meta.transaction_id", "label": "ID сделки (генерируется автоматически)", "type": "auto" },
          { "name": "meta.location", "label": "Место составления (город / нотариус)", "type": "text" }
        ],
        "next": "object_type"
      },

      /* STEP 2 — OBJECT TYPE */
      {
        "id": "object_type",
        "type": "select",
        "title": "Тип объекта недвижимости",
        "options": [
          "Квартира",
          "Жилой дом / дача",
          "Земельный участок",
          "Нежилое помещение",
          "Гараж / паркинг",
          "Доля в праве"
        ],
        "required": true,
        "name": "object.type",
        "next": "object_details"
      },

      /* STEP 3 — OBJECT DETAILS */
      {
        "id": "object_details",
        "type": "form",
        "title": "Данные объекта",
        "fields": [
          { "name": "object.address", "label": "Адрес", "type": "text" },
          { "name": "object.cadastre", "label": "Кадастровый номер", "type": "text" },
          { "name": "object.doc.series", "label": "Правоустанавливающий документ — серия/№", "type": "text" },
          { "name": "object.doc.issued_by", "label": "Кем выдан", "type": "text" },
          { "name": "object.doc.issued_date", "label": "Дата выдачи", "type": "date" },
          { "name": "object.encumbrances", "label": "Наличие обременений (ипотека/арест)", "type": "checkbox" }
        ],
        "required": true,
        "next": "parties"
      },

      /* STEP 4 — PARTIES */
      {
        "id": "parties",
        "type": "multi-card",
        "title": "Стороны договора",
        "cards": [
          {
            "title": "Даритель",
            "name": "donor",
            "fields": [
              { "name": "donor.full_name", "label": "ФИО", "type": "text" },
              { "name": "donor.iin", "label": "ИИН", "type": "text" },
              { "name": "donor.passport", "label": "Документ личности", "type": "text" },
              { "name": "donor.address", "label": "Адрес регистрации", "type": "text" },
              { "name": "donor.contact", "label": "Контакты", "type": "text" }
            ]
          },
          {
            "title": "Одаряемый",
            "name": "donee",
            "fields": [
              { "name": "donee.full_name", "label": "ФИО", "type": "text" },
              { "name": "donee.iin", "label": "ИИН", "type": "text" },
              { "name": "donee.passport", "label": "Документ личности", "type": "text" },
              { "name": "donee.address", "label": "Адрес регистрации", "type": "text" },
              { "name": "donee.contact", "label": "Контакты", "type": "text" }
            ]
          }
        ],
        "required": true,
        "next": "donor_marriage"
      },

      /* STEP 5 — DONOR MARRIAGE STATUS */
      {
        "id": "donor_marriage",
        "type": "radio",
        "title": "Брачный статус дарителя",
        "options": [
          { "value": "married", "label": "В браке сейчас" },
          { "value": "not_married", "label": "Не состоит" },
          { "value": "consent_available", "label": "Согласие супруга уже имеется" }
        ],
        "required": true,
        "name": "donor.marriage_status",
        "next": {
          "married": "donor_married_block",
          "not_married": "donee_marriage",
          "consent_available": "donee_marriage"
        }
      },

      {
        "id": "donor_married_block",
        "type": "form",
        "title": "Данные супруга дарителя",
        "fields": [
          { "name": "spouse.full_name", "label": "ФИО", "type": "text" },
          { "name": "spouse.iin", "label": "ИИН", "type": "text" },
          { "name": "spouse.passport", "label": "Документ личности", "type": "text" },
          { "name": "spouse.consent_doc", "label": "Согласие супруга (upload)", "type": "file", "min": 1 }
        ],
        "next": "donee_marriage"
      },

      /* STEP 6 — DONEE MARRIAGE (optional) */
      {
        "id": "donee_marriage",
        "type": "radio",
        "title": "Брачный статус одаряемого (информативно)",
        "options": [
          "В браке",
          "Не состоит",
          "Согласие супруга имеется (upload)"
        ],
        "name": "donee.marriage_status",
        "next": "ownership_basis"
      },

      /* STEP 7 — BASIS OF OWNERSHIP */
      {
        "id": "ownership_basis",
        "type": "select",
        "title": "Основание права собственности дарителя",
        "options": [
          "Договор купли-продажи",
          "Договор дарения",
          "Наследство",
          "Решение органа",
          "Иное"
        ],
        "required": true,
        "name": "basis.type",
        "next": "basis_details"
      },

      /* STEP 8 — BASIS DETAILS */
      {
        "id": "basis_details",
        "type": "switch",
        "title": "Детали основания собственности",
        "cases": {
          "Договор купли-продажи": "basis_contract",
          "Договор дарения": "basis_contract",
          "Решение органа": "basis_org",
          "Наследство": "basis_inherit",
          "Иное": "basis_other"
        }
      },

      {
        "id": "basis_contract",
        "type": "form",
        "title": "Реквизиты предыдущего договора",
        "fields": [
          { "name": "basis.contract.type", "label": "Тип договора", "type": "text" },
          { "name": "basis.contract.date", "label": "Дата договора", "type": "date" },
          { "name": "basis.contract.notary", "label": "Нотариус (ФИО/контора)", "type": "text" },
          { "name": "basis.contract.regnum", "label": "Реестровый номер", "type": "text" },
          { "name": "basis.contract.upload", "label": "Upload копии договора", "type": "file", "min": 1 }
        ],
        "next": "gift_conditions"
      },

      {
        "id": "basis_org",
        "type": "form",
        "title": "Решение органа",
        "fields": [
          { "name": "basis.org.number", "label": "Номер решения", "type": "text" },
          { "name": "basis.org.date", "label": "Дата", "type": "date" },
          { "name": "basis.org.upload", "label": "Upload решения", "type": "file", "min": 1 }
        ],
        "next": "gift_conditions"
      },

      {
        "id": "basis_inherit",
        "type": "form",
        "title": "Наследство",
        "fields": [
          { "name": "basis.inherit.act", "label": "Реквизиты акта", "type": "text" },
          { "name": "basis.inherit.upload", "label": "Upload акта", "type": "file", "min": 1 }
        ],
        "next": "gift_conditions"
      },

      {
        "id": "basis_other",
        "type": "form",
        "title": "Иное основание",
        "fields": [
          { "name": "basis.other.text", "label": "Описание", "type": "text" },
          { "name": "basis.other.upload", "label": "Файл", "type": "file" }
        ],
        "next": "gift_conditions"
      },

      /* STEP 9 — GIFT CONDITIONS */
      {
        "id": "gift_conditions",
        "type": "checkbox",
        "title": "Условия дарения",
        "options": [
          "Обычное дарение (безвозмездно)",
          "Дарение с обременением",
          "Пожизненное содержание",
          "Право отмены / отказа при условиях",
          "Дарение доли (%)"
        ],
        "name": "gift.conditions",
        "required": true,
        "next": "value_section"
      },

      /* STEP 10 — VALUE SECTION */
      {
        "id": "value_section",
        "type": "form",
        "title": "Стоимость объекта (информативно)",
        "fields": [
          { "name": "value.estimated", "label": "Оценочная стоимость", "type": "text" },
          { "name": "value.appraisal_upload", "label": "Отчёт оценщика (upload)", "type": "file" }
        ],
        "next": "documents"
      },

      /* STEP 11 — DOCUMENTS */
      {
        "id": "documents",
        "type": "checkbox-upload",
        "title": "Документы",
        "options": [
          "Паспорта сторон",
          "Правоустанавливающие документы",
          "Выписка из реестра прав (актуальная)",
          "Согласие супруга",
          "Документы, подтверждающие условия дарения",
          "Иные документы"
        ],
        "name": "documents",
        "min": 1,
        "next": "representation"
      },

      /* STEP 12 — REPRESENTATION */
      {
        "id": "representation",
        "type": "radio",
        "title": "Кто приходит на сделку",
        "options": [
          "Лично",
          "По доверенности"
        ],
        "name": "representation.type",
        "next": {
          "Лично": "validation",
          "По доверенности": "poa_block"
        }
      },

      {
        "id": "poa_block",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.regnum", "label": "Реестровый номер", "type": "text" },
          { "name": "poa.issued_by", "label": "Кем выдана", "type": "text" },
          { "name": "poa.date", "label": "Дата выдачи", "type": "date" },
          { "name": "poa.upload", "label": "Upload доверенности", "type": "file", "min": 1 }
        ],
        "next": "validation"
      },

      /* STEP 13 — VALIDATION */
      {
        "id": "validation",
        "type": "validation",
        "checks": [
          "donor & donee filled",
          "ownership basis valid",
          "if married → spouse consent required",
          "encumbrances must not block transaction",
          "registry extract uploaded",
          "poa required if representation = poa"
        ],
        "next_on_success": "generate_docs",
        "next_on_error": "show_errors"
      },

      {
        "id": "show_errors",
        "type": "error",
        "title": "Исправьте ошибки",
        "next": "validation"
      },

      /* STEP 14 — GENERATION */
      {
        "id": "generate_docs",
        "type": "final",
        "title": "Генерация договора",
        "output": "docx"
      }
    ],

    "placeholders": [
      "object",
      "donor",
      "donee",
      "marriage_status",
      "ownership_basis",
      "gift_conditions",
      "documents",
      "poa",
      "registration"
    ]
  }
},
{
  "id": 28,
  "code": "DOC_028",
  "title": "Договор аренды — недвижимость / транспортное средство",
  "category": "Договоры / Аренда / Недвижимость / Транспорт",

  "dev_notes": [
    "Шаблон имеет две крупные ветки: аренда недвижимости и аренда ТС.",
    "Для недвижимости обязательны: адрес, тип объекта, кадастр (если есть), выписка из реестра прав.",
    "Для ТС обязательны: марка, модель, VIN, гос. номер, техпаспорт, регистрационный документ.",
    "Согласие супруга — опционально: по умолчанию не требуется, но оставлена возможность загрузить.",
    "Оплата, залог, коммунальные услуги — строго обязательные поля.",
    "Дополнительные документы зависят от выбора опций.",
    "Генерация: договор аренды + (опционально) акт приёма-передачи.",
    "Валидация должна блокировать генерацию до загрузки всех обязательных документов."
  ],

  "rules_for_cursor": [
    "Первый шаг — выбор типа аренды: недвижимость или транспорт.",
    "UI должен ветвиться полностью на две логики.",
    "Каждый блок документов должен требовать .upload при обязательности.",
    "Контроль сроков: обязательное заполнение.",
    "Если включены обременения, должен появляться блок деталей.",
    "Если выбран фиксированный срок — оба поля даты обязательны.",
    "При аренде ТС обязательны документы арендатора, регистрация ТС, данные страховки (если выбрана).",
    "Плейсхолдеры: {{parties}}, {{object}}, {{terms}}, {{payment}}, {{maintenance}}, {{insurance}}, {{registration}}, {{attachments}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — TYPE */
      {
        "id": "type_choice",
        "type": "radio",
        "title": "Тип арендуемого объекта",
        "required": true,
        "options": [
          { "value": "real", "label": "Недвижимость" },
          { "value": "vehicle", "label": "Транспортное средство" }
        ],
        "next": {
          "real": "real_object",
          "vehicle": "veh_object"
        }
      },

      /* ---------------------------- НЕДВИЖИМОСТЬ ---------------------------- */

      {
        "id": "real_object",
        "type": "form",
        "title": "Объект недвижимости",
        "fields": [
          { "name": "real.type", "type": "select", "label": "Тип", "options": ["Квартира", "Дом", "Участок", "Нежилое помещение", "Паркинг"] },
          { "name": "real.address", "type": "text", "label": "Полный адрес" },
          { "name": "real.cadastral", "type": "text", "label": "Кадастровый номер (если есть)" }
        ],
        "required": true,
        "next": "real_ownership"
      },

      {
        "id": "real_ownership",
        "type": "form",
        "title": "Право собственности",
        "fields": [
          { "name": "real.registry_number", "type": "text", "label": "Регистрационный номер выписки" },
          { "name": "real.registry_date", "type": "date", "label": "Дата выдачи выписки" },
          { "name": "real.registry_extract", "type": "file", "label": "Выписка из реестра прав", "min": 1 },
          { "name": "real.encumbrances", "type": "checkbox", "label": "Есть обременения" },
          { "name": "real.encumbrances_details", "type": "textarea", "label": "Детали обременений", "condition": "real.encumbrances == true" },
          { "name": "real.prev_contract_details", "type": "textarea", "label": "Реквизиты предыдущего договора (необязательно)" }
        ],
        "next": "real_parties"
      },

      {
        "id": "real_parties",
        "type": "form",
        "title": "Стороны",
        "fields": [
          /* Арендодатель */
          { "name": "landlord.full_name", "type": "text", "label": "Арендодатель — ФИО/Наим." },
          { "name": "landlord.iin_bin", "type": "text", "label": "ИИН/БИН" },
          { "name": "landlord.passport", "type": "text", "label": "Паспорт/удостоверение" },
          { "name": "landlord.contact", "type": "text", "label": "Контакт" },

          /* Арендатор */
          { "name": "tenant.full_name", "type": "text", "label": "Арендатор — ФИО" },
          { "name": "tenant.iin", "type": "text", "label": "ИИН" },
          { "name": "tenant.passport", "type": "text", "label": "Документ" },
          { "name": "tenant.contact", "type": "text", "label": "Контакт" }
        ],
        "next": "marital_option_real"
      },

      {
        "id": "marital_option_real",
        "type": "radio",
        "title": "Согласие супруга (по желанию)",
        "options": [
          { "value": "no", "label": "Не требуется" },
          { "value": "yes", "label": "Загрузить согласие" }
        ],
        "next": {
          "no": "terms_real",
          "yes": "marital_upload_real"
        }
      },

      {
        "id": "marital_upload_real",
        "type": "form",
        "title": "Согласие супруга",
        "fields": [
          { "name": "real.spouse_consent", "type": "file", "label": "Upload согласия", "min": 1 }
        ],
        "next": "terms_real"
      },

      /* TERMS */
      {
        "id": "terms_real",
        "type": "form",
        "title": "Срок аренды",
        "fields": [
          {
            "name": "real.term_type",
            "type": "select",
            "label": "Тип",
            "options": [
              "Фиксированный период (дата с — по)",
              "Бессрочно с правом расторжения",
              "Автоматическая пролонгация"
            ]
          },
          { "name": "real.date_from", "type": "date", "label": "Дата начала", "condition": "real.term_type == 'Фиксированный период (дата с — по)'" },
          { "name": "real.date_to", "type": "date", "label": "Дата окончания", "condition": "real.term_type == 'Фиксированный период (дата с — по)'" }
        ],
        "next": "payment_real"
      },

      /* PAYMENT */
      {
        "id": "payment_real",
        "type": "form",
        "title": "Оплата и гарантии",
        "fields": [
          { "name": "real.rent_amount", "type": "number", "label": "Арендная плата" },
          { "name": "real.currency", "type": "select", "options": ["KZT", "USD", "EUR"], "label": "Валюта" },
          { "name": "real.payment_period", "type": "select", "options": ["Ежемесячно", "Ежегодно"], "label": "Период" },
          { "name": "real.payment_method", "type": "select", "options": ["Перечисление", "Наличные", "Карта"], "label": "Порядок платежа" },
          { "name": "real.deposit", "type": "number", "label": "Залог / депозит" },
          { "name": "real.deposit_terms", "type": "textarea", "label": "Условия возврата залога" },
          { "name": "real.utilities", "type": "select", "label": "Коммунальные услуги", "options": ["Арендатор", "Арендодатель", "По счетчикам"] }
        ],
        "next": "use_conds_real"
      },

      {
        "id": "use_conds_real",
        "type": "checkbox-group",
        "title": "Права и обязанности",
        "options": [
          { "value": "use_purpose", "label": "Использовать по назначению" },
          { "value": "sublease", "label": "Субаренда" },
          { "value": "repairs", "label": "Ремонт/переделки требуют согласия" },
          { "value": "handover", "label": "Акт приёма-передачи обязателен" }
        ],
        "next": "maintenance_real"
      },

      {
        "id": "maintenance_real",
        "type": "form",
        "title": "Техническое обслуживание",
        "fields": [
          { "name": "real.tech_current", "type": "text", "label": "Кто делает текущий ремонт" },
          { "name": "real.tech_capital", "type": "text", "label": "Кто делает капитальный ремонт" }
        ],
        "next": "insurance_real"
      },

      {
        "id": "insurance_real",
        "type": "form",
        "title": "Страхование",
        "fields": [
          { "name": "real.ins_required", "type": "radio", "label": "Требуется страховка имущества?", "options": [
            { "value": "yes", "label": "Да" },
            { "value": "no", "label": "Нет" }
          ]},
          { "name": "real.ins_policy", "type": "file", "label": "Полис", "condition": "real.ins_required == 'yes'" }
        ],
        "next": "registration_real"
      },

      {
        "id": "registration_real",
        "type": "checkbox-group",
        "title": "Регистрация/уведомления",
        "options": [
          { "value": "reg_centre", "label": "Требуется регистрация в ЦОН/реестре" },
          { "value": "inform_neighbors", "label": "Уведомить соседей/участковый" }
        ],
        "next": "documents_real"
      },

      {
        "id": "documents_real",
        "type": "form",
        "title": "Документы",
        "fields": [
          { "name": "real.upload_registry", "type": "file", "min": 1, "label": "Выписка из реестра" },
          { "name": "real.upload_passports", "type": "file", "min": 1, "label": "Паспорта сторон" },
          { "name": "real.upload_encumbrance_docs", "type": "file", "label": "Документы об обременениях", "min": 0 }
        ],
        "next": "validate_real"
      },

      {
        "id": "validate_real",
        "type": "validation",
        "rules": [
          "required real.address",
          "required real.registry_extract",
          "required landlord.full_name",
          "required tenant.full_name",
          "required real.rent_amount",
          "required real.deposit",
          "required real.upload_registry"
        ],
        "next": "generate_real"
      },

      {
        "id": "generate_real",
        "type": "final",
        "output": "docx+pdf"
      },

      /* ---------------------------- ТРАНСПОРТ ---------------------------- */

      {
        "id": "veh_object",
        "type": "form",
        "title": "Транспортное средство",
        "fields": [
          { "name": "veh.type", "type": "select", "options": ["Авто", "Мото", "Спецтехника"], "label": "Тип ТС" },
          { "name": "veh.brand", "type": "text", "label": "Марка" },
          { "name": "veh.model", "type": "text", "label": "Модель" },
          { "name": "veh.vin", "type": "text", "label": "VIN" },
          { "name": "veh.plate", "type": "text", "label": "Гос. номер" },
          { "name": "veh.reg_doc", "type": "file", "min": 1, "label": "Регистрационный документ ТС" }
        ],
        "next": "veh_ownership"
      },

      {
        "id": "veh_ownership",
        "type": "form",
        "title": "Право собственности на ТС",
        "fields": [
          { "name": "veh.reg_number", "type": "text", "label": "Регистрационный № / дата" },
          { "name": "veh.encumbrances", "type": "checkbox", "label": "Есть обременения" },
          { "name": "veh.encumbrance_details", "type": "textarea", "label": "Детали", "condition": "veh.encumbrances == true" },
          { "name": "veh.ins_policy", "type": "file", "label": "Страховой полис (OSAGO/CASCO)", "min": 0 }
        ],
        "next": "veh_parties"
      },

      {
        "id": "veh_parties",
        "type": "form",
        "title": "Стороны",
        "fields": [
          { "name": "veh.owner_full_name", "type": "text", "label": "Собственник" },
          { "name": "veh.owner_iin", "type": "text", "label": "ИИН" },
          { "name": "veh.owner_passport", "type": "text", "label": "Документ" },

          { "name": "veh.tenant_full_name", "type": "text", "label": "Арендатор" },
          { "name": "veh.tenant_iin", "type": "text", "label": "ИИН" },
          { "name": "veh.tenant_passport", "type": "text", "label": "Документ" }
        ],
        "next": "veh_marital"
      },

      {
        "id": "veh_marital",
        "type": "radio",
        "title": "Согласие супруга",
        "options": [
          { "value": "no", "label": "Не требуется" },
          { "value": "yes", "label": "Загрузить согласие" }
        ],
        "next": {
          "no": "veh_terms",
          "yes": "veh_marital_upload"
        }
      },

      {
        "id": "veh_marital_upload",
        "type": "form",
        "fields": [
          { "name": "veh.spouse_consent", "type": "file", "label": "Согласие супруга", "min": 1 }
        ],
        "next": "veh_terms"
      },

      {
        "id": "veh_terms",
        "type": "form",
        "title": "Срок аренды",
        "fields": [
          { "name": "veh.term_type", "type": "select", "label": "Тип", "options": ["Фиксированный", "Бессрочно", "Прокат (краткосрочный)"] },
          { "name": "veh.date_from", "type": "date", "label": "Дата начала", "condition": "veh.term_type == 'Фиксированный'" },
          { "name": "veh.date_to", "type": "date", "label": "Дата окончания", "condition": "veh.term_type == 'Фиксированный'" }
        ],
        "next": "veh_payment"
      },

      {
        "id": "veh_payment",
        "type": "form",
        "title": "Оплата",
        "fields": [
          { "name": "veh.rent_amount", "type": "number", "label": "Арендная плата" },
          { "name": "veh.currency", "type": "select", "options": ["KZT", "USD", "EUR"], "label": "Валюта" },
          { "name": "veh.payment_period", "type": "select", "options": ["Дни", "Месяцы"], "label": "Период" },
          { "name": "veh.deposit", "type": "number", "label": "Залог" },
          { "name": "veh.deposit_terms", "type": "textarea", "label": "Условия" },
          { "name": "veh.expenses", "type": "text", "label": "Кто оплачивает износ/топливо/штрафы" }
        ],
        "next": "veh_usage"
      },

      {
        "id": "veh_usage",
        "type": "checkbox-group",
        "title": "Условия использования",
        "options": [
          { "value": "mileage", "label": "Ограничение пробега" },
          { "value": "geo", "label": "Ограничение географии" },
          { "value": "sublease", "label": "Разрешение/запрет субаренды" },
          { "value": "maintenance", "label": "Обязанность предоставлять ТО" }
        ],
        "next": "veh_insurance"
      },

      {
        "id": "veh_insurance",
        "type": "form",
        "title": "Страхование и ответственность",
        "fields": [
          { "name": "veh.ins_holder", "type": "select", "label": "Кто держит полис", "options": ["Арендодатель", "Арендатор"] },
          { "name": "veh.accidents", "type": "textarea", "label": "Порядок действий при ДТП" }
        ],
        "next": "veh_documents"
      },

      {
        "id": "veh_documents",
        "type": "form",
        "title": "Документы",
        "fields": [
          { "name": "veh.upload_reg_doc", "type": "file", "label": "Регистрационный документ ТС", "min": 1 },
          { "name": "veh.upload_driver_license", "type": "file", "label": "Права арендатора (если нужно)", "min": 0 },
          { "name": "veh.upload_inspection", "type": "file", "label": "ТО / страховка", "min": 0 }
        ],
        "next": "veh_validate"
      },

      {
        "id": "veh_validate",
        "type": "validation",
        "rules": [
          "required veh.brand",
          "required veh.vin",
          "required veh.upload_reg_doc",
          "required veh.owner_full_name",
          "required veh.tenant_full_name",
          "required veh.rent_amount"
        ],
        "next": "veh_generate"
      },

      {
        "id": "veh_generate",
        "type": "final",
        "output": "docx+pdf"
      }
    ],

    "placeholders": [
      "real", "veh",
      "landlord", "tenant",
      "terms", "payment", "insurance",
      "documents", "attachments"
    ]
  }
},
{
  "id": 29,
  "code": "DOC_029",
  "title": "Договор залога / ипотека",
  "category": "Договоры / Обеспечение обязательств / Залог / Ипотека",

  "dev_notes": [
    "Договор должен поддерживать 3 варианта залогодержателя: банк, физическое лицо, юридическое лицо.",
    "Объект залога может быть любым: недвижимость, транспорт, доля, иное имущество — также поддерживается множественный выбор (несколько объектов).",
    "Для каждого объекта необходимо предоставить правоустанавливающие документы, выписку из реестра прав (обязательно), историю обременений.",
    "Если имущество принадлежит супругам — обязательное поле для согласия супруга.",
    "Блок условий кредита обязателен: сумма, процент, график, досрочное погашение.",
    "Блок дефолта — строго обязательный: уведомления, реализация залога, распределение выручки.",
    "При выборе регистрации — обязательные поля: реестровый номер, дата.",
    "Если стороны действуют по доверенности — обязательны реквизиты + upload.",
    "Генерация пакета документов: договор залога, ипотечный договор (если недвижимость), графики платежей, заявление на регистрацию залога, акты приёма-передачи.",
    "Финальная валидация блокирует генерацию при отсутствии обязательных документов."
  ],

  "rules_for_cursor": [
    "Стороны — обязательный блок. Нельзя продолжать без ФИО/ИИН/паспортов/контактов.",
    "Тип залогодержателя влияет на UI: банк → drop-list банков; физлицо → обычные поля; юрлицо → реквизиты + БИН.",
    "Каждый объект залога создаётся как отдельная карточка (repeater).",
    "Для каждого объекта upload выписки из реестра — обязательно.",
    "Если имущество совместное — запросить согласие супруга и upload.",
    "Обязателен блок условий кредита: сумма, процент, график платежей.",
    "Блок 'меры при дефолте' — обязательные текстовые поля.",
    "Блок регистрации — если включён чекбокс, поля рег. номера и даты становятся обязательными.",
    "Если представитель действует по доверенности — обязательные поля реестр №, нотариус, лицензия, дата, upload.",
    "Валидация запрещает переход к Generate без всех обязательных данных и документов.",
    "Плейсхолдеры формируются автоматически: {{parties}}, {{objects}}, {{loan_terms}}, {{default_rules}}, {{registration}}, {{poa}}, {{attachments}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — META */
      {
        "id": "meta",
        "type": "form",
        "title": "Метаданные сделки",
        "fields": [
          { "name": "meta.id", "type": "text", "label": "ID сделки" },
          { "name": "meta.place", "type": "text", "label": "Место составления" }
        ],
        "next": "parties"
      },

      /* STEP 2 — PARTIES */
      {
        "id": "parties",
        "type": "form",
        "title": "Стороны договора",
        "fields": [
          /* Залогодатель */
          { "name": "pledgor.full_name", "type": "text", "label": "Залогодатель — ФИО/Наим." },
          { "name": "pledgor.iin_bin", "type": "text", "label": "ИИН / БИН" },
          { "name": "pledgor.passport", "type": "text", "label": "Документ / паспорт" },
          { "name": "pledgor.address", "type": "text", "label": "Адрес" },
          { "name": "pledgor.contact", "type": "text", "label": "Контакты" },

          /* Залогодержатель — тип выбирается позже */
          { "name": "pledgee.type", "type": "radio", "label": "Тип залогодержателя", "options": [
            { "value": "bank", "label": "Банк / фин. организация" },
            { "value": "person", "label": "Физическое лицо" },
            { "value": "entity", "label": "Юридическое лицо" }
          ] }
        ],
        "required": true,
        "next": "pledgee_type"
      },

      /* STEP 3 — PLEDGEE TYPE BLOCK */
      {
        "id": "pledgee_type",
        "type": "switch",
        "cases": {
          "bank": "pledgee_bank",
          "person": "pledgee_person",
          "entity": "pledgee_entity"
        }
      },

      {
        "id": "pledgee_bank",
        "type": "form",
        "title": "Залогодержатель — банк",
        "fields": [
          { "name": "pledgee.bank_name", "type": "select", "label": "Банк", "options_source": "banks_list" },
          { "name": "pledgee.bik", "type": "text", "label": "БИК" },
          { "name": "pledgee.bank_contact", "type": "text", "label": "Контакт уполномоченного" }
        ],
        "next": "objects"
      },

      {
        "id": "pledgee_person",
        "type": "form",
        "title": "Залогодержатель — физическое лицо",
        "fields": [
          { "name": "pledgee.full_name", "type": "text", "label": "ФИО" },
          { "name": "pledgee.iin", "type": "text", "label": "ИИН" },
          { "name": "pledgee.passport", "type": "text", "label": "Паспорт" },
          { "name": "pledgee.address", "type": "text", "label": "Адрес" }
        ],
        "next": "objects"
      },

      {
        "id": "pledgee_entity",
        "type": "form",
        "title": "Залогодержатель — юридическое лицо",
        "fields": [
          { "name": "pledgee.entity_name", "type": "text", "label": "Наименование" },
          { "name": "pledgee.bin", "type": "text", "label": "БИН" },
          { "name": "pledgee.details", "type": "textarea", "label": "Реквизиты" }
        ],
        "next": "objects"
      },

      /* STEP 4 — OBJECTS */
      {
        "id": "objects",
        "type": "repeater",
        "title": "Объекты залога",
        "min": 1,
        "fields": [
          { "name": "object.type", "type": "select", "label": "Тип объекта", "options": ["Недвижимость", "ТС", "Доля", "Иное"] },
          { "name": "object.description", "type": "textarea", "label": "Описание объекта" },
          { "name": "object.reg_number", "type": "text", "label": "Кадастровый/регистрационный номер" },
          { "name": "object.ownership_doc", "type": "file", "label": "Правоустанавливающий документ", "min": 1 },
          { "name": "object.registry_extract", "type": "file", "label": "Выписка из реестра прав", "min": 1 }
        ],
        "next": "encumbrances"
      },

      /* STEP 5 — ENCUMBRANCES */
      {
        "id": "encumbrances",
        "type": "checkbox",
        "title": "Обременения",
        "options": [
          { "value": "has_encumbrances", "label": "Есть обременения" }
        ],
        "next": "encumbrances_details"
      },

      {
        "id": "encumbrances_details",
        "type": "form",
        "condition": "encumbrances includes 'has_encumbrances'",
        "fields": [
          { "name": "encumbrances.details", "type": "textarea", "label": "Детали обременений" }
        ],
        "next": "marriage_check"
      },

      /* STEP 6 — MARRIAGE CHECK */
      {
        "id": "marriage_check",
        "type": "radio",
        "title": "Брачный статус залогодателя",
        "options": [
          { "value": "married", "label": "В браке" },
          { "value": "single", "label": "Не в браке" },
          { "value": "consent_present", "label": "Согласие супруга имеется" }
        ],
        "next": {
          "married": "spouse_data",
          "consent_present": "spouse_data",
          "single": "loan_terms"
        }
      },

      {
        "id": "spouse_data",
        "type": "form",
        "fields": [
          { "name": "spouse.full_name", "type": "text", "label": "ФИО супруга" },
          { "name": "spouse.iin", "type": "text", "label": "ИИН" },
          { "name": "spouse.consent", "type": "file", "label": "Нотариальное согласие", "min": 1 }
        ],
        "next": "loan_terms"
      },

      /* STEP 7 — LOAN TERMS */
      {
        "id": "loan_terms",
        "type": "form",
        "title": "Условия обязательства",
        "fields": [
          { "name": "loan.amount", "type": "number", "label": "Сумма обязательства" },
          { "name": "loan.rate", "type": "number", "label": "Процентная ставка (%)" },
          { "name": "loan.schedule", "type": "select", "label": "График платежей", "options": ["Ежемесячно", "Ежеквартально", "Единовременно"] },
          { "name": "loan.term", "type": "text", "label": "Срок (мес/годы или дата)" },
          { "name": "loan.early_repayment", "type": "textarea", "label": "Условия досрочного погашения" }
        ],
        "next": "collateral_coverage"
      },

      /* STEP 8 — COLLATERAL COVERAGE */
      {
        "id": "collateral_coverage",
        "type": "form",
        "title": "Покрытие залогом",
        "fields": [
          { "name": "coverage.type", "type": "radio", "label": "Покрытие", "options": [
            { "value": "full", "label": "Полное покрытие" },
            { "value": "partial", "label": "Частичное покрытие" }
          ]},
          { "name": "coverage.amount", "type": "number", "label": "Покрываемая сумма/процент" }
        ],
        "next": "default_rules"
      },

      /* STEP 9 — DEFAULT RULES */
      {
        "id": "default_rules",
        "type": "form",
        "title": "Меры при дефолте",
        "fields": [
          { "name": "default.notice", "type": "textarea", "label": "Уведомление о просрочке" },
          { "name": "default.realization_method", "type": "textarea", "label": "Порядок реализации залога" },
          { "name": "default.revenue_distribution", "type": "textarea", "label": "Распределение выручки" }
        ],
        "next": "insurance"
      },

      /* STEP 10 — INSURANCE */
      {
        "id": "insurance",
        "type": "form",
        "title": "Страхование",
        "fields": [
          { "name": "insurance.required", "type": "radio", "label": "Требуется страхование?", "options": [
            { "value": "yes", "label": "Да" },
            { "value": "no", "label": "Нет" }
          ]},
          { "name": "insurance.policy", "type": "file", "label": "Страховой полис", "min": 0 }
        ],
        "next": "expenses"
      },

      /* STEP 11 — EXPENSES */
      {
        "id": "expenses",
        "type": "form",
        "title": "Расходы",
        "fields": [
          { "name": "expenses.payor", "type": "select", "label": "Кто оплачивает?", "options": ["Залогодатель", "Залогодержатель", "Поровну"] }
        ],
        "next": "registration"
      },

      /* STEP 12 — REGISTRATION */
      {
        "id": "registration",
        "type": "form",
        "title": "Регистрация залога",
        "fields": [
          { "name": "registration.required", "type": "checkbox", "label": "Требуется регистрация" },
          { "name": "registration.number", "type": "text", "label": "Регистрационный номер" },
          { "name": "registration.date", "type": "date", "label": "Дата регистрации" }
        ],
        "next": "representation"
      },

      /* STEP 13 — REPRESENTATION */
      {
        "id": "representation",
        "type": "radio",
        "title": "Как подписывают стороны?",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "next": {
          "personal": "validation",
          "poa": "representation_poa"
        }
      },

      {
        "id": "representation_poa",
        "type": "form",
        "fields": [
          { "name": "poa.registry", "type": "text", "label": "Реестровый №" },
          { "name": "poa.notary", "type": "text", "label": "Нотариус" },
          { "name": "poa.license", "type": "text", "label": "№ лицензии" },
          { "name": "poa.date", "type": "date", "label": "Дата" },
          { "name": "poa.scan", "type": "file", "min": 1, "label": "Скан доверенности" }
        ],
        "next": "validation"
      },

      /* STEP 14 — VALIDATION */
      {
        "id": "validation",
        "type": "validation",
        "rules": [
          "required pledgor.full_name",
          "required pledgor.iin_bin",
          "required objects (>=1)",
          "required for each object: registry_extract",
          "if married or consent_present → require spouse.consent",
          "required loan.amount",
          "required loan.schedule",
          "required default.notice",
          "if registration.required → require registration.number",
          "if representation == poa → require poa.scan"
        ],
        "next": "generate"
      },

      /* STEP 15 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx+pdf"
      }
    ],

    "placeholders": [
      "pledgor",
      "pledgee",
      "objects[]",
      "loan",
      "coverage",
      "default",
      "insurance",
      "expenses",
      "registration",
      "poa"
    ]
  }
},
{
  "id": 30,
  "code": "DOC_030",
  "title": "Договор займа — физлицо ↔ физлицо",
  "category": "Договоры / Займы / Финансы",

  "dev_notes": [
    "Договор займа между двумя физическими лицами.",
    "Займ может быть денежным или вещным (например: телефон, инструмент, техника).",
    "При денежном займе обязательны поля: сумма, валюта, порядок возврата.",
    "При вещном займе обязательны поля: описание предмета, состояние, стоимость (опционально).",
    "Процентность займа: без процентов или с процентами — при выборе процентов обязательно указать ставку.",
    "Срок займа — через селектор Days/Months.",
    "Способ передачи средств: наличными / переводом / иное.",
    "Способ возврата — наличные / перевод / частями / единовременно.",
    "Подписание: лично или по доверенности (если по доверенности — обязательные реквизиты доверенности).",
    "На заимодавца и заемщика обязательные upload-поля — по 2 скана документов.",
    "Генерация — DOCX с подстановкой всех условий, включая проценты и сроки."
  ],

  "rules_for_cursor": [
    "Сканы документов заимодавца и заемщика — обязательные поля: min=2, max=2.",
    "Если выбран тип займа 'деньги' — показывать блок денежных реквизитов.",
    "Если 'вещь' — показывать блок описания предмета.",
    "При выборе 'с процентами' поле процентной ставки становится обязательным.",
    "Срок — обязательный переключатель Days/Months.",
    "Плейсхолдеры: {{creditor}}, {{debtor}}, {{loan_type}}, {{amount}}, {{item}}, {{interest}}, {{term}}, {{transfer_method}}, {{return_method}}, {{signature}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — CREDITOR */
      {
        "id": "creditor",
        "type": "form",
        "title": "Заимодавец",
        "fields": [
          { "name": "creditor.full_name", "type": "text", "label": "ФИО" },
          { "name": "creditor.iin", "type": "text", "label": "ИИН" },
          { "name": "creditor.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "creditor.address", "type": "text", "label": "Адрес регистрации" },
          { "name": "creditor.passport.type", "type": "text", "label": "Документ: тип" },
          { "name": "creditor.passport.number", "type": "text", "label": "Серия / номер" },
          { "name": "creditor.passport.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "creditor.passport.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "creditor.attachments[]",
            "type": "file",
            "label": "Сканы документов заимодавца (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "debtor"
      },

      /* STEP 2 — DEBTOR */
      {
        "id": "debtor",
        "type": "form",
        "title": "Заемщик",
        "fields": [
          { "name": "debtor.full_name", "type": "text", "label": "ФИО" },
          { "name": "debtor.iin", "type": "text", "label": "ИИН" },
          { "name": "debtor.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "debtor.address", "type": "text", "label": "Адрес регистрации" },
          { "name": "debtor.passport.type", "type": "text", "label": "Документ: тип" },
          { "name": "debtor.passport.number", "type": "text", "label": "Серия / номер" },
          { "name": "debtor.passport.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "debtor.passport.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "debtor.attachments[]",
            "type": "file",
            "label": "Сканы документов заемщика (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "loan_type"
      },

      /* STEP 3 — LOAN TYPE */
      {
        "id": "loan_type",
        "type": "radio",
        "title": "Тип займа",
        "options": [
          { "value": "money", "label": "Денежный займ" },
          { "value": "item", "label": "Займ вещи/имущества" }
        ],
        "required": true,
        "next": {
          "money": "money_loan",
          "item": "item_loan"
        }
      },

      /* STEP 4 — MONEY LOAN */
      {
        "id": "money_loan",
        "type": "form",
        "title": "Условия денежного займа",
        "fields": [
          { "name": "money.amount", "type": "number", "label": "Сумма займа" },
          { "name": "money.currency", "type": "select", "label": "Валюта", "options": ["KZT", "USD", "EUR", "RUB"] }
        ],
        "next": "interest"
      },

      /* STEP 5 — ITEM LOAN */
      {
        "id": "item_loan",
        "type": "form",
        "title": "Описание передаваемой вещи",
        "fields": [
          { "name": "item.name", "type": "text", "label": "Предмет" },
          { "name": "item.description", "type": "textarea", "label": "Описание и состояние" },
          { "name": "item.value", "type": "number", "label": "Оценочная стоимость (опц.)" }
        ],
        "next": "interest"
      },

      /* STEP 6 — INTEREST */
      {
        "id": "interest",
        "type": "radio",
        "title": "Процентность займа",
        "options": [
          { "value": "no_interest", "label": "Без процентов" },
          { "value": "with_interest", "label": "С процентами" }
        ],
        "required": true,
        "next": {
          "no_interest": "transfer_method",
          "with_interest": "interest_details"
        }
      },

      {
        "id": "interest_details",
        "type": "form",
        "title": "Процентная ставка",
        "fields": [
          { "name": "interest.rate", "type": "number", "label": "Процентная ставка (% годовых)" },
          { "name": "interest.calc", "type": "textarea", "label": "Порядок начисления процентов" }
        ],
        "next": "transfer_method"
      },

      /* STEP 7 — TRANSFER METHOD */
      {
        "id": "transfer_method",
        "type": "radio",
        "title": "Способ передачи средств/вещи",
        "options": [
          { "value": "cash", "label": "Наличные" },
          { "value": "bank_transfer", "label": "Банковский перевод" },
          { "value": "other", "label": "Иное" }
        ],
        "required": true,
        "next": "return_method"
      },

      /* STEP 8 — RETURN METHOD */
      {
        "id": "return_method",
        "type": "radio",
        "title": "Способ возврата",
        "options": [
          { "value": "cash", "label": "Наличные" },
          { "value": "bank_transfer", "label": "Банковский перевод" },
          { "value": "installments", "label": "Частями" },
          { "value": "one_time", "label": "Единовременно" }
        ],
        "required": true,
        "next": "term"
      },

      /* STEP 9 — TERM */
      {
        "id": "term",
        "type": "radio",
        "title": "Срок займа",
        "options": [
          { "value": "days", "label": "Дни (1–31)" },
          { "value": "months", "label": "Месяцы (1–36)" }
        ],
        "required": true,
        "next": {
          "days": "term_days",
          "months": "term_months"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "label": "Количество дней", "min": 1, "max": 31 }
        ],
        "next": "signature"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "label": "Количество месяцев", "min": 1, "max": 36 }
        ],
        "next": "signature"
      },

      /* STEP 10 — SIGNATURE */
      {
        "id": "signature",
        "type": "radio",
        "title": "Подписание",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "required": true,
        "next": {
          "personal": "validate",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Доверенность заемщика/заимодавца",
        "fields": [
          { "name": "poa.registry", "type": "text", "label": "Реестровый номер" },
          { "name": "poa.issued_by", "type": "text", "label": "Кем выдана" },
          { "name": "poa.date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "poa.scan[]",
            "type": "file",
            "label": "Скан доверенности",
            "min": 1
          }
        ],
        "next": "validate"
      },

      /* STEP 11 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required creditor.attachments",
          "required debtor.attachments",
          "required loan_type",
          "if loan_type == 'money' → require money.amount",
          "if loan_type == 'item' → require item.name",
          "required transfer_method",
          "required return_method",
          "required term",
          "required signature",
          "if signature == 'poa' → require poa.scan"
        ],
        "next": "generate"
      },

      /* STEP 12 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "creditor",
      "debtor",
      "loan_type",
      "money",
      "item",
      "interest",
      "term",
      "transfer_method",
      "return_method",
      "signature"
    ]
  }
},
{
  "id": 31,
  "code": "DOC_031",
  "title": "Договор поручения",
  "category": "Договоры / Представительство / Поручение",

  "dev_notes": [
    "Доверитель — всегда 1, обязателен upload 2 сканов документа.",
    "Поверенных может быть 1 или 2 — на каждого обязательна загрузка 2 сканов.",
    "Предмет поручения определяется чекбоксами, но минимум один пункт обязателен.",
    "Если выбран тип поручения, требующий дополнительных данных (недвижимость, ТС, деньги, документы) — показывать связанные блоки.",
    "Оплата: безвозмездно или возмездно с указанием суммы.",
    "Срок — переключатель Days/Months.",
    "Право передоверия — обязательный radio.",
    "Подписание — лично или по доверенности (если по доверенности — обязательный upload).",
    "Валидация должна блокировать генерацию, если обязательные поля/сканы отсутствуют.",
    "Должен генерироваться массив поручений и связанных данных для шаблона."
  ],

  "rules_for_cursor": [
    "Все upload-поля (сканы) обязательны.",
    "Предмет поручения — checkbox-group (min=1).",
    "Если выбран блок недвижимости/ТС/документов/денег — соответствующие поля становятся обязательными.",
    "Оплата: если возмездно → сумма обязательна.",
    "Плейсхолдеры: {{principal}}, {{agents}}, {{tasks}}, {{object_data}}, {{payment}}, {{term}}, {{delegation}}, {{signature}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — PRINCIPAL */
      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО" },
          { "name": "principal.iin", "type": "text", "label": "ИИН" },
          { "name": "principal.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "principal.address", "type": "text", "label": "Адрес регистрации" },
          { "name": "principal.passport.type", "type": "text", "label": "Документ: тип" },
          { "name": "principal.passport.number", "type": "text", "label": "Серия / номер" },
          { "name": "principal.passport.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.passport.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "principal.attachments[]",
            "type": "file",
            "label": "Сканы доверителя (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "agent_choice"
      },

      /* STEP 2 — AGENT COUNT */
      {
        "id": "agent_choice",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": "1", "label": "1 поверенный" },
          { "value": "2", "label": "2 поверенных" }
        ],
        "required": true,
        "next": {
          "1": "agent1",
          "2": "agent1"
        }
      },

      /* STEP 3 — AGENT 1 */
      {
        "id": "agent1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agent1.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent1.iin", "type": "text", "label": "ИИН" },
          { "name": "agent1.address", "type": "text", "label": "Адрес" },
          { "name": "agent1.passport.type", "type": "text", "label": "Документ: тип" },
          { "name": "agent1.passport.number", "type": "text", "label": "Серия / номер" },
          { "name": "agent1.passport.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent1.passport.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "agent1.attachments[]",
            "type": "file",
            "label": "Сканы поверенного 1 (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "agent2_cond"
      },

      /* STEP 4 — OPTIONAL AGENT 2 */
      {
        "id": "agent2_cond",
        "type": "condition",
        "expression": "agent_choice == '2'",
        "next_if_true": "agent2",
        "next_if_false": "task_selection"
      },

      {
        "id": "agent2",
        "type": "form",
        "title": "Поверенный 2",
        "fields": [
          { "name": "agent2.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent2.iin", "type": "text", "label": "ИИН" },
          { "name": "agent2.address", "type": "text", "label": "Адрес" },
          { "name": "agent2.passport.type", "type": "text", "label": "Документ: тип" },
          { "name": "agent2.passport.number", "type": "text", "label": "Серия / номер" },
          { "name": "agent2.passport.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "agent2.passport.issued_date", "type": "date", "label": "Дата выдачи" },
          {
            "name": "agent2.attachments[]",
            "type": "file",
            "label": "Сканы поверенного 2 (2 файла)",
            "min": 2,
            "max": 2
          }
        ],
        "next": "task_selection"
      },

      /* STEP 5 — TASK SELECTION */
      {
        "id": "task_selection",
        "type": "checkbox-group",
        "title": "Предмет поручения",
        "has_select_all": true,
        "options": [
          { "value": "documents", "label": "Получение и подписание документов" },
          { "value": "money", "label": "Получение денежных средств" },
          { "value": "property", "label": "Действия с недвижимостью" },
          { "value": "transport", "label": "Действия с транспортным средством" },
          { "value": "legal", "label": "Представление интересов" },
          { "value": "other", "label": "Иное" }
        ],
        "min": 1,
        "next": "task_details"
      },

      /* STEP 6 — TASK DETAILS */
      {
        "id": "task_details",
        "type": "dynamic-task-details",
        "title": "Детализация поручения",
        "blocks": {
          "documents": [
            { "name": "docs.list", "type": "textarea", "label": "Какие документы" }
          ],
          "money": [
            { "name": "money.amount", "type": "text", "label": "Сумма / ограничение" },
            { "name": "money.currency", "type": "select", "options": ["KZT","USD","EUR","RUB"], "label": "Валюта" }
          ],
          "property": [
            { "name": "property.address", "type": "text", "label": "Адрес/объект" },
            { "name": "property.cadastral", "type": "text", "label": "Кадастровый номер" }
          ],
          "transport": [
            { "name": "car.vin", "type": "text", "label": "VIN" },
            { "name": "car.gov_number", "type": "text", "label": "Гос. номер" }
          ],
          "legal": [
            { "name": "legal.scope", "type": "textarea", "label": "Объём прав" }
          ],
          "other": [
            { "name": "other.text", "type": "textarea", "label": "Описание поручения" }
          ]
        },
        "next": "payment"
      },

      /* STEP 7 — PAYMENT */
      {
        "id": "payment",
        "type": "radio",
        "title": "Оплата",
        "options": [
          { "value": "free", "label": "Безвозмездно" },
          { "value": "paid", "label": "Возмездно" }
        ],
        "next": {
          "free": "term",
          "paid": "payment_details"
        }
      },

      {
        "id": "payment_details",
        "type": "form",
        "title": "Условия оплаты",
        "fields": [
          { "name": "payment.amount", "type": "text", "label": "Сумма" },
          { "name": "payment.currency", "type": "select", "options": ["KZT","USD","EUR","RUB"], "label": "Валюта" },
          { "name": "payment.schedule", "type": "textarea", "label": "Порядок оплаты" }
        ],
        "next": "term"
      },

      /* STEP 8 — TERM */
      {
        "id": "term",
        "type": "radio",
        "title": "Срок договора",
        "options": [
          { "value": "days", "label": "Дни (1–31)" },
          { "value": "months", "label": "Месяцы (1–36)" }
        ],
        "required": true,
        "next": {
          "days": "term_days",
          "months": "term_months"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "min": 1, "max": 31, "label": "Количество дней" }
        ],
        "next": "delegation"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "min": 1, "max": 36, "label": "Количество месяцев" }
        ],
        "next": "delegation"
      },

      /* STEP 9 — DELEGATION */
      {
        "id": "delegation",
        "type": "radio",
        "title": "Право передоверия",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "required": true,
        "next": "signature"
      },

      /* STEP 10 — SIGNATURE */
      {
        "id": "signature",
        "type": "radio",
        "title": "Подписание",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "required": true,
        "next": {
          "personal": "validate",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.registry", "type": "text", "label": "Реестровый номер" },
          { "name": "poa.issued_by", "type": "text", "label": "Кем выдана" },
          { "name": "poa.date", "type": "date", "label": "Дата выдачи" },
          { "name": "poa.scan[]", "type": "file", "label": "Скан доверенности", "min": 1 }
        ],
        "next": "validate"
      },

      /* STEP 11 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required principal.attachments",
          "required agent1.attachments",
          "if agent_choice == '2' → require agent2.attachments",
          "required task_selection (>=1)",
          "required delegation",
          "required term",
          "if signature == 'poa' → require poa.scan"
        ],
        "next": "generate"
      },

      /* STEP 12 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal",
      "agents[]",
      "tasks",
      "object_data",
      "payment",
      "term",
      "delegation",
      "signature"
    ]
  }
},
{
  "id": 32,
  "code": "DOC_032",
  "title": "Договор уступки прав (цессия)",
  "category": "Договоры / Передача прав / Цессия",

  "dev_notes": [
    "Исходный договор — обязателен. Без upload дальнейшие шаги запрещены.",
    "Если уступка запрещена условиями договора — остановить процесс.",
    "Если требуется согласие третьей стороны — оно обязательно и должно быть uploaded.",
    "Цена уступки: сумма или отметка 'безвозмездно'.",
    "Объём уступаемых прав обязательно указывается: полный/частичный.",
    "Система должна генерировать Акт передачи документов.",
    "Уведомление должника должно формироваться автоматически, если выбран вариант уведомления.",
    "Если подписание по доверенности — реквизиты и скан обязательны.",
    "Валидация блокирует генерацию, если отсутствуют обязательные документы, суммы, реквизиты."
  ],

  "rules_for_cursor": [
    "Запретить движение дальше без upload исходного договора.",
    "Если CHECK_ASSIGNABILITY == 'запрещена' → выводим ошибку и стоп.",
    "Если требуется согласие — поле consent_upload[] обязательно.",
    "Цена уступки: если FREE = true → скрыть сумму; иначе сумма обязательна.",
    "Документы, передаваемые цессионарию, должны формировать массив transfer_docs[].",
    "Если уведомление должника = yes → сформировать форму уведомления и плейсхолдеры.",
    "Если представительство по доверенности → требовать poa.registry, poa.date, poa.scan.",
    "Плейсхолдеры: {{cedent}}, {{cessionary}}, {{base_contract}}, {{rights}}, {{price}}, {{debt_data}}, {{transfer_docs}}, {{notifications}}, {{limitations}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — META */
      {
        "id": "meta",
        "type": "form",
        "title": "Метаданные",
        "fields": [
          { "name": "meta.contract_id", "type": "text", "label": "ID договора" },
          { "name": "meta.date", "type": "date", "label": "Дата" },
          { "name": "meta.place", "type": "text", "label": "Место составления" },
          { "name": "meta.right_type", "type": "text", "label": "Тип уступаемых прав" }
        ],
        "next": "rights_type"
      },

      /* STEP 2 — RIGHTS TYPE */
      {
        "id": "rights_type",
        "type": "checkbox-group",
        "title": "Тип уступаемых прав",
        "options": [
          { "value": "loan", "label": "Права требования по займу / расписке" },
          { "value": "sale_contract", "label": "Права по договору купли-продажи" },
          { "value": "ddu", "label": "Права по договору долевого участия (ДДУ)" },
          { "value": "lease", "label": "Права арендатора / субарендатора" },
          { "value": "money", "label": "Права на получение денежных средств" },
          { "value": "other", "label": "Иное" }
        ],
        "min": 1,
        "next": "parties"
      },

      /* STEP 3 — PARTIES */
      {
        "id": "parties",
        "type": "form",
        "title": "Стороны сделки",
        "fields": [
          { "name": "cedent.full_name", "type": "text", "label": "ФИО Цедента" },
          { "name": "cedent.iin", "type": "text", "label": "ИИН" },
          { "name": "cedent.passport", "type": "text", "label": "Паспорт" },
          { "name": "cedent.address", "type": "text", "label": "Адрес" },

          { "name": "cessionary.full_name", "type": "text", "label": "ФИО Цессионария" },
          { "name": "cessionary.iin", "type": "text", "label": "ИИН" },
          { "name": "cessionary.passport", "type": "text", "label": "Паспорт" },
          { "name": "cessionary.address", "type": "text", "label": "Адрес" }
        ],
        "next": "capacity"
      },

      /* STEP 4 — CAPACITY */
      {
        "id": "capacity",
        "type": "radio",
        "title": "Дееспособность сторон",
        "options": [
          { "value": "ok", "label": "Обе стороны дееспособны" },
          { "value": "issue", "label": "Требуется документ опеки/суд" }
        ],
        "required": true,
        "next": {
          "ok": "base_contract",
          "issue": "capacity_docs"
        }
      },

      {
        "id": "capacity_docs",
        "type": "form",
        "title": "Документы для подтверждения",
        "fields": [
          { "name": "capacity.docs[]", "type": "file", "label": "Upload документа", "min": 1 }
        ],
        "next": "base_contract"
      },

      /* STEP 5 — BASE CONTRACT */
      {
        "id": "base_contract",
        "type": "form",
        "title": "Исходный договор (обязательно)",
        "fields": [
          { "name": "base.type", "type": "text", "label": "Тип договора" },
          { "name": "base.number", "type": "text", "label": "Номер" },
          { "name": "base.date", "type": "date", "label": "Дата" },
          { "name": "base.parties", "type": "text", "label": "Стороны" },
          { "name": "base.registry", "type": "text", "label": "Реестровый №" },
          { "name": "base.upload[]", "type": "file", "label": "Upload исходного договора", "min": 1 }
        ],
        "next": "check_assignability"
      },

      /* STEP 6 — ASSIGNABILITY CHECK */
      {
        "id": "check_assignability",
        "type": "condition",
        "expression": "contract prohibits assignment",
        "next_if_true": "assign_block",
        "next_if_false": "consents"
      },

      {
        "id": "assign_block",
        "type": "error",
        "title": "Уступка невозможна",
        "message": "Исходный договор содержит запрет на уступку прав.",
        "next": "end"
      },

      /* STEP 7 — CONSENTS */
      {
        "id": "consents",
        "type": "radio",
        "title": "Требуется согласие третьей стороны?",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "next": {
          "yes": "consent_upload",
          "no": "price"
        }
      },

      {
        "id": "consent_upload",
        "type": "form",
        "title": "Загрузка согласия",
        "fields": [
          { "name": "consent.entity", "type": "text", "label": "Кем выдано согласие" },
          { "name": "consent.date", "type": "date", "label": "Дата" },
          { "name": "consent.file[]", "type": "file", "label": "Upload согласия", "min": 1 }
        ],
        "next": "price"
      },

      /* STEP 8 — PRICE */
      {
        "id": "price",
        "type": "form",
        "title": "Цена уступки",
        "fields": [
          { "name": "price.is_free", "type": "checkbox", "label": "Безвозмездно" },
          { "name": "price.amount", "type": "text", "label": "Сумма (если не безвозмездно)" },
          { "name": "price.currency", "type": "select", "label": "Валюта", "options": ["KZT","USD","EUR","RUB"] },
          { "name": "price.schedule", "type": "text", "label": "Порядок оплаты" }
        ],
        "next": "debt"
      },

      /* STEP 9 — DEBT DATA */
      {
        "id": "debt",
        "type": "form",
        "title": "Сумма требования",
        "fields": [
          { "name": "debt.total", "type": "text", "label": "Общая сумма обязательства" },
          { "name": "debt.remaining", "type": "text", "label": "Остаток долга" },
          { "name": "debt.full_or_partial", "type": "select", "label": "Полностью / частично", "options": ["full","partial"] },
          { "name": "debt.date", "type": "date", "label": "Дата актуальности расчета" }
        ],
        "next": "transfer_docs"
      },

      /* STEP 10 — DOCUMENT TRANSFER */
      {
        "id": "transfer_docs",
        "type": "checkbox-group",
        "title": "Передаваемые документы",
        "options": [
          { "value": "original_contract", "label": "Оригинал договора" },
          { "value": "receipts", "label": "Расписки" },
          { "value": "payment_schedule", "label": "Графики платежей" },
          { "value": "add_agreements", "label": "Дополнительные соглашения" },
          { "value": "correspondence", "label": "Переписка" },
          { "value": "court_docs", "label": "Судебные документы" }
        ],
        "extra_fields": [
          { "name": "transfer.upload[]", "type": "file", "label": "Upload документов" }
        ],
        "next": "notify_debtor"
      },

      /* STEP 11 — NOTIFY DEBTOR */
      {
        "id": "notify_debtor",
        "type": "radio",
        "title": "Уведомлять должника?",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "next": {
          "yes": "notify_fields",
          "no": "limitations"
        }
      },

      {
        "id": "notify_fields",
        "type": "form",
        "title": "Уведомление должника",
        "fields": [
          { "name": "notify.name", "type": "text", "label": "ФИО должника" },
          { "name": "notify.address", "type": "text", "label": "Адрес" },
          { "name": "notify.method", "type": "select", "label": "Способ уведомления", "options": ["лично","почтой","электронно"] },
          { "name": "notify.date", "type": "date", "label": "Срок уведомления" }
        ],
        "next": "limitations"
      },

      /* STEP 12 — LIMITATIONS */
      {
        "id": "limitations",
        "type": "checkbox-group",
        "title": "Ограничения уступаемых прав",
        "options": [
          { "value": "penalties", "label": "Переходят ли пени/штрафы" },
          { "value": "pledge", "label": "Переходит ли залог" },
          { "value": "court_actions", "label": "Переходят ли судебные права" }
        ],
        "extra_fields": [
          { "name": "limitations.other", "type": "textarea", "label": "Иное" }
        ],
        "next": "representation"
      },

      /* STEP 13 — REPRESENTATION */
      {
        "id": "representation",
        "type": "radio",
        "title": "Подписание",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "next": {
          "personal": "validate",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.registry", "type": "text", "label": "Реестровый №" },
          { "name": "poa.issued_by", "type": "text", "label": "Кем выдана" },
          { "name": "poa.date", "type": "date", "label": "Дата" },
          { "name": "poa.scan[]", "type": "file", "label": "Скан доверенности", "min": 1 }
        ],
        "next": "validate"
      },

      /* STEP 14 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required base.upload",
          "required price.amount unless price.is_free == true",
          "required debt.total",
          "if notify_debtor == yes → require notify.name",
          "if representation == poa → require poa.scan"
        ],
        "next": "generate"
      },

      /* STEP 15 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "cedent",
      "cessionary",
      "base_contract",
      "price",
      "debt_data",
      "documentation",
      "notifications",
      "limitations"
    ]
  }
},
{
  "id": 33,
  "code": "DOC_033",
  "title": "Договор раздела имущества",
  "category": "Договоры / Семейное право / Раздел имущества",

  "dev_notes": [
    "Документ должен учитывать три статуса: брак, развод, фактическое сожительство.",
    "Если в браке — обязателен upload свидетельства о браке.",
    "Если в разводе — обязателен upload свидетельства о разводе или решения суда.",
    "Если пара не состояла в браке — система показывает предупреждение и требует документы на собственность.",
    "Система должна поддерживать множественный выбор объектов имущества: недвижимость, ТС, счета, доли, деньги, иное.",
    "Каждый объект создаётся как карточка с обязательными полями и uploaded документами.",
    "Для каждого объекта проверяется принадлежность: совместно нажитое или личное.",
    "Если имущество личное (дарение или наследство), оно исключается из раздела, но может быть добавлено по соглашению.",
    "Компенсация обязательна, если доли не равные.",
    "При ипотеке — опция загрузки согласия банка.",
    "Валидация должна строго блокировать документ, если: не распределены доли, нет документов на имущество, неверно указана компенсация, отсутствуют реквизиты доверенности при подписании по доверенности."
  ],

  "rules_for_cursor": [
    "Шаг 1 — статус: брак / развод / не состояли.",
    "Если брак — требовать свидетельство о браке.",
    "Если развод — требовать документ о разводе.",
    "Если никогда не состояли — показывать предупреждение + требовать документы на право собственности.",
    "Список имущества — динамический массив карточек.",
    "Каждая карточка имущества должна иметь обязательный upload документов.",
    "Если объект совместный — открыть выбор способа раздела.",
    "Если объект личный — по умолчанию не делится.",
    "Компенсация обязательна при неравных долях.",
    "Подписание может быть личное или по доверенности.",
    "Если по доверенности — требовать все реквизиты доверенности.",
    "Плейсхолдеры: {{parties}}, {{marital_status}}, {{property_list}}, {{division}}, {{compensation}}, {{claims}}, {{signing}}, {{attachments}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — MARITAL STATUS */
      {
        "id": "status",
        "type": "radio",
        "title": "Статус отношений",
        "required": true,
        "options": [
          { "value": "married", "label": "Состоят в браке" },
          { "value": "divorced", "label": "В разводе" },
          { "value": "civil", "label": "Сожительство без брака" }
        ],
        "next": "status_branch"
      },

      {
        "id": "status_branch",
        "type": "condition",
        "expression": "status",
        "next_map": {
          "married": "marriage_doc",
          "divorced": "divorce_doc",
          "civil": "civil_warn"
        }
      },

      /* STEP 2A — MARRIAGE DOC */
      {
        "id": "marriage_doc",
        "type": "form",
        "title": "Документ о браке",
        "fields": [
          {
            "name": "marriage.certificate[]",
            "type": "file",
            "label": "Свидетельство о браке",
            "min": 1
          }
        ],
        "next": "parties"
      },

      /* STEP 2B — DIVORCE DOC */
      {
        "id": "divorce_doc",
        "type": "form",
        "title": "Документ о разводе",
        "fields": [
          {
            "name": "divorce.certificate[]",
            "type": "file",
            "label": "Свидетельство о разводе / решение суда",
            "min": 1
          }
        ],
        "next": "parties"
      },

      /* STEP 2C — CIVIL WARNING */
      {
        "id": "civil_warn",
        "type": "static",
        "title": "Предупреждение",
        "text": "Раздел имущества возможен только для объектов, находящихся в совместной доле. Требуются документы на собственность.",
        "next": "parties"
      },

      /* STEP 3 — PARTIES */
      {
        "id": "parties",
        "type": "form",
        "title": "Стороны",
        "fields": [
          { "name": "party1.full_name", "type": "text", "label": "ФИО Сторона 1" },
          { "name": "party1.iin", "type": "text", "label": "ИИН" },
          { "name": "party1.passport", "type": "text", "label": "Паспорт" },

          { "name": "party2.full_name", "type": "text", "label": "ФИО Сторона 2" },
          { "name": "party2.iin", "type": "text", "label": "ИИН" },
          { "name": "party2.passport", "type": "text", "label": "Паспорт" }
        ],
        "next": "property_categories"
      },

      /* STEP 4 — PROPERTY CATEGORIES */
      {
        "id": "property_categories",
        "type": "checkbox-group",
        "title": "Выберите категории имущества",
        "options": [
          { "value": "real_estate", "label": "Недвижимость" },
          { "value": "vehicles", "label": "Транспорт" },
          { "value": "bank_accounts", "label": "Банковские счета" },
          { "value": "business_shares", "label": "Доли в ТОО" },
          { "value": "money", "label": "Денежные средства" },
          { "value": "other", "label": "Иное имущество" }
        ],
        "min": 1,
        "next": "property_items"
      },

      /* STEP 5 — PROPERTY ITEMS */
      {
        "id": "property_items",
        "type": "array",
        "title": "Перечень имущества",
        "item_title": "Объект имущества",
        "fields": [
          { "name": "item.type", "type": "select", "label": "Тип", "options": ["Недвижимость", "ТС", "Счёт", "Доля", "Деньги", "Иное"] },
          { "name": "item.description", "type": "textarea", "label": "Описание объекта" },
          { "name": "item.value", "type": "number", "label": "Оценочная стоимость" },
          {
            "name": "item.docs[]",
            "type": "file",
            "label": "Документы на объект",
            "min": 1
          }
        ],
        "next": "ownership_check"
      },

      /* STEP 6 — OWNERSHIP CHECK */
      {
        "id": "ownership_check",
        "type": "radio",
        "title": "Тип собственности",
        "required": true,
        "options": [
          { "value": "joint", "label": "Совместно нажитое" },
          { "value": "personal", "label": "Личное имущество" }
        ],
        "next": "division_method"
      },

      /* STEP 7 — DIVISION METHOD */
      {
        "id": "division_method",
        "type": "radio",
        "title": "Способ раздела",
        "options": [
          { "value": "equal", "label": "Поровну (50/50)" },
          { "value": "custom", "label": "В иных долях" },
          { "value": "one_side", "label": "Одной стороне (с компенсацией/без)" }
        ],
        "next": {
          "equal": "claims",
          "custom": "custom_partition",
          "one_side": "compensation"
        }
      },

      {
        "id": "custom_partition",
        "type": "form",
        "title": "Укажите доли",
        "fields": [
          { "name": "division.party1_percent", "type": "number", "label": "% Сторона 1" },
          { "name": "division.party2_percent", "type": "number", "label": "% Сторона 2" }
        ],
        "next": "claims"
      },

      {
        "id": "compensation",
        "type": "form",
        "title": "Компенсация",
        "fields": [
          { "name": "comp.amount", "type": "number", "label": "Сумма компенсации" },
          { "name": "comp.deadline", "type": "date", "label": "Срок выплаты" }
        ],
        "next": "claims"
      },

      /* STEP 8 — CLAIMS */
      {
        "id": "claims",
        "type": "radio",
        "title": "Взаимные претензии",
        "options": [
          { "value": "no", "label": "Стороны не имеют взаимных претензий" },
          { "value": "yes", "label": "Есть претензии" }
        ],
        "next": {
          "no": "representation",
          "yes": "claims_details"
        }
      },

      {
        "id": "claims_details",
        "type": "textarea",
        "title": "Описание претензий",
        "next": "representation"
      },

      /* STEP 9 — SIGNING */
      {
        "id": "representation",
        "type": "radio",
        "title": "Способ подписания",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "next": {
          "personal": "validate",
          "poa": "poa_details"
        }
      },

      {
        "id": "poa_details",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.registry", "type": "text", "label": "Реестровый №" },
          { "name": "poa.issued_by", "type": "text", "label": "Кем выдана" },
          { "name": "poa.issue_date", "type": "date", "label": "Дата" },
          {
            "name": "poa.scan[]",
            "type": "file",
            "label": "Скан доверенности",
            "min": 1
          }
        ],
        "next": "validate"
      },

      /* STEP 10 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required party1.full_name",
          "required party2.full_name",
          "required property_items",
          "required item.docs",
          "if division_method == custom → require division.party1_percent",
          "if division_method == one_side → require comp.amount",
          "if representation == poa → require poa.scan"
        ],
        "next": "generate"
      },

      /* STEP 11 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "parties",
      "marital_status",
      "property_list",
      "division",
      "compensation",
      "claims",
      "attachments"
    ]
  }
},
{
  "id": 34,
  "code": "DOC_034",
  "title": "Договор доверительного управления имуществом",
  "category": "Договоры / Управление имуществом",

  "dev_notes": [
    "Форма имеет сложную структуру: 19 логических этапов.",
    "Типы имущества выбираются чекбоксами, каждый показывает отдельный блок обязательных полей.",
    "Если выгодоприобретатель — ребёнок, требуется upload разрешения органов опеки.",
    "Если имущество — доля в ТОО, обязательны учредительные документы.",
    "Недвижимость требует выписку о праве собственности.",
    "ТС требует VIN и техпаспорт.",
    "Акт приёма-передачи создаётся только если имущество фактически передаётся.",
    "Передоверие — обязательная развилка.",
    "VALIDATION должна блокировать генерацию при отсутствии ключевых данных и сканов."
  ],

  "rules_for_cursor": [
    "beneficiary.type управляет показом блока BENEFICIARY_CHILD.",
    "Имущество — checkbox-group (min=1).",
    "Для каждого выбранного типа имущества показывается блок PROPERTY_DETAILS[] с разными полями.",
    "Если выбран real_estate → обязательные: адрес, кадастр, выписка.",
    "Если выбран vehicle → обязательные: марка, VIN, техпаспорт.",
    "Если выбран business → обязательные: название ТОО, БИН, доля, документы.",
    "Если выбран securities → обязательные: тип, количество, реестр.",
    "Если выбран child → upload разрешения ООП обязателен.",
    "Право передоверия — radio.",
    "Генерация запрещена, пока не заполнены все необходимые документы."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — META */
      {
        "id": "meta",
        "type": "form",
        "title": "Метаданные",
        "fields": [
          { "name": "meta.doc_id", "type": "text", "label": "ID документа" },
          { "name": "meta.date", "type": "date", "label": "Дата составления" },
          { "name": "meta.place", "type": "text", "label": "Место составления" },
          { "name": "meta.category", "type": "text", "label": "Категория имущества" }
        ],
        "next": "parties"
      },

      /* STEP 2 — PARTIES */
      {
        "id": "parties",
        "type": "form",
        "title": "Стороны договора",
        "fields": [
          { "name": "founder.full_name", "type": "text", "label": "ФИО учредителя" },
          { "name": "founder.iin", "type": "text", "label": "ИИН" },
          { "name": "founder.address", "type": "text", "label": "Адрес регистрации" },
          { "name": "founder.passport.type", "type": "text", "label": "Документ: тип" },
          { "name": "founder.passport.number", "type": "text", "label": "Серия / номер" },
          { "name": "founder.passport.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "founder.passport.issued_date", "type": "date", "label": "Дата выдачи" },

          { "name": "manager.full_name", "type": "text", "label": "ФИО управляющего" },
          { "name": "manager.iin", "type": "text", "label": "ИИН управляющего" },
          { "name": "manager.address", "type": "text", "label": "Адрес управляющего" },
          { "name": "manager.passport.type", "type": "text", "label": "Документ: тип" },
          { "name": "manager.passport.number", "type": "text", "label": "Серия / номер" },
          { "name": "manager.passport.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "manager.passport.issued_date", "type": "date", "label": "Дата выдачи" }
        ],
        "next": "capacity"
      },

      /* STEP 3 — CAPACITY */
      {
        "id": "capacity",
        "type": "form",
        "title": "Проверка дееспособности",
        "fields": [
          { "name": "capacity.is_adult", "type": "radio", "label": "Совершеннолетний", "options": ["yes","no"] },
          { "name": "capacity.no_court_limits", "type": "radio", "label": "Не ограничен судом", "options": ["yes","no"] },
          { "name": "capacity.docs[]", "type": "file", "label": "Документ опеки/попечительства", "min": 0, "max": 3 }
        ],
        "next": "beneficiary"
      },

      /* STEP 4 — BENEFICIARY CHOICE */
      {
        "id": "beneficiary",
        "type": "radio",
        "title": "Кто является выгодоприобретателем?",
        "options": [
          { "value": "self", "label": "Учредитель" },
          { "value": "other", "label": "Иное лицо" }
        ],
        "required": true,
        "next": {
          "self": "property",
          "other": "beneficiary_other"
        }
      },

      /* STEP 5 — BENEFICIARY OTHER */
      {
        "id": "beneficiary_other",
        "type": "form",
        "title": "Данные выгодоприобретателя",
        "fields": [
          { "name": "beneficiary.full_name", "type": "text", "label": "ФИО" },
          { "name": "beneficiary.iin", "type": "text", "label": "ИИН" },
          { "name": "beneficiary.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "beneficiary.oo_permission[]", "type": "file", "label": "Разрешение органов опеки", "min": 0, "max": 3 }
        ],
        "next": "property"
      },

      /* STEP 6 — PROPERTY TYPE SELECTION */
      {
        "id": "property",
        "type": "checkbox-group",
        "title": "Выберите типы имущества",
        "has_select_all": true,
        "min": 1,
        "options": [
          { "value": "real_estate", "label": "Недвижимость" },
          { "value": "vehicle", "label": "Транспорт" },
          { "value": "accounts", "label": "Банковские счета" },
          { "value": "business", "label": "Доля в ТОО / бизнес" },
          { "value": "securities", "label": "Ценные бумаги" },
          { "value": "other", "label": "Иное имущество" }
        ],
        "next": "property_details"
      },

      /* STEP 7 — PROPERTY DETAILS (repeatable block) */
      {
        "id": "property_details",
        "type": "dynamic-task-details",
        "title": "Детализация имущества",
        "repeatable": true,
        "blocks": {
          "real_estate": [
            { "name": "item.address", "type": "text", "label": "Адрес" },
            { "name": "item.kadastr", "type": "text", "label": "Кадастровый номер" },
            { "name": "item.right_doc[]", "type": "file", "label": "Выписка / документ права", "min": 1 }
          ],
          "vehicle": [
            { "name": "item.brand", "type": "text", "label": "Марка" },
            { "name": "item.vin", "type": "text", "label": "VIN" },
            { "name": "item.techpass[]", "type": "file", "label": "Техпаспорт", "min": 1 }
          ],
          "accounts": [
            { "name": "item.bank", "type": "text", "label": "Банк" },
            { "name": "item.number", "type": "text", "label": "Номер счета" },
            { "name": "item.currency", "type": "text", "label": "Валюта" }
          ],
          "business": [
            { "name": "item.name", "type": "text", "label": "Название ТОО" },
            { "name": "item.bin", "type": "text", "label": "БИН" },
            { "name": "item.share", "type": "text", "label": "Доля (%)" },
            { "name": "item.docs[]", "type": "file", "label": "Учредительные документы", "min": 1 }
          ],
          "securities": [
            { "name": "item.type", "type": "text", "label": "Тип ЦБ" },
            { "name": "item.qty", "type": "number", "label": "Количество" },
            { "name": "item.registry", "type": "text", "label": "Запись в реестре" }
          ],
          "other": [
            { "name": "item.desc", "type": "textarea", "label": "Описание имущества" },
            { "name": "item.docs[]", "type": "file", "label": "Документы", "min": 0 }
          ]
        },
        "next": "ownership"
      },

      /* STEP 8 — OWNERSHIP */
      {
        "id": "ownership",
        "type": "form",
        "title": "Подтверждение собственности",
        "fields": [
          { "name": "ownership.doc[]", "type": "file", "label": "Документ права собственности", "min": 1 },
          { "name": "ownership.acquisition", "type": "textarea", "label": "Реквизиты приобретения" },
          { "name": "ownership.restrictions", "type": "textarea", "label": "Обременения / ограничения" }
        ],
        "next": "limitations"
      },

      /* STEP 9 — LIMITATIONS */
      {
        "id": "limitations",
        "type": "checkbox-group",
        "title": "Ограничения учредителя",
        "options": [
          { "value": "no_sale", "label": "Запрет отчуждения" },
          { "value": "no_rent", "label": "Запрет сдачи в аренду" },
          { "value": "no_pledge", "label": "Запрет залога" },
          { "value": "no_transfer", "label": "Запрет передачи третьим лицам" },
          { "value": "manage_income", "label": "Управление доходами" },
          { "value": "custom", "label": "Иное" }
        ],
        "next": "rights"
      },

      /* STEP 10 — RIGHTS */
      {
        "id": "rights",
        "type": "checkbox-group",
        "title": "Права управляющего",
        "has_select_all": true,
        "options": [
          { "value": "deals", "label": "Заключать сделки" },
          { "value": "rent", "label": "Сдавать в аренду" },
          { "value": "income", "label": "Получать доходы" },
          { "value": "accounts", "label": "Открывать счета" },
          { "value": "maintenance", "label": "Обслуживание имущества" },
          { "value": "taxes", "label": "Оплачивать налоги" },
          { "value": "insurance", "label": "Страхование" },
          { "value": "state_rep", "label": "Представлять интересы" },
          { "value": "other", "label": "Иные действия" }
        ],
        "next": "reporting"
      },

      /* STEP 11 — REPORTING */
      {
        "id": "reporting",
        "type": "form",
        "title": "Отчётность управляющего",
        "fields": [
          { "name": "report.periodicity", "type": "text", "label": "Периодичность" },
          { "name": "report.format", "type": "text", "label": "Форма отчёта" },
          { "name": "report.docs_required", "type": "checkbox", "label": "Требуются подтверждающие документы?" },
          { "name": "report.delivery", "type": "text", "label": "Способ передачи" }
        ],
        "next": "income"
      },

      /* STEP 12 — INCOME */
      {
        "id": "income",
        "type": "form",
        "title": "Доходы от имущества",
        "fields": [
          { "name": "income.to_beneficiary", "type": "checkbox", "label": "Доход передаётся выгодоприобретателю" },
          { "name": "income.expense_allowed", "type": "checkbox", "label": "Разрешено удерживать расходы управляющего" },
          { "name": "income.rules", "type": "textarea", "label": "Правила расходования" },
          { "name": "income.reinvest", "type": "checkbox", "label": "Реинвестирование доходов" }
        ],
        "next": "payment"
      },

      /* STEP 13 — PAYMENT */
      {
        "id": "payment",
        "type": "radio",
        "title": "Вознаграждение управляющего",
        "options": [
          { "value": "free", "label": "Безвозмездно" },
          { "value": "paid", "label": "Возмездно" }
        ],
        "required": true,
        "next": {
          "free": "term",
          "paid": "payment_details"
        }
      },

      {
        "id": "payment_details",
        "type": "form",
        "title": "Условия оплаты",
        "fields": [
          { "name": "payment.amount", "type": "text", "label": "Сумма" },
          { "name": "payment.currency", "type": "text", "label": "Валюта" },
          { "name": "payment.schedule", "type": "textarea", "label": "График выплат" }
        ],
        "next": "term"
      },

      /* STEP 14 — TERM */
      {
        "id": "term",
        "type": "form",
        "title": "Срок доверительного управления",
        "fields": [
          { "name": "term.start", "type": "date", "label": "Дата начала" },
          { "name": "term.end", "type": "date", "label": "Дата окончания" },
          { "name": "term.goal", "type": "text", "label": "До достижения цели (если применимо)" },
          { "name": "term.indefinite", "type": "checkbox", "label": "Бессрочно" }
        ],
        "next": "delegation"
      },

      /* STEP 15 — DELEGATION */
      {
        "id": "delegation",
        "type": "radio",
        "title": "Право передоверия",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "required": true,
        "next": {
          "yes": "delegation_details",
          "no": "transfer_act"
        }
      },

      {
        "id": "delegation_details",
        "type": "form",
        "title": "Условия передоверия",
        "fields": [
          { "name": "delegation.conditions", "type": "textarea", "label": "Условия передоверия" },
          { "name": "delegation.notice", "type": "text", "label": "Уведомление учредителя" }
        ],
        "next": "transfer_act"
      },

      /* STEP 16 — TRANSFER ACT */
      {
        "id": "transfer_act",
        "type": "radio",
        "title": "Передаётся ли имущество фактически?",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "next": {
          "yes": "transfer_details",
          "no": "signature"
        }
      },

      {
        "id": "transfer_details",
        "type": "form",
        "title": "Акт приёма-передачи",
        "fields": [
          { "name": "transfer.items", "type": "textarea", "label": "Перечень имущества" },
          { "name": "transfer.state", "type": "textarea", "label": "Состояние" },
          { "name": "transfer.serials", "type": "textarea", "label": "Серийные номера" },
          { "name": "transfer.photos[]", "type": "file", "label": "Фото имущества", "min": 0 }
        ],
        "next": "signature"
      },

      /* STEP 17 — SIGNATURE */
      {
        "id": "signature",
        "type": "radio",
        "title": "Подписание",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "required": true,
        "next": {
          "personal": "validate",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Доверенность",
        "fields": [
          { "name": "poa.number", "type": "text", "label": "Реестровый номер" },
          { "name": "poa.notary", "type": "text", "label": "Нотариус" },
          { "name": "poa.date", "type": "date", "label": "Дата выдачи" },
          { "name": "poa.scan[]", "type": "file", "label": "Скан доверенности", "min": 1 }
        ],
        "next": "validate"
      },

      /* STEP 18 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required property (>=1)",
          "required rights",
          "required term",
          "if delegation == 'yes' → required delegation.conditions",
          "if signature == 'poa' → required poa.scan",
          "required ownership.doc"
        ],
        "next": "generate"
      },

      /* STEP 19 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "meta",
      "founder",
      "manager",
      "beneficiary",
      "property[]",
      "ownership",
      "limitations",
      "rights",
      "report",
      "income",
      "payment",
      "term",
      "delegation",
      "transfer",
      "signature"
    ]
  }
},
{
  "id": 35,
  "code": "DOC_035",
  "title": "Доверенность на получение корреспонденции / почтовых отправлений",
  "category": "Доверенности / Почта и отправления",

  "dev_notes": [
    "Поверенных может быть 1 или 2 — каждый блок обязателен к заполнению.",
    "Все паспортные данные обязательны.",
    "Виды отправлений — checkbox-group с min=1, рекомендуется кнопка 'Выбрать всё'.",
    "Если выбрано 'конкретное отделение' — адрес обязателен.",
    "Если доверитель действует по доверенности — обязательны реквизиты и upload.",
    "Срок: дни / месяцы / конкретная дата.",
    "VALIDATION должна блокировать генерацию при отсутствии ключевых данных.",
    "Рекомендуется функция 'Скопировать данные поверенного №1 → поверенный №2'.",
    "Рекомендуется автоматический поиск отделений 2GIS при выборе конкретного филиала."
  ],

  "rules_for_cursor": [
    "agent_count управляет показом блока AGENT_2.",
    "mail_types — чекбоксы, минимум 1.",
    "post_scope == 'specific' → required post.branch_address.",
    "signature_mode == 'poa' → required repr.registry_number + repr.scan.",
    "term_type формирует структуру срока.",
    "Перед генерацией система должна проверить корректность всех обязательных полей."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — PRINCIPAL */
      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО" },
          { "name": "principal.iin", "type": "text", "label": "ИИН" },
          { "name": "principal.passport.number", "type": "text", "label": "Паспорт: серия/номер" },
          { "name": "principal.address", "type": "text", "label": "Адрес регистрации / фактический" },
          { "name": "principal.phone", "type": "text", "label": "Контактный номер" }
        ],
        "next": "agent_count"
      },

      /* STEP 2 — SELECT AGENT COUNT */
      {
        "id": "agent_count",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": "1", "label": "1 поверенный" },
          { "value": "2", "label": "2 поверенных" }
        ],
        "required": true,
        "next": {
          "1": "agent_1",
          "2": "agent_1"
        }
      },

      /* STEP 3 — AGENT 1 */
      {
        "id": "agent_1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agent1.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent1.iin", "type": "text", "label": "ИИН" },
          { "name": "agent1.passport.number", "type": "text", "label": "Паспорт" },
          { "name": "agent1.address", "type": "text", "label": "Адрес" },
          { "name": "agent1.phone", "type": "text", "label": "Телефон" }
        ],
        "next": "agent_2_cond"
      },

      /* STEP 4 — CONDITIONAL AGENT 2 */
      {
        "id": "agent_2_cond",
        "type": "condition",
        "expression": "agent_count == '2'",
        "next_if_true": "agent_2",
        "next_if_false": "mail_types"
      },

      {
        "id": "agent_2",
        "type": "form",
        "title": "Поверенный 2",
        "fields": [
          { "name": "agent2.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent2.iin", "type": "text", "label": "ИИН" },
          { "name": "agent2.passport.number", "type": "text", "label": "Паспорт" },
          { "name": "agent2.address", "type": "text", "label": "Адрес" },
          { "name": "agent2.phone", "type": "text", "label": "Телефон" }
        ],
        "next": "mail_types"
      },

      /* STEP 5 — MAIL TYPES */
      {
        "id": "mail_types",
        "type": "checkbox-group",
        "title": "Виды почтовых отправлений",
        "has_select_all": true,
        "min": 1,
        "options": [
          { "value": "simple", "label": "Простые письма" },
          { "value": "registered", "label": "Заказные письма" },
          { "value": "valuable", "label": "Ценные письма" },
          { "value": "court", "label": "Судебные повестки" },
          { "value": "ems", "label": "Курьерские/EMS" },
          { "value": "packages", "label": "Посылки / бандероли" },
          { "value": "tax", "label": "Налоговые уведомления" },
          { "value": "bank", "label": "Банковские извещения" },
          { "value": "other", "label": "Иное" }
        ],
        "next": "post_scope"
      },

      /* STEP 6 — WHERE TO RECEIVE */
      {
        "id": "post_scope",
        "type": "radio",
        "title": "Место получения",
        "options": [
          { "value": "any", "label": "Любое отделение" },
          { "value": "specific", "label": "Конкретное отделение" }
        ],
        "required": true,
        "next": {
          "any": "authorities",
          "specific": "post_address"
        }
      },

      {
        "id": "post_address",
        "type": "form",
        "title": "Адрес отделения",
        "fields": [
          { "name": "post.branch_address", "type": "text", "label": "Адрес отделения" }
        ],
        "next": "authorities"
      },

      /* STEP 7 — AUTHORITIES */
      {
        "id": "authorities",
        "type": "checkbox-group",
        "title": "Полномочия поверенного",
        "options": [
          { "value": "receive", "label": "Получать отправления" },
          { "value": "sign_docs", "label": "Расписываться в документах" },
          { "value": "present_id", "label": "Предъявлять удостоверяющие документы доверителя" },
          { "value": "pay_services", "label": "Оплачивать почтовые услуги" },
          { "value": "gov_notifications", "label": "Получать уведомления госорганов" },
          { "value": "misc", "label": "Иное" }
        ],
        "next": "representation"
      },

      /* STEP 8 — SIGNING MODE */
      {
        "id": "representation",
        "type": "radio",
        "title": "Подписание документа доверителем",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "required": true,
        "next": {
          "personal": "term",
          "poa": "repr_fields"
        }
      },

      {
        "id": "repr_fields",
        "type": "form",
        "title": "Реквизиты доверенности доверителя",
        "fields": [
          { "name": "repr.registry_number", "type": "text", "label": "Реестровый номер" },
          { "name": "repr.notary", "type": "text", "label": "Нотариус" },
          { "name": "repr.license", "type": "text", "label": "Номер лицензии" },
          { "name": "repr.date", "type": "date", "label": "Дата выдачи" },
          { "name": "repr.scan[]", "type": "file", "label": "Скан доверенности", "min": 1 }
        ],
        "next": "term"
      },

      /* STEP 9 — TERM */
      {
        "id": "term",
        "type": "radio",
        "title": "Срок действия доверенности",
        "options": [
          { "value": "days", "label": "На ___ дней" },
          { "value": "months", "label": "На ___ месяцев" },
          { "value": "date", "label": "До определённой даты" }
        ],
        "required": true,
        "next": {
          "days": "term_days",
          "months": "term_months",
          "date": "term_date"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "label": "Количество дней", "min": 1, "max": 31 }
        ],
        "next": "validate"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "label": "Количество месяцев", "min": 1, "max": 36 }
        ],
        "next": "validate"
      },

      {
        "id": "term_date",
        "type": "form",
        "fields": [
          { "name": "term.date", "type": "date", "label": "Дата окончания" }
        ],
        "next": "validate"
      },

      /* STEP 10 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required principal.iin",
          "required agent1.full_name",
          "required mail_types (>=1)",
          "required post_scope",
          "if post_scope == 'specific' → required post.branch_address",
          "required term",
          "if representation == 'poa' → required repr.scan"
        ],
        "next": "generate"
      },

      /* STEP 11 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal",
      "agents[]",
      "mail_types",
      "post",
      "authorities",
      "representation",
      "term"
    ]
  }
},
{
  "id": 36,
  "code": "DOC_036",
  "title": "Доверенность на получение пенсии / соцвыплат / алиментов",
  "category": "Доверенности / Социальные выплаты / Пенсия",

  "dev_notes": [
    "Поверенных может быть 1 или 2 — каждый блок обязателен.",
    "Типы выплат — checkbox-group, min=1.",
    "Если выбран алиментный блок — обязательная загрузка исполнительного документа/соглашения.",
    "Если выбран survivor-пенсия — желательно загрузить свидетельство о смерти.",
    "Источник выплат — multi-select (min=1).",
    "Способ получения: наличные / банковский счёт / смешанный спец-режим.",
    "Если получение на счёт → обязательны ИИК/БИК/номер карты.",
    "Необходимые документы — большой чеклист + обязательные загрузки для каждого кейса.",
    "Особые случаи — несовершеннолетний/опекун; доверитель действует по доверенности.",
    "VALIDATION должна учитывать множество условий блокировки."
  ],

  "rules_for_cursor": [
    "agent_count → показывает agent2.",
    "payment_types (checkbox-group) must have min=1.",
    "pay_source must have min=1.",
    "receive_method == 'cash' → require branch info.",
    "receive_method == 'bank' → require bank details.",
    "If payment_types includes 'alimony' → require alimony_doc[].",
    "If payment_types includes 'survivor' → recommend death_cert[].",
    "If minor_case == true → require guardian docs.",
    "If principal_by_poa == true → require poa fields.",
    "Validation must block generation on missing mandatory documents."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — PRINCIPAL */
      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО" },
          { "name": "principal.iin", "type": "text", "label": "ИИН" },
          { "name": "principal.passport.type", "type": "text", "label": "Тип документа" },
          { "name": "principal.passport.number", "type": "text", "label": "Серия/номер" },
          { "name": "principal.passport.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.passport.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "principal.address", "type": "text", "label": "Адрес регистрации / фактический" },
          { "name": "principal.contacts.phone", "type": "text", "label": "Телефон" },
          { "name": "principal.contacts.email", "type": "text", "label": "E-mail" }
        ],
        "next": "agent_count"
      },

      /* STEP 2 — AGENT COUNT */
      {
        "id": "agent_count",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": "1", "label": "1 поверенный" },
          { "value": "2", "label": "2 поверенных" }
        ],
        "required": true,
        "next": {
          "1": "agent1",
          "2": "agent1"
        }
      },

      /* STEP 3 — AGENT 1 */
      {
        "id": "agent1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agent1.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent1.iin", "type": "text", "label": "ИИН" },
          { "name": "agent1.passport", "type": "text", "label": "Документ личности" },
          { "name": "agent1.contacts.phone", "type": "text", "label": "Телефон" }
        ],
        "next": "agent2_cond"
      },

      /* STEP 4 — AGENT 2 CONDITIONAL */
      {
        "id": "agent2_cond",
        "type": "condition",
        "expression": "agent_count == '2'",
        "next_if_true": "agent2",
        "next_if_false": "payment_types"
      },

      {
        "id": "agent2",
        "type": "form",
        "title": "Поверенный 2",
        "fields": [
          { "name": "agent2.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent2.iin", "type": "text", "label": "ИИН" },
          { "name": "agent2.passport", "type": "text", "label": "Документ личности" },
          { "name": "agent2.contacts.phone", "type": "text", "label": "Телефон" }
        ],
        "next": "payment_types"
      },

      /* STEP 5 — PAYMENT TYPES */
      {
        "id": "payment_types",
        "type": "checkbox-group",
        "title": "Типы социальных выплат",
        "min": 1,
        "has_select_all": true,
        "options": [
          { "value": "old_age", "label": "Пенсия по старости" },
          { "value": "disability", "label": "Пенсия по инвалидности" },
          { "value": "survivor", "label": "Пенсия по потере кормильца" },
          { "value": "benefits", "label": "Социальные пособия" },
          { "value": "alimony", "label": "Алименты" },
          { "value": "other", "label": "Иное" }
        ],
        "next": "pay_source"
      },

      /* STEP 6 — PAY SOURCE */
      {
        "id": "pay_source",
        "type": "checkbox-group",
        "title": "Источник выплат",
        "min": 1,
        "options": [
          { "value": "pension_fund", "label": "Пенсионный фонд / орган соцзащиты" },
          { "value": "bank", "label": "Банк" },
          { "value": "post", "label": "Почта / почтовое отделение" },
          { "value": "other", "label": "Иной орган" }
        ],
        "next": "receive_method"
      },

      /* STEP 7 — RECEIVE METHOD */
      {
        "id": "receive_method",
        "type": "radio",
        "title": "Способ получения",
        "options": [
          { "value": "cash", "label": "Наличными" },
          { "value": "bank_transfer", "label": "На банковскую карту / счёт" },
          { "value": "mixed", "label": "Уведомление + получение наличными" }
        ],
        "required": true,
        "next": {
          "cash": "receive_cash",
          "bank_transfer": "receive_bank",
          "mixed": "required_docs"
        }
      },

      {
        "id": "receive_cash",
        "type": "form",
        "title": "Получение наличными",
        "fields": [
          { "name": "cash.branch", "type": "text", "label": "Отделение / почта" }
        ],
        "next": "required_docs"
      },

      {
        "id": "receive_bank",
        "type": "form",
        "title": "Банковские реквизиты",
        "fields": [
          { "name": "bank.bank_name", "type": "text", "label": "Банк" },
          { "name": "bank.bik", "type": "text", "label": "БИК" },
          { "name": "bank.iik", "type": "text", "label": "ИИК" },
          { "name": "bank.card_number", "type": "text", "label": "Номер карты" }
        ],
        "next": "required_docs"
      },

      /* STEP 8 — REQUIRED DOCS */
      {
        "id": "required_docs",
        "type": "form",
        "title": "Необходимые документы",
        "fields": [
          { "name": "docs.passport_scan[]", "type": "file", "label": "Паспорт доверителя", "min": 1 },
          { "name": "docs.iin_scan[]", "type": "file", "label": "Документ ИИН (если отдельный)" },
          { "name": "docs.pension_cert[]", "type": "file", "label": "Пенсионное удостоверение" },
          { "name": "docs.pension_fund_ref[]", "type": "file", "label": "Справка из ПФ" },
          { "name": "docs.alimony_doc[]", "type": "file", "label": "Исполнительный документ / соглашение" },
          { "name": "docs.death_cert[]", "type": "file", "label": "Свидетельство о смерти (для survivor)" },
          { "name": "docs.social_rights[]", "type": "file", "label": "Документ на соцвыплату" },
          { "name": "docs.agent_poa[]", "type": "file", "label": "Документ полномочий поверенного" }
        ],
        "next": "special_cases"
      },

      /* STEP 9 — SPECIAL CASES */
      {
        "id": "special_cases",
        "type": "radio",
        "title": "Особые случаи",
        "options": [
          { "value": "minor", "label": "Доверитель — несовершеннолетний / недееспособный" },
          { "value": "principal_poa", "label": "Доверитель действует по доверенности" },
          { "value": "none", "label": "Нет особых случаев" }
        ],
        "required": true,
        "next": {
          "minor": "minor_case",
          "principal_poa": "principal_poa_fields",
          "none": "validation"
        }
      },

      {
        "id": "minor_case",
        "type": "form",
        "title": "Данные законного представителя",
        "fields": [
          { "name": "minor.guardian_full_name", "type": "text", "label": "ФИО представителя" },
          { "name": "minor.guardian_doc[]", "type": "file", "label": "Документы опеки", "min": 1 }
        ],
        "next": "validation"
      },

      {
        "id": "principal_poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности доверителя",
        "fields": [
          { "name": "principal_poa.number", "type": "text", "label": "Реестровый номер" },
          { "name": "principal_poa.notary", "type": "text", "label": "Нотариус" },
          { "name": "principal_poa.license", "type": "text", "label": "№ лицензии" },
          { "name": "principal_poa.date", "type": "date", "label": "Дата" },
          { "name": "principal_poa.scan[]", "type": "file", "label": "Скан доверенности", "min": 1 }
        ],
        "next": "validation"
      },

      /* STEP 10 — VALIDATION */
      {
        "id": "validation",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required agent1.full_name",
          "required payment_types (>=1)",
          "required pay_source (>=1)",
          "if receive_method == 'cash' → required cash.branch",
          "if receive_method == 'bank_transfer' → required bank.bik + bank.iik",
          "if 'alimony' in payment_types → required docs.alimony_doc",
          "if special_cases == 'minor' → required minor.guardian_doc",
          "if special_cases == 'principal_poa' → required principal_poa.scan"
        ],
        "next": "consents_confirm"
      },

      /* STEP 11 — CONSENTS */
      {
        "id": "consents_confirm",
        "type": "checkbox-group",
        "title": "Дополнительные опции",
        "options": [
          { "value": "notify_principal", "label": "Уведомлять доверителя (SMS/e-mail)" },
          { "value": "notify_agent", "label": "Уведомлять поверенного о зачислении" },
          { "value": "make_receipt", "label": "Сформировать расписку / акт приема-передачи" },
          { "value": "agent_pays_fees", "label": "Поверенный оплачивает комиссии" }
        ],
        "next": "generate"
      },

      /* STEP 12 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal",
      "agents[]",
      "payment_types",
      "pay_source",
      "receive_method",
      "documents",
      "special_cases",
      "consents"
    ]
  }
},
{
  "id": 37,
  "code": "DOC_037",
  "title": "Доверенность на подачу заявлений и получение справок в ЦОН / миграции",
  "category": "Доверенности / ЦОН / Миграция",

  "dev_notes": [
    "Поверенных может быть 1 или 2 — обязательна полная анкета каждого.",
    "Выбор услуг/заявлений (scope) — checkbox-group, min=1.",
    "Если выбран конкретный филиал — обязательный ввод филиала.",
    "Документы — чеклист + upload: паспорт доверителя обязателен.",
    "Если оригиналы передаются — включать акт приёма-передачи.",
    "Оплата госпошлины — выбор одной из трех опций, при необходимости указывать реквизиты.",
    "Если доверитель действует по своей доверенности → обязательные реквизиты + upload.",
    "VALIDATION должна проверять наличие всех обязательных данных и документов."
  ],

  "rules_for_cursor": [
    "agent_count == '2' → показывать agent2.",
    "scope (услуги) must have min=1.",
    "loc_scope == 'specific' → required loc.branch.",
    "Если оригиналы передаются → генерировать акт передачи.",
    "Оплата госпошлины: если выбран вариант с реквизитами, реквизиты обязательны.",
    "Если representation == 'poa' → required poa fields.",
    "Срок доверенности — один из четырех вариантов."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — PRINCIPAL */
      {
        "id": "principal",
        "type": "form",
        "title": "Доверитель",
        "fields": [
          { "name": "principal.full_name", "type": "text", "label": "ФИО" },
          { "name": "principal.iin", "type": "text", "label": "ИИН" },
          { "name": "principal.passport.type", "type": "text", "label": "Документ: тип" },
          { "name": "principal.passport.number", "type": "text", "label": "Серия/номер" },
          { "name": "principal.passport.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "principal.passport.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "principal.address", "type": "text", "label": "Адрес регистрации / фактический" },
          { "name": "principal.contacts.phone", "type": "text", "label": "Телефон" },
          { "name": "principal.contacts.email", "type": "text", "label": "E-mail" }
        ],
        "next": "agent_count"
      },

      /* STEP 2 — AGENT COUNT */
      {
        "id": "agent_count",
        "type": "radio",
        "title": "Количество поверенных",
        "options": [
          { "value": "1", "label": "1 поверенный" },
          { "value": "2", "label": "2 поверенных" }
        ],
        "required": true,
        "next": { "1": "agent1", "2": "agent1" }
      },

      /* STEP 3 — AGENT 1 */
      {
        "id": "agent1",
        "type": "form",
        "title": "Поверенный 1",
        "fields": [
          { "name": "agent1.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent1.iin", "type": "text", "label": "ИИН" },
          { "name": "agent1.passport", "type": "text", "label": "Документ личности" },
          { "name": "agent1.contacts.phone", "type": "text", "label": "Телефон" }
        ],
        "next": "agent2_cond"
      },

      /* STEP 4 — OPTIONAL AGENT 2 */
      {
        "id": "agent2_cond",
        "type": "condition",
        "expression": "agent_count == '2'",
        "next_if_true": "agent2",
        "next_if_false": "scope"
      },

      {
        "id": "agent2",
        "type": "form",
        "title": "Поверенный 2",
        "fields": [
          { "name": "agent2.full_name", "type": "text", "label": "ФИО" },
          { "name": "agent2.iin", "type": "text", "label": "ИИН" },
          { "name": "agent2.passport", "type": "text", "label": "Документ личности" },
          { "name": "agent2.contacts.phone", "type": "text", "label": "Телефон" }
        ],
        "next": "scope"
      },

      /* STEP 5 — SCOPE OF SERVICES */
      {
        "id": "scope",
        "type": "checkbox-group",
        "title": "Полномочия",
        "min": 1,
        "has_select_all": true,
        "options": [
          { "value": "apply_centre", "label": "Подача заявлений в ЦОН" },
          { "value": "res_cert", "label": "Получение справок о регистрации" },
          { "value": "mig_docs", "label": "Регистрация / продление ВНЖ / РВП" },
          { "value": "propiska", "label": "Справки о прописке / выписке" },
          { "value": "family_status", "label": "Справка о семейном положении" },
          { "value": "replace_id", "label": "Подача заявлений на замену паспорта / ID" },
          { "value": "sign_docs", "label": "Подписание заявлений и получение уведомлений" },
          { "value": "other", "label": "Иное" }
        ],
        "next": "loc_scope"
      },

      /* STEP 6 — LOCATION */
      {
        "id": "loc_scope",
        "type": "radio",
        "title": "Место обращения",
        "options": [
          { "value": "any", "label": "Любой филиал ЦОН / миграции" },
          { "value": "specific", "label": "Конкретный филиал" }
        ],
        "required": true,
        "next": { "any": "documents", "specific": "loc_branch" }
      },

      {
        "id": "loc_branch",
        "type": "form",
        "title": "Адрес конкретного филиала",
        "fields": [
          { "name": "loc.branch", "type": "text", "label": "Адрес филиала" }
        ],
        "next": "documents"
      },

      /* STEP 7 — DOCUMENTS */
      {
        "id": "documents",
        "type": "form",
        "title": "Документы для подачи",
        "fields": [
          { "name": "docs.passport_scan[]", "type": "file", "label": "Паспорт доверителя", "min": 1 },
          { "name": "docs.iin_scan[]", "type": "file", "label": "ИИН (если отдельный)" },
          { "name": "docs.originals[]", "type": "file", "label": "Оригиналы документов для подачи" },
          { "name": "docs.photos[]", "type": "file", "label": "Фотографии / анкеты" },
          { "name": "docs.payment_letter[]", "type": "file", "label": "Письмо об оплате госпошлины" },
          { "name": "docs.principal_poa[]", "type": "file", "label": "Исходная доверенность доверителя" }
        ],
        "next": "payment_option"
      },

      /* STEP 8 — PAYMENT OPTION */
      {
        "id": "payment_option",
        "type": "radio",
        "title": "Оплата госпошлины",
        "options": [
          { "value": "agent_pays", "label": "Поверенный оплачивает" },
          { "value": "principal_pays", "label": "Доверитель оплатит сам" },
          { "value": "principal_requisites", "label": "Доверитель просит оплатить по реквизитам" }
        ],
        "required": true,
        "next": {
          "agent_pays": "ack_transfer",
          "principal_pays": "ack_transfer",
          "principal_requisites": "payment_requisites"
        }
      },

      {
        "id": "payment_requisites",
        "type": "form",
        "title": "Реквизиты для оплаты",
        "fields": [
          { "name": "payment.requisites", "type": "textarea", "label": "Реквизиты для оплаты" }
        ],
        "next": "ack_transfer"
      },

      /* STEP 9 — ACK TRANSFER */
      {
        "id": "ack_transfer",
        "type": "checkbox-group",
        "title": "Передача оригиналов",
        "options": [
          { "value": "need_act", "label": "Сформировать акт приёма-передачи" }
        ],
        "next": "representation"
      },

      /* STEP 10 — REPRESENTATION */
      {
        "id": "representation",
        "type": "radio",
        "title": "Как действует поверенный",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности третьего лица" }
        ],
        "required": true,
        "next": {
          "personal": "id_check",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности поверенного",
        "fields": [
          { "name": "agent_poa.number", "type": "text", "label": "Реестровый номер" },
          { "name": "agent_poa.notary", "type": "text", "label": "Кем выдана" },
          { "name": "agent_poa.license", "type": "text", "label": "Номер лицензии" },
          { "name": "agent_poa.date", "type": "date", "label": "Дата" },
          { "name": "agent_poa.scan[]", "type": "file", "label": "Скан доверенности", "min": 1 }
        ],
        "next": "id_check"
      },

      /* STEP 11 — ID CHECK */
      {
        "id": "id_check",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required agent1.full_name",
          "check passport validity",
          "check presence of required original documents"
        ],
        "next": "term"
      },

      /* STEP 12 — TERM */
      {
        "id": "term",
        "type": "radio",
        "title": "Срок доверенности",
        "options": [
          { "value": "days", "label": "На ___ дней" },
          { "value": "months", "label": "На ___ месяцев" },
          { "value": "date", "label": "До конкретной даты" },
          { "value": "forever", "label": "Бессрочно" }
        ],
        "required": true,
        "next": {
          "days": "term_days",
          "months": "term_months",
          "date": "term_date",
          "forever": "validation_final"
        }
      },

      {
        "id": "term_days",
        "type": "form",
        "fields": [
          { "name": "term.days", "type": "number", "label": "Количество дней", "min": 1, "max": 31 }
        ],
        "next": "validation_final"
      },

      {
        "id": "term_months",
        "type": "form",
        "fields": [
          { "name": "term.months", "type": "number", "label": "Количество месяцев", "min": 1, "max": 36 }
        ],
        "next": "validation_final"
      },

      {
        "id": "term_date",
        "type": "form",
        "fields": [
          { "name": "term.date", "type": "date", "label": "Дата окончания" }
        ],
        "next": "validation_final"
      },

      /* STEP 13 — FINAL VALIDATION */
      {
        "id": "validation_final",
        "type": "validation",
        "rules": [
          "required principal.full_name",
          "required agent1.full_name",
          "required scope (>=1)",
          "if loc_scope == 'specific' → required loc.branch",
          "required docs.passport_scan",
          "if representation == 'poa' → required agent_poa.scan",
          "required term"
        ],
        "next": "generate"
      },

      /* STEP 14 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "principal",
      "agents[]",
      "scope",
      "loc",
      "documents",
      "payment",
      "representation",
      "term"
    ]
  }
},
{
  "id": 38,
  "code": "DOC_038",
  "title": "Брачный договор / брачное соглашение",
  "category": "Брачные договоры / Семейное право",

  "dev_notes": [
    "Документ имеет разные ветки: пренуп (до брака), в браке, после развода (соглашение о разделе).",
    "Обе стороны обязательны: ФИО, ИИН, паспорт, дата рождения, адрес.",
    "Режим имущества — обязательный блок: совместная, раздельная, частично-раздельная, управление доходами, лимиты.",
    "Список категорий имущества — чеклист; должен быть связан с возможностью вводить кастомные параметры.",
    "Важный юридический блок — ответственность по долгам и обязательствам.",
    "Крупные сделки — обязательный пункт: порог, требование согласия, порядок его получения.",
    "Документы: паспорта сторон, свидетельство о браке (если применимо), документы на имущество — по необходимости.",
    "Если есть доверенное подписание — обязательные реквизиты доверенности + upload.",
    "Брачный договор должен генерировать детализированное приложение с перечнем имущества (если заполнено)."
  ],

  "rules_for_cursor": [
    "marital_status управляет ветвлением: prenup / in_marriage / divorce_path.",
    "capacity_required == false → require guardianship docs.",
    "property_regime must have min=1.",
    "assets_list — чеклист, может включать кастомные блоки.",
    "major_transactions.threshold is required.",
    "If representation == 'poa' → require poa fields + scan.",
    "If marital_status == 'in_marriage' → require marriage_certificate.",
    "Validation must block generation if missing required legal blocks: regime, debts, major transactions, term."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — META */
      {
        "id": "meta",
        "type": "form",
        "title": "Метаданные",
        "fields": [
          { "name": "meta.doc_id", "type": "text", "label": "ID документа" },
          { "name": "meta.date", "type": "date", "label": "Дата составления" },
          { "name": "meta.place", "type": "text", "label": "Место составления (город, нотариус)" }
        ],
        "next": "parties"
      },

      /* STEP 2 — PARTIES */
      {
        "id": "parties",
        "type": "form",
        "title": "Стороны брачного договора",
        "fields": [
          { "name": "spouse1.full_name", "type": "text", "label": "Супруг 1 — ФИО" },
          { "name": "spouse1.iin", "type": "text", "label": "ИИН" },
          { "name": "spouse1.birthdate", "type": "date", "label": "Дата рождения" },
          { "name": "spouse1.passport", "type": "text", "label": "Паспортные данные" },
          { "name": "spouse1.address", "type": "text", "label": "Адрес" },

          { "name": "spouse2.full_name", "type": "text", "label": "Супруг 2 — ФИО" },
          { "name": "spouse2.iin", "type": "text", "label": "ИИН" },
          { "name": "spouse2.birthdate", "type": "date", "label": "Дата рождения" },
          { "name": "spouse2.passport", "type": "text", "label": "Паспортные данные" },
          { "name": "spouse2.address", "type": "text", "label": "Адрес" }
        ],
        "next": "marital_status"
      },

      /* STEP 3 — MARITAL STATUS */
      {
        "id": "marital_status",
        "type": "radio",
        "title": "Статус сторон",
        "options": [
          { "value": "prenup", "label": "Ещё не в браке (пренуп)" },
          { "value": "in_marriage", "label": "В браке (составляется в браке)" },
          { "value": "divorce", "label": "После развода (соглашение о разделе)" }
        ],
        "required": true,
        "next": {
          "prenup": "capacity",
          "in_marriage": "marriage_docs",
          "divorce": "capacity"
        }
      },

      /* OPTIONAL — MARRIAGE DOCUMENT */
      {
        "id": "marriage_docs",
        "type": "form",
        "title": "Документы о браке",
        "fields": [
          { "name": "marriage.certificate[]", "type": "file", "label": "Свидетельство о браке", "min": 1 }
        ],
        "next": "capacity"
      },

      /* STEP 4 — CAPACITY */
      {
        "id": "capacity",
        "type": "form",
        "title": "Проверка дееспособности",
        "fields": [
          { "name": "capacity.spouses_adult", "type": "radio", "label": "Совершеннолетние?", "options": ["yes","no"] },
          { "name": "capacity.no_court_limits", "type": "radio", "label": "Не ограничены судом?", "options": ["yes","no"] },
          { "name": "capacity.guardian_docs[]", "type": "file", "label": "Решение суда / опека (если требуется)" }
        ],
        "next": "property_regime"
      },

      /* STEP 5 — PROPERTY REGIME */
      {
        "id": "property_regime",
        "type": "checkbox-group",
        "title": "Режим имущества",
        "min": 1,
        "options": [
          { "value": "joint", "label": "Полная совместная собственность" },
          { "value": "separate", "label": "Полная раздельная собственность" },
          { "value": "partial", "label": "Частично-раздельная (перечислить)" },
          { "value": "manage_income", "label": "Управление доходами/расходами" },
          { "value": "deal_limits", "label": "Лимиты на сделки без согласия" }
        ],
        "next": "assets_list"
      },

      /* STEP 6 — ASSETS LIST */
      {
        "id": "assets_list",
        "type": "checkbox-group",
        "title": "Категории имущества",
        "options": [
          { "value": "real_estate", "label": "Недвижимость" },
          { "value": "transport", "label": "Транспортные средства" },
          { "value": "bank_accounts", "label": "Банковские счета / депозиты" },
          { "value": "business", "label": "Бизнес / доли в ТОО" },
          { "value": "securities", "label": "Ценные бумаги" },
          { "value": "gifts_inheritance", "label": "Подарки / наследство" },
          { "value": "income_types", "label": "Доходы трудовые и инвестиционные" },
          { "value": "other", "label": "Иное имущество" }
        ],
        "next": "debts"
      },

      /* STEP 7 — DEBTS */
      {
        "id": "debts",
        "type": "form",
        "title": "Ответственность по долгам",
        "fields": [
          { "name": "debts.before_marriage", "type": "textarea", "label": "Долги до брака: кто отвечает" },
          { "name": "debts.in_marriage", "type": "textarea", "label": "Долги в браке: совместные или личные" },
          { "name": "debts.guarantees", "type": "textarea", "label": "Гарантии / поручительства" },
          { "name": "debts.notification_rules", "type": "textarea", "label": "Порядок уведомления о крупных обязательствах" }
        ],
        "next": "major_transactions"
      },

      /* STEP 8 — MAJOR TRANSACTIONS */
      {
        "id": "major_transactions",
        "type": "form",
        "title": "Крупные сделки",
        "fields": [
          { "name": "major.threshold", "type": "number", "label": "Порог крупной сделки (сумма)" },
          { "name": "major.need_consent", "type": "radio", "label": "Требуется согласие?", "options": ["yes","no"] },
          { "name": "major.procedure", "type": "textarea", "label": "Процедура получения согласия" }
        ],
        "next": "support_compensation"
      },

      /* STEP 9 — SUPPORT & COMPENSATION */
      {
        "id": "support_compensation",
        "type": "form",
        "title": "Содержание и компенсации",
        "fields": [
          { "name": "support.alimony_rules", "type": "textarea", "label": "Положения о содержании" },
          { "name": "support.compensation", "type": "textarea", "label": "Компенсации при разделе имущества" },
          { "name": "support.indexation", "type": "textarea", "label": "Индексация и сроки" }
        ],
        "next": "children_clauses"
      },

      /* STEP 10 — CHILDREN CLAUSES */
      {
        "id": "children_clauses",
        "type": "form",
        "title": "Положения о детях",
        "fields": [
          { "name": "children.expenses", "type": "textarea", "label": "Расходы и содержание детей" },
          { "name": "children.property", "type": "textarea", "label": "Имущество ребёнка" }
        ],
        "next": "duration_terms"
      },

      /* STEP 11 — DURATION & TERMS */
      {
        "id": "duration_terms",
        "type": "form",
        "title": "Срок действия и изменения договора",
        "fields": [
          { "name": "duration.term_type", "type": "radio", "options": ["until_divorce","forever","until_date"], "label": "Срок действия" },
          { "name": "duration.date", "type": "date", "label": "До какой даты (если выбрано)" },
          { "name": "duration.modification_rules", "type": "textarea", "label": "Условия внесения изменений" },
          { "name": "duration.activation_conditions", "type": "textarea", "label": "Условия вступления в силу (развод, смерть)" }
        ],
        "next": "notifications"
      },

      /* STEP 12 — NOTIFICATIONS */
      {
        "id": "notifications",
        "type": "form",
        "title": "Уведомления и регистрация",
        "fields": [
          { "name": "notifications.bank_send", "type": "radio", "options": ["yes","no"], "label": "Отправить копии в банк?" },
          { "name": "notifications.registry_required", "type": "radio", "options": ["yes","no"], "label": "Требуется ли регистрация?" }
        ],
        "next": "representation"
      },

      /* STEP 13 — REPRESENTATION */
      {
        "id": "representation",
        "type": "radio",
        "title": "Подписание",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "next": {
          "personal": "validation",
          "poa": "poa_fields"
        }
      },

      /* IF POA */
      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.number", "type": "text", "label": "Реестр №" },
          { "name": "poa.notary", "type": "text", "label": "Нотариус" },
          { "name": "poa.license", "type": "text", "label": "Номер лицензии" },
          { "name": "poa.date", "type": "date", "label": "Дата выдачи" },
          { "name": "poa.scan[]", "type": "file", "label": "Скан доверенности", "min": 1 }
        ],
        "next": "validation"
      },

      /* STEP 14 — VALIDATION */
      {
        "id": "validation",
        "type": "validation",
        "rules": [
          "required spouse1.full_name",
          "required spouse2.full_name",
          "required property_regime (>=1)",
          "required major.threshold",
          "required debts.before_marriage",
          "required support_compensation",
          "if marital_status == 'in_marriage' → require marriage.certificate",
          "if representation == 'poa' → require poa.scan"
        ],
        "next": "generate"
      },

      /* STEP 15 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "meta",
      "spouses[]",
      "marital_status",
      "property_regime",
      "assets",
      "debts",
      "major_transactions",
      "support",
      "children",
      "duration",
      "notifications",
      "representation"
    ]
  }
},
{
  "id": 39,
  "code": "DOC_039",
  "title": "Соглашение об определении места проживания ребёнка",
  "category": "Семейные соглашения / Дети",

  "dev_notes": [
    "Документ включает обязательные данные ребёнка и обоих родителей.",
    "Всегда должен быть выбран один вариант места проживания (или совместное проживание).",
    "График общения — обязательный блок: дни недели, передача, каникулы, праздники.",
    "Порядок содержания (алименты/доп. расходы) — обязательный блок.",
    "Загрузки обязательны: свидетельство о рождении ребёнка, паспорта родителей.",
    "Если есть решение суда — включить проверку на противоречие судебному акту.",
    "Блок выезда за границу должен содержать детальные условия согласия второго родителя.",
    "Предусмотреть возможность представительства по доверенности — обязательные реквизиты."
  ],

  "rules_for_cursor": [
    "child.full_name, child.birthdate — required",
    "parents[].full_name, iin, passport — required",
    "residence.choice — required (only one)",
    "If residence.choice == 'joint' → require residence.joint_schedule",
    "visitation.schedule must include: days, place, transfer rules",
    "child_support must specify payer and amount or share",
    "upload: child.birth_certificate[], parents.passports[] — required",
    "If travel.allowed == 'yes' → require travel.consent_rules",
    "If representation == 'poa' → require poa fields + scan"
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — META */
      {
        "id": "meta",
        "type": "form",
        "title": "Метаданные документа",
        "fields": [
          { "name": "meta.doc_id", "type": "text", "label": "ID документа" },
          { "name": "meta.date", "type": "date", "label": "Дата составления" },
          { "name": "meta.place", "type": "text", "label": "Место составления" },
          { "name": "meta.notary", "type": "text", "label": "Нотариус (опционально)" }
        ],
        "next": "child"
      },

      /* STEP 2 — CHILD DATA */
      {
        "id": "child",
        "type": "form",
        "title": "Данные ребёнка",
        "fields": [
          { "name": "child.full_name", "type": "text", "label": "ФИО ребёнка" },
          { "name": "child.birthdate", "type": "date", "label": "Дата рождения" },
          { "name": "child.iin", "type": "text", "label": "ИИН (если есть)" },
          { "name": "child.birthplace", "type": "text", "label": "Место рождения" },
          { "name": "child.special_needs", "type": "textarea", "label": "Особые потребности (опц.)" }
        ],
        "next": "parents"
      },

      /* STEP 3 — PARENTS DATA */
      {
        "id": "parents",
        "type": "form",
        "title": "Данные сторон",
        "fields": [
          { "name": "parent1.full_name", "type": "text", "label": "Родитель 1 — ФИО" },
          { "name": "parent1.iin", "type": "text", "label": "ИИН" },
          { "name": "parent1.passport", "type": "text", "label": "Паспортные данные" },
          { "name": "parent1.address", "type": "text", "label": "Адрес" },
          { "name": "parent1.contact", "type": "text", "label": "Контактный номер" },

          { "name": "parent2.full_name", "type": "text", "label": "Родитель 2 — ФИО" },
          { "name": "parent2.iin", "type": "text", "label": "ИИН" },
          { "name": "parent2.passport", "type": "text", "label": "Паспортные данные" },
          { "name": "parent2.address", "type": "text", "label": "Адрес" },
          { "name": "parent2.contact", "type": "text", "label": "Контактный номер" },

          { "name": "other_representatives[]", "type": "group", "label": "Иные законные представители (опц.)" }
        ],
        "next": "marital_check"
      },

      /* STEP 4 — MARITAL STATUS */
      {
        "id": "marital_check",
        "type": "radio",
        "title": "Статус родителей",
        "options": [
          { "value": "married", "label": "В браке" },
          { "value": "not_married", "label": "Не в браке" },
          { "value": "divorced", "label": "В разводе (указать дату)" }
        ],
        "fields_extra": [
          { "name": "marital.divorce_date", "type": "date", "label": "Дата развода (если выбрано)" }
        ],
        "next": "residence_choice"
      },

      /* STEP 5 — RESIDENCE CHOICE */
      {
        "id": "residence_choice",
        "type": "radio",
        "title": "Место проживания ребёнка",
        "options": [
          { "value": "with_parent1", "label": "С родителем 1" },
          { "value": "with_parent2", "label": "С родителем 2" },
          { "value": "joint", "label": "Совместное проживание (попеременно)" },
          { "value": "other", "label": "Иное (описать)" }
        ],
        "fields_extra": [
          { "name": "residence.joint_schedule", "type": "textarea", "label": "График совместного проживания (если выбрано)" },
          { "name": "residence.other_desc", "type": "textarea", "label": "Описание иного варианта" }
        ],
        "next": "address_block"
      },

      /* STEP 6 — ADDRESS BLOCK */
      {
        "id": "address_block",
        "type": "form",
        "title": "Адрес проживания ребёнка",
        "fields": [
          { "name": "residence.address_fact", "type": "text", "label": "Фактический адрес проживания" },
          { "name": "residence.address_reg", "type": "text", "label": "Адрес регистрации (если отличается)" }
        ],
        "next": "visitation"
      },

      /* STEP 7 — VISITATION SCHEDULE */
      {
        "id": "visitation",
        "type": "form",
        "title": "График общения и порядок передачи",
        "fields": [
          { "name": "visits.regular_schedule", "type": "textarea", "label": "Регулярные встречи (дни недели / часы)" },
          { "name": "visits.transfer_rules", "type": "textarea", "label": "Порядок передачи ребёнка" },
          { "name": "visits.cancel_rules", "type": "textarea", "label": "Правила отмены / переноса" }
        ],
        "next": "holidays"
      },

      /* STEP 8 — HOLIDAYS AND VACATIONS */
      {
        "id": "holidays",
        "type": "form",
        "title": "Праздники и длительные периоды",
        "fields": [
          { "name": "holidays.rotation", "type": "textarea", "label": "Ротация на праздники" },
          { "name": "holidays.vacations", "type": "textarea", "label": "Каникулярные периоды (лето/зима)" }
        ],
        "next": "child_support"
      },

      /* STEP 9 — CHILD SUPPORT */
      {
        "id": "child_support",
        "type": "form",
        "title": "Содержание ребёнка",
        "fields": [
          { "name": "support.alimony", "type": "textarea", "label": "Алименты / порядок выплат" },
          { "name": "support.expenses", "type": "textarea", "label": "Медстраховка / лечение / образование" },
          { "name": "support.extra_expenses", "type": "textarea", "label": "Неожиданные расходы: доли / фикс. суммы" },
          { "name": "support.reporting", "type": "textarea", "label": "Периодичность отчётов" }
        ],
        "next": "medical_edu"
      },

      /* STEP 10 — MEDICAL & EDUCATION */
      {
        "id": "medical_edu",
        "type": "form",
        "title": "Медицина / образование / кружки",
        "fields": [
          { "name": "medical.rights", "type": "textarea", "label": "Кто принимает мед. решения" },
          { "name": "medical.emergency_consent", "type": "textarea", "label": "Согласие на неотложную помощь" },
          { "name": "edu.sections", "type": "textarea", "label": "Секции / кружки" }
        ],
        "next": "travel"
      },

      /* STEP 11 — TRAVEL */
      {
        "id": "travel",
        "type": "form",
        "title": "Выезд за границу / путешествия",
        "fields": [
          { "name": "travel.allowed", "type": "radio", "label": "Разрешён ли выезд?", "options": ["yes", "no"] },
          { "name": "travel.consent_rules", "type": "textarea", "label": "Правила согласия второго родителя" },
          { "name": "travel.docs", "type": "textarea", "label": "Документы, сопровождающие поездку" }
        ],
        "next": "emergency"
      },

      /* STEP 12 — EMERGENCY */
      {
        "id": "emergency",
        "type": "form",
        "title": "Экстренные ситуации",
        "fields": [
          { "name": "emergency.contacts[]", "type": "group", "label": "Контакты для экстренной связи" },
          { "name": "emergency.actions", "type": "textarea", "label": "Алгоритм действий" },
          { "name": "emergency.temp_transfer", "type": "radio", "label": "Можно ли временно передавать ребёнка третьему лицу?", "options": ["yes","no"] }
        ],
        "next": "auth_docs"
      },

      /* STEP 13 — DOCS */
      {
        "id": "auth_docs",
        "type": "form",
        "title": "Необходимые документы",
        "fields": [
          { "name": "docs.child_birth_certificate[]", "type": "file", "label": "Свидетельство о рождении", "min": 1 },
          { "name": "docs.parents_passports[]", "type": "file", "label": "Паспорта родителей", "min": 2 },
          { "name": "docs.divorce_decision[]", "type": "file", "label": "Решение суда о разводе (если применимо)" },
          { "name": "docs.guardianship[]", "type": "file", "label": "Документы опеки (если есть)" },
          { "name": "docs.third_party_consent[]", "type": "file", "label": "Согласия третьих лиц (если нужны)" }
        ],
        "next": "representation"
      },

      /* STEP 14 — REPRESENTATION */
      {
        "id": "representation",
        "type": "radio",
        "title": "Подписание",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "next": {
          "personal": "validation",
          "poa": "poa_fields"
        }
      },

      /* STEP 15 — POA DETAILS */
      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.number", "type": "text", "label": "Реестр №" },
          { "name": "poa.notary", "type": "text", "label": "Нотариус" },
          { "name": "poa.license", "type": "text", "label": "Номер лицензии" },
          { "name": "poa.date", "type": "date", "label": "Дата выдачи" },
          { "name": "poa.scan[]", "type": "file", "label": "Скан доверенности", "min": 1 }
        ],
        "next": "validation"
      },

      /* STEP 16 — VALIDATION */
      {
        "id": "validation",
        "type": "validation",
        "rules": [
          "required child.full_name",
          "required parent1.full_name",
          "required parent2.full_name",
          "required residence.choice",
          "required residence.address_fact",
          "required visits.regular_schedule",
          "required support.alimony",
          "required docs.child_birth_certificate",
          "required docs.parents_passports",
          "if representation == 'poa' → require poa.scan"
        ],
        "next": "generate"
      },

      /* STEP 17 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "child",
      "parents[]",
      "marital_status",
      "residence",
      "visits",
      "holidays",
      "support",
      "medical",
      "travel",
      "emergency",
      "docs",
      "representation"
    ]
  }
},
{
  "id": 40,
  "code": "DOC_040",
  "title": "Соглашение об уплате алиментов",
  "category": "Семейные соглашения / Алименты",

  "dev_notes": [
    "Стороны: плательщик и получатель — обязательные данные.",
    "Если действует представитель — требовать реквизиты доверенности.",
    "Ветвление по категориям: на ребёнка/детей, на супругу(а), на родителя, комбинированно.",
    "Для детей — обязательна загрузка свидетельства о рождении.",
    "Для супруги — обязательны документы-основания: беременность, ребёнок до 3 лет, нетрудоспособность.",
    "Вид алиментов (фикс., доля, комбинированно, единовременная) — обязательный выбор.",
    "Если единовременная выплата — обязательны подтверждающие документы.",
    "Способ выплаты требует обязательных реквизитов счёта при выборе банковского способа.",
    "Блок задолженности — только если есть долг.",
    "Гарантии: штрафы, обеспечение, удержание работодателем.",
    "Валидация должна проверять соответствие требованиям Семейного кодекса РК.",
    "Подписание — лично / по доверенности (если по доверенности — реквизиты и скан)."
  ],

  "rules_for_cursor": [
    "required payer.full_name, payer.iin, payer.passport",
    "required receiver.full_name, receiver.iin, receiver.passport",
    "If alim_for == 'children' → children[] required",
    "If alim_for includes spouse → require spouse_reason + documents",
    "If alim_for includes parent → require parent_docs[]",
    "payment_type required",
    "If payment_type == 'fixed' → require fixed.amount, period, indexation",
    "If payment_type == 'share' → require share.percent OR share.standard_choice",
    "If payment_type == 'combined' → require both fixed and share fields",
    "If payment_type == 'one_time' → require one_time.amount and receipt generation",
    "payment_method required",
    "If payment_method == 'bank' → require bank.iik and bank.bik",
    "schedule.first_payment required",
    "If debt == yes → require debt.amount and debt.schedule",
    "If representation == 'poa' → require poa.scan",
    "Require uploads: children.birth_cert, spouse_docs, parent_docs — depending on branch"
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — META */
      {
        "id": "meta",
        "type": "form",
        "title": "Метаданные",
        "fields": [
          { "name": "meta.id", "type": "text", "label": "ID документа" },
          { "name": "meta.date", "type": "date", "label": "Дата составления" },
          { "name": "meta.place", "type": "text", "label": "Место составления" },
          { "name": "meta.notary", "type": "text", "label": "Нотариус (опционально)" }
        ],
        "next": "parties"
      },

      /* STEP 2 — PARTIES */
      {
        "id": "parties",
        "type": "form",
        "title": "Стороны соглашения",
        "fields": [
          { "name": "payer.full_name", "type": "text", "label": "Плательщик — ФИО" },
          { "name": "payer.iin", "type": "text", "label": "ИИН" },
          { "name": "payer.passport", "type": "text", "label": "Паспортные данные" },
          { "name": "payer.address", "type": "text", "label": "Адрес" },

          { "name": "receiver.full_name", "type": "text", "label": "Получатель — ФИО" },
          { "name": "receiver.iin", "type": "text", "label": "ИИН" },
          { "name": "receiver.passport", "type": "text", "label": "Паспортные данные" },
          { "name": "receiver.address", "type": "text", "label": "Адрес" },

          { "name": "representation.poa_used", "type": "radio", "label": "Действует представитель?", "options": ["no", "yes"] }
        ],
        "next": {
          "yes": "poa_fields_representation",
          "no": "alim_for_whom"
        }
      },

      /* STEP 2.1 — POA FOR PARTY */
      {
        "id": "poa_fields_representation",
        "type": "form",
        "title": "Реквизиты доверенности представителя",
        "fields": [
          { "name": "party_poa.number", "type": "text", "label": "Реестр №" },
          { "name": "party_poa.notary", "type": "text", "label": "Нотариус" },
          { "name": "party_poa.license", "type": "text", "label": "Номер лицензии" },
          { "name": "party_poa.date", "type": "date", "label": "Дата выдачи" },
          { "name": "party_poa.scan[]", "type": "file", "label": "Скан доверенности", "min": 1 }
        ],
        "next": "alim_for_whom"
      },

      /* STEP 3 — WHO RECEIVES ALIMONY */
      {
        "id": "alim_for_whom",
        "type": "radio",
        "title": "На кого устанавливаются алименты?",
        "options": [
          { "value": "children", "label": "На ребёнка/детей" },
          { "value": "spouse", "label": "На супругу/супруга" },
          { "value": "parent", "label": "На нетрудоспособного родителя" },
          { "value": "multiple", "label": "Комбинированно" }
        ],
        "next": {
          "children": "children_block",
          "spouse": "spouse_block",
          "parent": "parent_block",
          "multiple": "multi_block"
        }
      },

      /* STEP 4 — CHILDREN BLOCK */
      {
        "id": "children_block",
        "type": "repeatable",
        "title": "Данные детей",
        "fields": [
          { "name": "child.full_name", "type": "text", "label": "ФИО ребёнка" },
          { "name": "child.iin", "type": "text", "label": "ИИН" },
          { "name": "child.birthdate", "type": "date", "label": "Дата рождения" },
          { "name": "child.birth_cert[]", "type": "file", "label": "Свидетельство о рождении", "min": 1 }
        ],
        "next": "living_info"
      },

      /* STEP 4.1 — SPOUSE BLOCK */
      {
        "id": "spouse_block",
        "type": "form",
        "title": "Основание для алиментов супруге/супругу",
        "fields": [
          { "name": "spouse.reason", "type": "checkbox-group", "label": "Основание", "options": ["беременность", "ребёнок до 3 лет", "нетрудоспособность"] },
          { "name": "spouse.docs[]", "type": "file", "label": "Документы подтверждения", "min": 1 }
        ],
        "next": "payment_type"
      },

      /* STEP 4.2 — PARENT BLOCK */
      {
        "id": "parent_block",
        "type": "form",
        "title": "Основания для алиментов родителю",
        "fields": [
          { "name": "parent.disability_docs[]", "type": "file", "label": "Документы о нетрудоспособности", "min": 1 },
          { "name": "parent.relation_docs[]", "type": "file", "label": "Документы о родстве", "min": 1 }
        ],
        "next": "payment_type"
      },

      /* STEP 4.3 — MULTI BLOCK */
      {
        "id": "multi_block",
        "type": "checkbox-group",
        "title": "Выберите категории",
        "options": [
          { "value": "children", "label": "Дети" },
          { "value": "spouse", "label": "Супруг(а)" },
          { "value": "parent", "label": "Нетрудоспособный родитель" }
        ],
        "next": "payment_type"
      },

      /* STEP 5 — WHERE CHILD LIVES */
      {
        "id": "living_info",
        "type": "radio",
        "title": "Проживание ребёнка",
        "options": [
          { "value": "with_payer", "label": "С плательщиком" },
          { "value": "with_receiver", "label": "С получателем" },
          { "value": "other", "label": "Иное — указать адрес" }
        ],
        "fields_extra": [
          { "name": "child.living_other_address", "type": "text", "label": "Адрес (если иное)" }
        ],
        "next": "payment_type"
      },

      /* STEP 6 — PAYMENT TYPE */
      {
        "id": "payment_type",
        "type": "radio",
        "title": "Форма алиментов",
        "options": [
          { "value": "fixed", "label": "Фиксированная сумма" },
          { "value": "share", "label": "Доля от дохода" },
          { "value": "combined", "label": "Комбинированно" },
          { "value": "one_time", "label": "Единовременная выплата" }
        ],
        "next": {
          "fixed": "fixed_sum",
          "share": "share_block",
          "combined": "combined_block",
          "one_time": "one_time_block"
        }
      },

      /* STEP 6.1 — FIXED SUM */
      {
        "id": "fixed_sum",
        "type": "form",
        "title": "Фиксированная сумма",
        "fields": [
          { "name": "fixed.amount", "type": "text", "label": "Сумма (цифрами/словами)" },
          { "name": "fixed.period", "type": "select", "options": ["ежемесячно", "ежеквартально"], "label": "Периодичность" },
          { "name": "fixed.indexation", "type": "checkbox", "label": "Индексация по инфляции" }
        ],
        "next": "payment_method"
      },

      /* STEP 6.2 — SHARE */
      {
        "id": "share_block",
        "type": "form",
        "title": "Доля от дохода",
        "fields": [
          { "name": "share.standard_choice", "type": "select", "label": "Стандартная доля", "options": ["1/4", "1/3", "1/2", "не использовать стандарт"] },
          { "name": "share.custom_percent", "type": "text", "label": "Индивидуальный процент (если выбран нестандарт)" }
        ],
        "next": "payment_method"
      },

      /* STEP 6.3 — COMBINED */
      {
        "id": "combined_block",
        "type": "form",
        "title": "Комбинированный вид",
        "fields": [
          { "name": "combined.fixed_amount", "type": "text", "label": "Фиксированная часть" },
          { "name": "combined.share_part", "type": "text", "label": "Доля от дохода (%)" },
          { "name": "combined.limits", "type": "textarea", "label": "Лимиты (минимум/максимум)" }
        ],
        "next": "payment_method"
      },

      /* STEP 6.4 — ONE TIME */
      {
        "id": "one_time_block",
        "type": "form",
        "title": "Единовременная выплата",
        "fields": [
          { "name": "one_time.amount", "type": "text", "label": "Сумма" },
          { "name": "one_time.deadline", "type": "date", "label": "Срок выплаты" },
          { "name": "one_time.method", "type": "text", "label": "Способ выплаты" },
          { "name": "one_time.asset_transfer", "type": "textarea", "label": "Передача имущества (если предусмотрено)" }
        ],
        "next": "guarantees"
      },

      /* STEP 7 — PAYMENT METHOD */
      {
        "id": "payment_method",
        "type": "radio",
        "title": "Способ выплаты",
        "options": [
          { "value": "cash", "label": "Наличными под расписку" },
          { "value": "bank", "label": "На банковский счёт" },
          { "value": "cashdesk", "label": "Через кассу с квитанциями" },
          { "value": "employer", "label": "Удержание работодателем" }
        ],
        "next": {
          "bank": "bank_details",
          "cash": "schedule",
          "cashdesk": "schedule",
          "employer": "schedule"
        }
      },

      /* STEP 7.1 — BANK DETAILS */
      {
        "id": "bank_details",
        "type": "form",
        "title": "Банковские реквизиты",
        "fields": [
          { "name": "bank.iik", "type": "text", "label": "ИИК" },
          { "name": "bank.bik", "type": "text", "label": "БИК" },
          { "name": "bank.bank_name", "type": "text", "label": "Банк" }
        ],
        "next": "schedule"
      },

      /* STEP 8 — PAYMENT SCHEDULE */
      {
        "id": "schedule",
        "type": "form",
        "title": "График выплат",
        "fields": [
          { "name": "schedule.first_payment", "type": "date", "label": "Дата первого платежа" },
          { "name": "schedule.monthly_day", "type": "number", "label": "День месяца для регулярных платежей (1–28)" },
          { "name": "schedule.transfer_rules", "type": "textarea", "label": "Условия переноса срока" }
        ],
        "next": "debt"
      },

      /* STEP 9 — DEBT BLOCK */
      {
        "id": "debt",
        "type": "radio",
        "title": "Есть ли задолженность?",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "next": {
          "yes": "debt_info",
          "no": "guarantees"
        }
      },

      {
        "id": "debt_info",
        "type": "form",
        "title": "Информация о задолженности",
        "fields": [
          { "name": "debt.amount", "type": "text", "label": "Сумма долга" },
          { "name": "debt.repayment_schedule", "type": "textarea", "label": "График погашения" },
          { "name": "debt.indexation", "type": "checkbox", "label": "Индексация при просрочке" }
        ],
        "next": "guarantees"
      },

      /* STEP 10 — GUARANTEES */
      {
        "id": "guarantees",
        "type": "form",
        "title": "Гарантии исполнения",
        "fields": [
          { "name": "guarantee.penalty", "type": "text", "label": "Штраф за просрочку (например, 1%/день)" },
          { "name": "guarantee.asset", "type": "textarea", "label": "Имущество в обеспечение" },
          { "name": "guarantee.employer_notify", "type": "checkbox", "label": "Уведомление работодателя" },
          { "name": "guarantee.other", "type": "textarea", "label": "Иные меры" }
        ],
        "next": "termination"
      },

      /* STEP 11 — TERMINATION */
      {
        "id": "termination",
        "type": "form",
        "title": "Изменение / расторжение",
        "fields": [
          { "name": "termination.rules", "type": "textarea", "label": "Условия изменения соглашения" },
          { "name": "termination.auto_end", "type": "textarea", "label": "Условия автоматического прекращения" }
        ],
        "next": "representation_sign"
      },

      /* STEP 12 — REPRESENTATION SIGN */
      {
        "id": "representation_sign",
        "type": "radio",
        "title": "Подписание",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "next": {
          "personal": "validation",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности при подписании",
        "fields": [
          { "name": "sign_poa.number", "type": "text", "label": "Реестр №" },
          { "name": "sign_poa.notary", "type": "text", "label": "Нотариус" },
          { "name": "sign_poa.date", "type": "date", "label": "Дата" },
          { "name": "sign_poa.scan[]", "type": "file", "label": "Скан доверенности", "min": 1 }
        ],
        "next": "validation"
      },

      /* STEP 13 — VALIDATION */
      {
        "id": "validation",
        "type": "validation",
        "rules": [
          "required payer.full_name",
          "required receiver.full_name",
          "required payment_type",
          "required schedule.first_payment",
          "if alim_for_whom == 'children' → require child.birth_cert",
          "if payment_type == 'fixed' → require fixed.amount",
          "if payment_type == 'share' → require share.standard_choice or share.custom_percent",
          "if payment_type == 'one_time' → require one_time.amount",
          "if payment_method == 'bank' → require bank.iik and bank.bik",
          "if representation_sign == 'poa' → require sign_poa.scan"
        ],
        "next": "generate"
      },

      /* STEP 14 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "payer",
      "receiver",
      "children[]",
      "spouse",
      "parent",
      "payment_type",
      "payment_method",
      "schedule",
      "debt",
      "guarantee",
      "termination",
      "representation"
    ]
  }
},
{
  "id": 41,
  "code": "DOC_041",
  "title": "Заявление о выдаче свидетельства о праве на наследство",
  "category": "Наследство / Заявления",

  "dev_notes": [
    "Обязательные блоки: заявитель, наследодатель, родство, основание наследования, имущество, доли, сроки.",
    "Свидетельство о смерти — обязательный upload.",
    "Документы подтверждения родства обязательны, если наследование по закону.",
    "Если по завещанию — загрузить завещание, проверить дату и нотариуса.",
    "Если по доверенности — обязательные реквизиты и загрузка скана доверенности.",
    "Ветви для имущества: недвижимость, транспорт, счета, доли в ТОО, ценные бумаги, прочее.",
    "Если долги наследодателя — обязательная форма для долгов и upload.",
    "Если отказ от наследства — обязательный upload заявления об отказе.",
    "Валидация должна проверять 6-месячный срок, наличие документов, распределение долей.",
    "Генерация создаёт заявление, описи имущества и документов."
  ],

  "rules_for_cursor": [
    "required applicant.full_name, applicant.iin, applicant.passport",
    "required deceased.full_name, deceased.death_date, deceased.death_cert",
    "required last_residence.address_reg",
    "if relation != 'will' → require relation_docs",
    "if inherit_type == 'will' → require will.upload",
    "if heirs_count == 'yes' → require heirs_list",
    "property[] must include at least 1 item",
    "each property item must contain its required fields",
    "if debts == yes → require debt_docs",
    "if refusal == yes → require refusal_docs",
    "if term == 'late' → require term.restore_docs",
    "if representation == 'poa' → require poa.scan"
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — APPLICANT */
      {
        "id": "applicant",
        "type": "form",
        "title": "Заявитель",
        "fields": [
          { "name": "applicant.full_name", "type": "text", "label": "ФИО" },
          { "name": "applicant.iin", "type": "text", "label": "ИИН" },
          { "name": "applicant.passport", "type": "text", "label": "Паспорт: серия/№/кем/когда" },
          { "name": "applicant.address_reg", "type": "text", "label": "Адрес регистрации" },
          { "name": "applicant.address_fact", "type": "text", "label": "Адрес проживания" },
          { "name": "applicant.contact", "type": "text", "label": "Телефон / Email" }
        ],
        "next": "representation"
      },

      /* STEP 2 — REPRESENTATION */
      {
        "id": "representation",
        "type": "radio",
        "title": "Заявитель действует",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "next": {
          "personal": "deceased",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.number", "type": "text", "label": "Реестр №" },
          { "name": "poa.notary", "type": "text", "label": "Нотариус" },
          { "name": "poa.license", "type": "text", "label": "Лицензия нотариуса" },
          { "name": "poa.date", "type": "date", "label": "Дата выдачи" },
          { "name": "poa.scan[]", "type": "file", "label": "Скан доверенности", "min": 1 }
        ],
        "next": "deceased"
      },

      /* STEP 3 — DECEASED */
      {
        "id": "deceased",
        "type": "form",
        "title": "Наследодатель",
        "fields": [
          { "name": "deceased.full_name", "type": "text", "label": "ФИО" },
          { "name": "deceased.iin", "type": "text", "label": "ИИН (если есть)" },
          { "name": "deceased.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "deceased.death_date", "type": "date", "label": "Дата смерти" },
          { "name": "deceased.death_place", "type": "text", "label": "Место смерти" },
          { "name": "deceased.death_cert[]", "type": "file", "label": "Свидетельство о смерти", "min": 1 }
        ],
        "next": "last_residence"
      },

      /* STEP 4 — LAST RESIDENCE */
      {
        "id": "last_residence",
        "type": "form",
        "title": "Последнее место жительства",
        "fields": [
          { "name": "residence.address_reg", "type": "text", "label": "Адрес регистрации" },
          { "name": "residence.address_fact", "type": "text", "label": "Адрес проживания" }
        ],
        "next": "relation"
      },

      /* STEP 5 — RELATION */
      {
        "id": "relation",
        "type": "checkbox-group",
        "title": "Степень родства",
        "options": [
          { "value": "child", "label": "Дети" },
          { "value": "parent", "label": "Родители" },
          { "value": "spouse", "label": "Супруг(а)" },
          { "value": "sibling", "label": "Братья/сёстры" },
          { "value": "grandparent", "label": "Дедушки/бабушки" },
          { "value": "other_relative", "label": "Иные родственники" },
          { "value": "no_relation", "label": "Не родственник (по завещанию)" }
        ],
        "next": "relation_docs"
      },

      /* STEP 6 — RELATION DOCS */
      {
        "id": "relation_docs",
        "type": "form",
        "title": "Документы, подтверждающие родство",
        "fields": [
          { "name": "relation.docs[]", "type": "file", "label": "Документы (св-во о рожд., брак и др.)" }
        ],
        "next": "inherit_type"
      },

      /* STEP 7 — INHERIT TYPE */
      {
        "id": "inherit_type",
        "type": "radio",
        "title": "Основание наследования",
        "options": [
          { "value": "law", "label": "По закону" },
          { "value": "will", "label": "По завещанию" }
        ],
        "next": {
          "law": "heirs_count",
          "will": "will_upload"
        }
      },

      {
        "id": "will_upload",
        "type": "form",
        "title": "Завещание",
        "fields": [
          { "name": "will.file[]", "type": "file", "label": "Завещание", "min": 1 },
          { "name": "will.notary", "type": "text", "label": "Нотариус, выдавший завещание" },
          { "name": "will.date", "type": "date", "label": "Дата завещания" }
        ],
        "next": "heirs_count"
      },

      /* STEP 8 — HEIRS COUNT */
      {
        "id": "heirs_count",
        "type": "radio",
        "title": "Наследников несколько?",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "next": {
          "yes": "heirs_list",
          "no": "property"
        }
      },

      {
        "id": "heirs_list",
        "type": "repeatable",
        "title": "Другие наследники",
        "fields": [
          { "name": "heir.full_name", "type": "text", "label": "ФИО" },
          { "name": "heir.iin", "type": "text", "label": "ИИН" },
          { "name": "heir.relation", "type": "text", "label": "Родство" },
          { "name": "heir.address", "type": "text", "label": "Адрес" },
          { "name": "heir.contact", "type": "text", "label": "Контакты" },
          { "name": "heir.status", "type": "select", "options": ["принял", "отказался", "не вступал"], "label": "Статус" }
        ],
        "next": "property"
      },

      /* STEP 9 — PROPERTY */
      {
        "id": "property",
        "type": "checkbox-group",
        "title": "Состав наследственного имущества",
        "options": [
          { "value": "real_estate", "label": "Недвижимость" },
          { "value": "transport", "label": "Транспорт" },
          { "value": "bank_accounts", "label": "Банковские счета / вклады" },
          { "value": "securities", "label": "Ценные бумаги" },
          { "value": "business_shares", "label": "Доли в ТОО" },
          { "value": "cash_assets", "label": "Наличные / ценности" },
          { "value": "debts", "label": "Задолженности / обязательства" },
          { "value": "other", "label": "Иное имущество" }
        ],
        "next": "property_details"
      },

      /* STEP 10 — PROPERTY DETAILS (DYNAMIC) */
      {
        "id": "property_details",
        "type": "dynamic-task-details",
        "title": "Детализация имущества",
        "blocks": {
          "real_estate": [
            { "name": "real_estate.address", "type": "text", "label": "Адрес" },
            { "name": "real_estate.cadastre", "type": "text", "label": "Кадастровый номер" },
            { "name": "real_estate.docs[]", "type": "file", "label": "Документы собственности" }
          ],
          "transport": [
            { "name": "transport.brand", "type": "text", "label": "Марка" },
            { "name": "transport.vin", "type": "text", "label": "VIN" },
            { "name": "transport.reg_cert[]", "type": "file", "label": "Техпаспорт" }
          ],
          "bank_accounts": [
            { "name": "bank.bank", "type": "text", "label": "Банк" },
            { "name": "bank.iik", "type": "text", "label": "ИИК" },
            { "name": "bank.balance", "type": "text", "label": "Остаток" }
          ],
          "business_shares": [
            { "name": "business.tin", "type": "text", "label": "БИН ТОО" },
            { "name": "business.share_percent", "type": "text", "label": "Доля (%)" },
            { "name": "business.docs[]", "type": "file", "label": "Учредительные документы" }
          ],
          "securities": [
            { "name": "securities.desc", "type": "textarea", "label": "Описание" },
            { "name": "securities.docs[]", "type": "file", "label": "Документы" }
          ],
          "other": [
            { "name": "other.desc", "type": "textarea", "label": "Описание" },
            { "name": "other.docs[]", "type": "file", "label": "Документы" }
          ]
        },
        "next": "debts"
      },

      /* STEP 11 — DEBTS */
      {
        "id": "debts",
        "type": "radio",
        "title": "Долги наследодателя",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "next": {
          "yes": "debts_info",
          "no": "shares"
        }
      },

      {
        "id": "debts_info",
        "type": "repeatable",
        "title": "Информация о долгах",
        "fields": [
          { "name": "debt.creditor", "type": "text", "label": "Кредитор" },
          { "name": "debt.amount", "type": "text", "label": "Сумма задолженности" },
          { "name": "debt.docs[]", "type": "file", "label": "Документы (договора/справки)" }
        ],
        "next": "shares"
      },

      /* STEP 12 — SHARES */
      {
        "id": "shares",
        "type": "form",
        "title": "Доли наследования",
        "fields": [
          { "name": "shares.type", "type": "select", "options": ["по закону", "по завещанию", "по соглашению"], "label": "Тип распределения" },
          { "name": "shares.value", "type": "textarea", "label": "Описание доли / распределения" },
          { "name": "shares.agreement[]", "type": "file", "label": "Соглашение наследников (если есть)" }
        ],
        "next": "refusal"
      },

      /* STEP 13 — REFUSAL */
      {
        "id": "refusal",
        "type": "radio",
        "title": "Есть ли отказ от наследства?",
        "options": [
          { "value": "yes", "label": "Да" },
          { "value": "no", "label": "Нет" }
        ],
        "next": {
          "yes": "refusal_info",
          "no": "term"
        }
      },

      {
        "id": "refusal_info",
        "type": "form",
        "title": "Информация об отказе",
        "fields": [
          { "name": "refusal.person", "type": "text", "label": "ФИО отказавшегося" },
          { "name": "refusal.docs[]", "type": "file", "label": "Заявление об отказе", "min": 1 }
        ],
        "next": "term"
      },

      /* STEP 14 — TERM */
      {
        "id": "term",
        "type": "radio",
        "title": "6-месячный срок вступления в наследство",
        "options": [
          { "value": "in_term", "label": "В пределах срока" },
          { "value": "late", "label": "Пропущен срок" }
        ],
        "next": {
          "in_term": "validation",
          "late": "term_restore"
        }
      },

      {
        "id": "term_restore",
        "type": "form",
        "title": "Восстановление срока",
        "fields": [
          { "name": "term.restore_reason", "type": "textarea", "label": "Причина пропуска" },
          { "name": "term.restore_docs[]", "type": "file", "label": "Решение суда / документы", "min": 1 }
        ],
        "next": "validation"
      },

      /* STEP 15 — VALIDATION */
      {
        "id": "validation",
        "type": "validation",
        "rules": [
          "required applicant.full_name",
          "required deceased.full_name",
          "required deceased.death_cert",
          "required residence.address_reg",
          "required inherit_type",
          "required property",
          "required shares.type",
          "if inherit_type == 'will' → require will.file",
          "if relation != 'no_relation' → require relation.docs",
          "if term == 'late' → require term.restore_docs",
          "if representation == 'poa' → require poa.scan"
        ],
        "next": "generate"
      },

      /* STEP 16 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "applicant",
      "deceased",
      "relation",
      "inherit_type",
      "heirs[]",
      "property[]",
      "debts[]",
      "shares",
      "refusal",
      "term",
      "representation"
    ]
  }
},
{
  "id": 42,
  "code": "DOC_042",
  "title": "Заявление об отсутствии препятствий для выезда ребёнка",
  "category": "Дети / Путешествия / Нотариальные заявления",

  "dev_notes": [
    "Документ оформляется одним родителем/законным представителем.",
    "Если заявитель действует по доверенности — обязательна загрузка доверенности и ввод реквизитов.",
    "Если есть судебный запрет на выезд — генерация документа блокируется.",
    "Если сопровождающее лицо — обязательно загружаются паспорт/удостоверение, подтверждение полномочий (при необходимости), документы организации.",
    "Если ребёнок выезжает самостоятельно — доступно только при >= 16 лет (валидация).",
    "Выбор стран: 'В любую страну мира' (toggle), либо мультивыбор стран."
  ],

  "rules_for_cursor": [
    "При выборе 'по доверенности' показывать вложенный блок реквизитов + upload.",
    "Для данных ребёнка обязательны все поля + загрузка документа.",
    "Ветка 'есть судебные ограничения' полностью блокирует переход к генерации.",
    "Для сопровождающего (третье лицо) активировать несколько обязательных upload полей.",
    "Срок должен быть выбран строго из вариантов (конкретная дата/период/месяцы/бессрочно).",
    "При выборе 'самостоятельно' — включить возрастную проверку (>=16).",
    "Если выбраны конкретные страны — минимум 1 страна.",
    "Валидация перед генерацией должна проверять наличие всех обязательных загрузок."
  ],

  "parsed": {
    "steps": [

      {
        "id": "applicant",
        "type": "form",
        "title": "Данные заявителя",
        "fields": [
          { "name": "applicant.full_name", "label": "ФИО", "type": "text", "required": true },
          { "name": "applicant.iin", "label": "ИИН", "type": "text", "required": true },
          { "name": "applicant.passport.series", "label": "Паспорт — серия и номер", "type": "text", "required": true },
          { "name": "applicant.passport.issue", "label": "Кем выдан / дата выдачи", "type": "text", "required": true },
          { "name": "applicant.address", "label": "Адрес регистрации", "type": "text", "required": true },
          { "name": "applicant.phone", "label": "Телефон", "type": "text", "required": true },
          { "name": "applicant.email", "label": "E-mail", "type": "text" }
        ],
        "next": "representation"
      },

      {
        "id": "representation",
        "type": "radio",
        "title": "Заявитель действует лично?",
        "options": [
          { "label": "Да", "value": "self" },
          { "label": "Нет, по доверенности", "value": "poa" }
        ],
        "required": true,
        "next_if": {
          "self": "child",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.registry_number", "label": "Реестр №", "type": "text", "required": true },
          { "name": "poa.notary_name", "label": "Нотариус", "type": "text", "required": true },
          { "name": "poa.notary_license", "label": "Лицензия нотариуса", "type": "text", "required": true },
          { "name": "poa.issue_date", "label": "Дата выдачи", "type": "date", "required": true },
          { "name": "poa.file", "label": "Загрузить доверенность", "type": "file", "required": true }
        ],
        "next": "child"
      },

      {
        "id": "child",
        "type": "form",
        "title": "Данные ребёнка",
        "fields": [
          { "name": "child.full_name", "label": "ФИО ребёнка", "type": "text", "required": true },
          { "name": "child.iin", "label": "ИИН (если есть)", "type": "text" },
          { "name": "child.birth_date", "label": "Дата рождения", "type": "date", "required": true },
          { "name": "child.document", "label": "Свидетельство о рождении / паспорт (upload)", "type": "file", "required": true }
        ],
        "next": "second_parent"
      },

      {
        "id": "second_parent",
        "type": "form",
        "title": "Данные второго родителя",
        "fields": [
          { "name": "second_parent.full_name", "label": "ФИО", "type": "text" },
          { "name": "second_parent.iin", "label": "ИИН", "type": "text" },
          { "name": "second_parent.address", "label": "Место проживания", "type": "text" },
          { "name": "second_parent.conflict", "label": "Есть спор о выезде?", "type": "checkbox" }
        ],
        "next": "check_restrictions"
      },

      {
        "id": "check_restrictions",
        "type": "radio",
        "title": "Есть ли судебные ограничения на выезд ребёнка?",
        "options": [
          { "label": "Да", "value": "yes" },
          { "label": "Нет", "value": "no" }
        ],
        "required": true,
        "next_if": {
          "yes": "blocked",
          "no": "travel_dest"
        }
      },

      {
        "id": "blocked",
        "type": "final",
        "title": "Выдача заявления невозможна",
        "text": "Имеется судебный запрет/спор, документ не может быть оформлен.",
        "stop_generation": true
      },

      {
        "id": "travel_dest",
        "type": "checkbox-group",
        "title": "Куда планируется выезд",
        "options": [
          { "label": "В любую страну мира", "value": "anywhere" },
          { "label": "В конкретные страны", "value": "specific" },
          { "label": "Внутри РК", "value": "domestic" }
        ],
        "required": true,
        "next": "with_whom"
      },

      {
        "id": "with_whom",
        "type": "radio",
        "title": "С кем выезжает ребёнок?",
        "options": [
          { "label": "С другим родителем", "value": "other_parent" },
          { "label": "С родственником", "value": "relative" },
          { "label": "С третьим лицом (тренер/педагог/руководитель группы)", "value": "third" },
          { "label": "Самостоятельно (16+)", "value": "alone" }
        ],
        "required": true,
        "next_if": {
          "other_parent": "other_parent_info",
          "relative": "relative_info",
          "third": "third_person",
          "alone": "period"
        }
      },

      {
        "id": "other_parent_info",
        "type": "form",
        "title": "Информация о втором родителе",
        "fields": [
          { "name": "escort.full_name", "label": "ФИО", "type": "text", "required": true },
          { "name": "escort.iin", "label": "ИИН", "type": "text", "required": true },
          { "name": "escort.passport", "label": "Паспорт (опц.)", "type": "text" }
        ],
        "next": "period"
      },

      {
        "id": "relative_info",
        "type": "form",
        "title": "Информация о родственнике",
        "fields": [
          { "name": "relative.full_name", "label": "ФИО", "type": "text", "required": true },
          { "name": "relative.iin", "label": "ИИН", "type": "text", "required": true },
          { "name": "relative.passport", "label": "Паспорт", "type": "text", "required": true },
          { "name": "relative.relation", "label": "Степень родства", "type": "text", "required": true }
        ],
        "next": "period"
      },

      {
        "id": "third_person",
        "type": "form",
        "title": "Сопровождающее лицо (третье лицо)",
        "fields": [
          { "name": "escort.full_name", "label": "ФИО", "type": "text", "required": true },
          { "name": "escort.iin", "label": "ИИН", "type": "text", "required": true },
          { "name": "escort.passport", "label": "Паспорт (данные)", "type": "text", "required": true },
          { "name": "escort.file_passport", "label": "Загрузить паспорт сопровождающего", "type": "file", "required": true },
          { "name": "escort.organization", "label": "Организация (если групповая поездка)", "type": "text" },
          { "name": "escort.file_org", "label": "Документ, подтверждающий полномочия (при необходимости)", "type": "file" },
          { "name": "escort.file_permission", "label": "Документ о праве сопровождения (при необходимости)", "type": "file" }
        ],
        "next": "period"
      },

      {
        "id": "period",
        "type": "radio",
        "title": "Срок отсутствия препятствий",
        "options": [
          { "label": "На конкретные даты", "value": "dates" },
          { "label": "На период поездки", "value": "short" },
          { "label": "На длительный срок (1–24 месяцев)", "value": "months" },
          { "label": "Бессрочно", "value": "unlimited" }
        ],
        "required": true,
        "next": "purpose"
      },

      {
        "id": "purpose",
        "type": "checkbox-group",
        "title": "Цель поездки",
        "options": [
          { "label": "Туризм", "value": "tourism" },
          { "label": "Лечение", "value": "treatment" },
          { "label": "Учёба", "value": "education" },
          { "label": "Спортивные мероприятия", "value": "sport" },
          { "label": "К родственникам", "value": "family" },
          { "label": "Иное", "value": "other" }
        ],
        "required": true,
        "next": "statement"
      },

      {
        "id": "statement",
        "type": "form",
        "title": "Текст заявления",
        "fields": [
          {
            "name": "statement.text",
            "label": "Формулировка",
            "type": "textarea",
            "placeholder": "Я, ___, подтверждаю отсутствие препятствий для выезда моего ребёнка...",
            "required": true
          }
        ],
        "next": "validation"
      },

      {
        "id": "validation",
        "type": "validation",
        "title": "Проверка данных",
        "checks": [
          "Заполнены данные заявителя?",
          "Заполнены данные ребёнка?",
          "Загружен документ ребёнка?",
          "Указано направление выезда?",
          "Указано лицо, с кем выезжает ребёнок?",
          "Выбран срок?",
          "Нет судебных ограничений?"
        ],
        "next_on_success": "generate",
        "next_on_error": "applicant"
      },

      {
        "id": "generate",
        "type": "final",
        "title": "Генерация документа",
        "text": "Формируется заявление об отсутствии препятствий для выезда ребёнка. Включает данные заявителя, ребёнка, маршрут, срок, цели, подтверждения, приложения.",
        "next": "sign"
      },

      {
        "id": "sign",
        "type": "final",
        "title": "Подписание",
        "text": "Заявитель подписывает документ. Нотариус удостоверяет подпись и проверяет личность.",
        "next": "archive"
      },

      {
        "id": "archive",
        "type": "final",
        "title": "Архивация",
        "text": "Документ сохраняется в системе, выдаются экземпляры заявителю."
      }
    ],

    "placeholders": [
      "{{ applicant.full_name }}",
      "{{ applicant.iin }}",
      "{{ child.full_name }}",
      "{{ child.birth_date }}",
      "{{ travel_dest }}",
      "{{ escort.full_name }}",
      "{{ period }}",
      "{{ purpose }}",
      "{{ statement.text }}"
    ]
  }
},
{
  "id": 43,
  "code": "DOC_043",
  "title": "Заявление об отсутствии препятствий для выезда ребёнка",
  "category": "Дети / Путешествия / Нотариальные заявления",

  "dev_notes": [
    "Заявитель — только 1. Обязательно: паспорт, ИИН, адрес.",
    "Если действует по доверенности — обязательный upload доверенности.",
    "На ребёнка обязательно: ФИО, дата рождения, документ (свидетельство / паспорт).",
    "Если выезд с любым лицом кроме второго родителя — обязательный upload паспорта сопровождающего.",
    "Если поездка групповая (тренер/руководитель) — upload документа организации.",
    "Если судебный запрет — процесс должен остановиться (no generation).",
    "Срок: конкретные даты / период / длительный / бессрочно.",
    "Список стран может быть мультивыбором, но хотя бы 1 направление обязательно.",
    "Если выбран вариант «самостоятельно» — возраст ребёнка должен быть >=16.",
    "Валидация должна блокировать генерацию, если отсутствуют обязательные uploads."
  ],

  "rules_for_cursor": [
    "Все документы ребёнка — обязательно upload.",
    "Если заявитель действует по доверенности → обязательный upload доверенности.",
    "Если сопровождающее лицо — не родитель → обязательный upload его документа личности.",
    "При групповом сопровождении → upload документа организации.",
    "Если выбран вариант 'самостоятельно' → проверить возраст >= 16.",
    "Направление выезда — required.",
    "Срок — required.",
    "Если есть судебный запрет → block generation.",
    "Плейсхолдеры: {{applicant}}, {{child}}, {{second_parent}}, {{travel}}, {{escort}}, {{period}}, {{purpose}}, {{statement}}."
  ],

  "parsed": {
    "steps": [

      /* STEP 1 — APPLICANT */
      {
        "id": "applicant",
        "type": "form",
        "title": "Заявитель",
        "fields": [
          { "name": "applicant.full_name", "type": "text", "label": "ФИО" },
          { "name": "applicant.iin", "type": "text", "label": "ИИН" },
          { "name": "applicant.passport.number", "type": "text", "label": "Паспорт: серия / номер" },
          { "name": "applicant.passport.issued_by", "type": "text", "label": "Кем выдан" },
          { "name": "applicant.passport.issued_date", "type": "date", "label": "Дата выдачи" },
          { "name": "applicant.address", "type": "text", "label": "Адрес регистрации" },
          { "name": "applicant.phone", "type": "text", "label": "Телефон" },
          { "name": "applicant.email", "type": "text", "label": "E-mail" },
          { "name": "applicant.passport_scan[]", "type": "file", "label": "Паспорт заявителя (скан)", "min": 1 }
        ],
        "next": "representation"
      },

      /* STEP 2 — REPRESENTATION */
      {
        "id": "representation",
        "type": "radio",
        "title": "Заявитель пришёл лично?",
        "options": [
          { "value": "personal", "label": "Лично" },
          { "value": "poa", "label": "По доверенности" }
        ],
        "required": true,
        "next": {
          "personal": "child",
          "poa": "poa_fields"
        }
      },

      {
        "id": "poa_fields",
        "type": "form",
        "title": "Реквизиты доверенности",
        "fields": [
          { "name": "poa.registry", "type": "text", "label": "Реестровый номер" },
          { "name": "poa.notary", "type": "text", "label": "Нотариус / № лицензии" },
          { "name": "poa.date", "type": "date", "label": "Дата выдачи" },
          { "name": "poa.scan[]", "type": "file", "label": "Скан доверенности", "min": 1 }
        ],
        "next": "child"
      },

      /* STEP 3 — CHILD */
      {
        "id": "child",
        "type": "form",
        "title": "Данные ребёнка",
        "fields": [
          { "name": "child.full_name", "type": "text", "label": "ФИО" },
          { "name": "child.iin", "type": "text", "label": "ИИН (если есть)" },
          { "name": "child.birth_date", "type": "date", "label": "Дата рождения" },
          { "name": "child.doc_scan[]", "type": "file", "label": "Документ ребёнка (свидетельство/паспорт)", "min": 1 }
        ],
        "next": "second_parent"
      },

      /* STEP 4 — SECOND PARENT INFO */
      {
        "id": "second_parent",
        "type": "form",
        "title": "Данные второго родителя (если есть)",
        "fields": [
          { "name": "second_parent.full_name", "type": "text", "label": "ФИО" },
          { "name": "second_parent.iin", "type": "text", "label": "ИИН" },
          { "name": "second_parent.address", "type": "text", "label": "Адрес проживания" },
          { "name": "second_parent.has_dispute", "type": "checkbox", "label": "Есть ли спор о выезде?" }
        ],
        "next": "restrictions"
      },

      /* STEP 5 — COURT RESTRICTIONS */
      {
        "id": "restrictions",
        "type": "condition",
        "expression": "second_parent.has_dispute == true",
        "next_if_true": "blocked",
        "next_if_false": "travel_dest"
      },

      {
        "id": "blocked",
        "type": "final",
        "title": "Невозможно продолжить",
        "description": "Имеется судебный запрет / спор. Нельзя выдать заявление без решения суда."
      },

      /* STEP 6 — TRAVEL DESTINATION */
      {
        "id": "travel_dest",
        "type": "select",
        "title": "Направление поездки",
        "multiple": true,
        "required": true,
        "options": [
          "Любая страна мира",
          "Россия", "Китай", "Турция", "ОАЭ", "Европа", "США", "Узбекистан", "Киргизия",
          "Другое направление"
        ],
        "next": "with_whom"
      },

      /* STEP 7 — WITH WHOM */
      {
        "id": "with_whom",
        "type": "radio",
        "title": "С кем выезжает ребёнок?",
        "options": [
          { "value": "other_parent", "label": "С другим родителем" },
          { "value": "relative", "label": "С родственником" },
          { "value": "third_person", "label": "С третьим лицом (тренер / педагог / руководитель группы)" },
          { "value": "alone", "label": "Самостоятельно (16+)" }
        ],
        "required": true,
        "next": {
          "other_parent": "escort_parent",
          "relative": "escort_relative",
          "third_person": "escort_third",
          "alone": "period"
        }
      },

      /* OTHER PARENT */
      {
        "id": "escort_parent",
        "type": "form",
        "title": "Второй родитель",
        "fields": [
          { "name": "escort.full_name", "type": "text", "label": "ФИО" },
          { "name": "escort.iin", "type": "text", "label": "ИИН" }
        ],
        "next": "period"
      },

      /* RELATIVE */
      {
        "id": "escort_relative",
        "type": "form",
        "title": "Родственник",
        "fields": [
          { "name": "escort.full_name", "type": "text", "label": "ФИО" },
          { "name": "escort.iin", "type": "text", "label": "ИИН" },
          { "name": "escort.passport_scan[]", "type": "file", "label": "Паспорт родственника (скан)", "min": 1 }
        ],
        "next": "period"
      },

      /* THIRD PERSON */
      {
        "id": "escort_third",
        "type": "form",
        "title": "Сопровождающее лицо",
        "fields": [
          { "name": "escort.full_name", "type": "text", "label": "ФИО" },
          { "name": "escort.iin", "type": "text", "label": "ИИН" },
          { "name": "escort.passport_scan[]", "type": "file", "label": "Паспорт сопровождающего", "min": 1 },
          { "name": "escort.org", "type": "text", "label": "Организация / кружок (если групповая поездка)" },
          { "name": "escort.org_doc[]", "type": "file", "label": "Документ организации (если требуется)", "min": 0 }
        ],
        "next": "period"
      },

      /* STEP 8 — PERIOD */
      {
        "id": "period",
        "type": "form",
        "title": "Срок отсутствия препятствий",
        "fields": [
          { "name": "period.type", "type": "select", "label": "Тип срока", "options": ["Конкретные даты", "Период поездки", "1–24 месяца", "Бессрочно"] },
          { "name": "period.from", "type": "date", "label": "С" },
          { "name": "period.to", "type": "date", "label": "По" }
        ],
        "next": "purpose"
      },

      /* STEP 9 — PURPOSE */
      {
        "id": "purpose",
        "type": "checkbox-group",
        "title": "Цель поездки",
        "options": [
          { "value": "tourism", "label": "Туризм" },
          { "value": "treatment", "label": "Лечение" },
          { "value": "study", "label": "Учёба" },
          { "value": "sport", "label": "Спортивные мероприятия" },
          { "value": "relatives", "label": "К родственникам" },
          { "value": "other", "label": "Иное" }
        ],
        "min": 1,
        "next": "statement"
      },

      /* STEP 10 — STATEMENT */
      {
        "id": "statement",
        "type": "textarea",
        "title": "Формулировка заявления",
        "placeholder": "Я, ___, подтверждаю отсутствие препятствий для выезда ребёнка...",
        "next": "validate"
      },

      /* STEP 11 — VALIDATION */
      {
        "id": "validate",
        "type": "validation",
        "rules": [
          "required applicant.passport_scan",
          "required child.doc_scan",
          "required travel_dest",
          "required with_whom",
          "if with_whom != 'other_parent' AND with_whom != 'alone' → require escort.passport_scan",
          "if with_whom == 'alone' → child.birth_date >= 16 years",
          "required period.type"
        ],
        "next": "generate"
      },

      /* STEP 12 — GENERATE */
      {
        "id": "generate",
        "type": "final",
        "output": "docx"
      }
    ],

    "placeholders": [
      "applicant",
      "child",
      "second_parent",
      "travel",
      "escort",
      "period",
      "purpose",
      "statement"
    ]
  }
}






 


 







  